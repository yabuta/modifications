<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>voltdb::CopyOnWriteIterator Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacevoltdb.html">voltdb</a>::<a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html">CopyOnWriteIterator</a>
  </div>
</div>
<div class="contents">
<h1>voltdb::CopyOnWriteIterator Class Reference</h1><!-- doxytag: class="voltdb::CopyOnWriteIterator" --><!-- doxytag: inherits="voltdb::TupleIterator" -->
<p><code>#include &lt;<a class="el" href="CopyOnWriteIterator_8h_source.html">CopyOnWriteIterator.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for voltdb::CopyOnWriteIterator:</div>
<div class="dynsection">
<div class="center"><img src="classvoltdb_1_1CopyOnWriteIterator__inherit__graph.png" border="0" usemap="#voltdb_1_1CopyOnWriteIterator_inherit__map" alt="Inheritance graph"/></div>
<map name="voltdb_1_1CopyOnWriteIterator_inherit__map" id="voltdb_1_1CopyOnWriteIterator_inherit__map">
<area shape="rect" id="node2" href="classvoltdb_1_1TupleIterator.html" title="voltdb::TupleIterator" alt="" coords="33,5,193,35"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for voltdb::CopyOnWriteIterator:</div>
<div class="dynsection">
<div class="center"><img src="classvoltdb_1_1CopyOnWriteIterator__coll__graph.png" border="0" usemap="#voltdb_1_1CopyOnWriteIterator_coll__map" alt="Collaboration graph"/></div>
<map name="voltdb_1_1CopyOnWriteIterator_coll__map" id="voltdb_1_1CopyOnWriteIterator_coll__map">
<area shape="rect" id="node2" href="classvoltdb_1_1TupleIterator.html" title="voltdb::TupleIterator" alt="" coords="1759,119,1919,148"/><area shape="rect" id="node47" href="classvoltdb_1_1TableIterator.html" title="voltdb::TableIterator" alt="" coords="2031,192,2191,221"/><area shape="rect" id="node4" href="classvoltdb_1_1PersistentTable.html" title="voltdb::PersistentTable" alt="" coords="2344,225,2523,255"/><area shape="rect" id="node51" href="classvoltdb_1_1PersistentTableSurgeon.html" title="voltdb::PersistentTableSurgeon" alt="" coords="2647,161,2879,191"/><area shape="rect" id="node6" href="classvoltdb_1_1Table.html" title="voltdb::Table" alt="" coords="1545,183,1652,212"/><area shape="rect" id="node42" href="classvoltdb_1_1TableStats.html" title="voltdb::TableStats" alt="" coords="1767,395,1911,424"/><area shape="rect" id="node8" href="classvoltdb_1_1TableIndex.html" title="voltdb::TableIndex" alt="" coords="1260,268,1404,297"/><area shape="rect" id="node12" href="classvoltdb_1_1IndexStats.html" title="voltdb::IndexStats" alt="" coords="949,316,1096,345"/><area shape="rect" id="node10" href="classvoltdb_1_1TupleSchema.html" title="voltdb::TupleSchema" alt="" coords="5,187,168,216"/><area shape="rect" id="node16" href="classvoltdb_1_1TableTuple.html" title="voltdb::TableTuple" alt="" coords="292,224,433,253"/><area shape="rect" id="node25" href="structvoltdb_1_1TableIndexScheme.html" title="voltdb::TableIndexScheme" alt="" coords="608,135,808,164"/><area shape="rect" id="node14" href="classvoltdb_1_1StatsSource.html" title="voltdb::StatsSource" alt="" coords="629,339,787,368"/><area shape="rect" id="node21" href="classvoltdb_1_1NValue.html" title="voltdb::NValue" alt="" coords="303,375,423,404"/><area shape="rect" id="node29" href="classvoltdb_1_1ThreadLocalPool.html" title="voltdb::ThreadLocalPool" alt="" coords="932,191,1113,220"/><area shape="rect" id="node35" href="classvoltdb_1_1UndoQuantumReleaseInterest.html" title="voltdb::UndoQuantumReleaseInterest" alt="" coords="1971,349,2251,379"/><area shape="rect" id="node37" href="classvoltdb_1_1TupleMovementListener.html" title="voltdb::TupleMovementListener" alt="" coords="1992,139,2229,168"/><area shape="rect" id="node40" href="classvoltdb_1_1PersistentTableStats.html" title="voltdb::PersistentTableStats" alt="" coords="2003,296,2219,325"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="classvoltdb_1_1CopyOnWriteIterator-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a7ed6e56f16c9fdcf484dd56aa0bd551b">CopyOnWriteIterator</a> (<a class="el" href="classvoltdb_1_1PersistentTable.html">PersistentTable</a> *table, <a class="el" href="classvoltdb_1_1PersistentTableSurgeon.html">PersistentTableSurgeon</a> *surgeon, <a class="el" href="namespacevoltdb.html#afac8a32142d398eae88bed0ad72bf6d6">TBMap</a> blocks)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#abac0834ba932242e2fd3eb60cfb895bc">needToDirtyTuple</a> (const char *blockAddress, const char *tupleAddress)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a86d2eb8473d5eb2c9e49fbd075e65cd0">next</a> (<a class="el" href="classvoltdb_1_1TableTuple.html">TableTuple</a> &amp;out)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a0794ced1f12843fb6b9d732cf229c592">~CopyOnWriteIterator</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a8414e7b3f9a7c23d8afc6e77792e494c">countRemaining</a> () const </td></tr>
<tr><td colspan="2"><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a532b4ccae9857ce7fc211f2da4a7c26e">m_skippedDirtyRows</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a1d7d3b01bd1fc779f1df748bb1167710">m_skippedInactiveRows</a></td></tr>
<tr><td colspan="2"><h2>Friends</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a77de10ce2236772f48c1a1a7a5a75b52">CopyOnWriteContext</a></td></tr>
</table>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a7ed6e56f16c9fdcf484dd56aa0bd551b"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::CopyOnWriteIterator" ref="a7ed6e56f16c9fdcf484dd56aa0bd551b" args="(PersistentTable *table, PersistentTableSurgeon *surgeon, TBMap blocks)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">voltdb::CopyOnWriteIterator::CopyOnWriteIterator </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvoltdb_1_1PersistentTable.html">PersistentTable</a> *&nbsp;</td>
          <td class="paramname"> <em>table</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classvoltdb_1_1PersistentTableSurgeon.html">PersistentTableSurgeon</a> *&nbsp;</td>
          <td class="paramname"> <em>surgeon</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacevoltdb.html#afac8a32142d398eae88bed0ad72bf6d6">TBMap</a>&nbsp;</td>
          <td class="paramname"> <em>blocks</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a0794ced1f12843fb6b9d732cf229c592"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::~CopyOnWriteIterator" ref="a0794ced1f12843fb6b9d732cf229c592" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual voltdb::CopyOnWriteIterator::~CopyOnWriteIterator </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a8414e7b3f9a7c23d8afc6e77792e494c"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::countRemaining" ref="a8414e7b3f9a7c23d8afc6e77792e494c" args="() const " -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t voltdb::CopyOnWriteIterator::countRemaining </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td> const</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abac0834ba932242e2fd3eb60cfb895bc"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::needToDirtyTuple" ref="abac0834ba932242e2fd3eb60cfb895bc" args="(const char *blockAddress, const char *tupleAddress)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool voltdb::CopyOnWriteIterator::needToDirtyTuple </td>
          <td>(</td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>blockAddress</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>tupleAddress</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>When a tuple is "dirty" it is still active, but will never be a "found" tuple since it is skipped. The tuple may be dirty because it was deleted (this is why it is always skipped). In that case the <a class="el" href="classvoltdb_1_1CopyOnWriteContext.html">CopyOnWriteContext</a> calls this to ensure that the iteration finds the correct number of tuples in the used portion of the table blocks and doesn't overrun to the uninitialized block memory because it skiped a dirty tuple and didn't end up with the right found tuple count upon reaching the end. </p>

</div>
</div>
<a class="anchor" id="a86d2eb8473d5eb2c9e49fbd075e65cd0"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::next" ref="a86d2eb8473d5eb2c9e49fbd075e65cd0" args="(TableTuple &amp;out)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool voltdb::CopyOnWriteIterator::next </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classvoltdb_1_1TableTuple.html">TableTuple</a> &amp;&nbsp;</td>
          <td class="paramname"> <em>out</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Iterate through the table blocks until all the active tuples have been found. Skip dirty tuples and mark them as clean so that they can be copied during the next snapshot. </p>

<p>Implements <a class="el" href="classvoltdb_1_1TupleIterator.html#a3f1a8104290e4c60dd5e1d61697a0cbf">voltdb::TupleIterator</a>.</p>

</div>
</div>
<hr/><h2>Friends And Related Function Documentation</h2>
<a class="anchor" id="a77de10ce2236772f48c1a1a7a5a75b52"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::CopyOnWriteContext" ref="a77de10ce2236772f48c1a1a7a5a75b52" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">friend class <a class="el" href="classvoltdb_1_1CopyOnWriteContext.html">CopyOnWriteContext</a><code> [friend]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a532b4ccae9857ce7fc211f2da4a7c26e"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::m_skippedDirtyRows" ref="a532b4ccae9857ce7fc211f2da4a7c26e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a532b4ccae9857ce7fc211f2da4a7c26e">voltdb::CopyOnWriteIterator::m_skippedDirtyRows</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a1d7d3b01bd1fc779f1df748bb1167710"></a><!-- doxytag: member="voltdb::CopyOnWriteIterator::m_skippedInactiveRows" ref="a1d7d3b01bd1fc779f1df748bb1167710" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t <a class="el" href="classvoltdb_1_1CopyOnWriteIterator.html#a1d7d3b01bd1fc779f1df748bb1167710">voltdb::CopyOnWriteIterator::m_skippedInactiveRows</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>storage/<a class="el" href="CopyOnWriteIterator_8h_source.html">CopyOnWriteIterator.h</a></li>
<li>storage/<a class="el" href="CopyOnWriteIterator_8cpp.html">CopyOnWriteIterator.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 2 Oct 2014 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
