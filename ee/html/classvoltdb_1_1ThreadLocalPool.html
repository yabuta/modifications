<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>voltdb::ThreadLocalPool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="namespacevoltdb.html">voltdb</a>::<a class="el" href="classvoltdb_1_1ThreadLocalPool.html">ThreadLocalPool</a>
  </div>
</div>
<div class="contents">
<h1>voltdb::ThreadLocalPool Class Reference</h1><!-- doxytag: class="voltdb::ThreadLocalPool" -->
<p><code>#include &lt;<a class="el" href="ThreadLocalPool_8h_source.html">ThreadLocalPool.h</a>&gt;</code></p>

<p><a href="classvoltdb_1_1ThreadLocalPool-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1ThreadLocalPool.html#a16680fbe25a1e4cd7ac34f6c4d37b99c">ThreadLocalPool</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1ThreadLocalPool.html#abc7ef247d7685d20d4a617fa8ac993bc">~ThreadLocalPool</a> ()</td></tr>
<tr><td colspan="2"><h2>Static Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static std::size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1ThreadLocalPool.html#a89f2ee83a4d85cae76471d62f984633c">getAllocationSizeForObject</a> (std::size_t length)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static boost::shared_ptr<br class="typebreak"/>
&lt; boost::pool<br class="typebreak"/>
&lt; <a class="el" href="structvoltdb_1_1voltdb__pool__allocator__new__delete.html">voltdb_pool_allocator_new_delete</a> &gt; &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1ThreadLocalPool.html#a4aab64b6e076d804892630b27b34bca3">get</a> (std::size_t size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static boost::shared_ptr<br class="typebreak"/>
&lt; boost::pool<br class="typebreak"/>
&lt; <a class="el" href="structvoltdb_1_1voltdb__pool__allocator__new__delete.html">voltdb_pool_allocator_new_delete</a> &gt; &gt;&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1ThreadLocalPool.html#ae8f17e7a342e4f87f68ad10efd24b452">getExact</a> (std::size_t size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static std::size_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1ThreadLocalPool.html#aadf5dfacb808d05a1aa24574ecf42a38">getPoolAllocationSize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classvoltdb_1_1CompactingStringStorage.html">CompactingStringStorage</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classvoltdb_1_1ThreadLocalPool.html#a685d3364ee351271d45b2350a7183c44">getStringPool</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>A wrapper around a set of pools that are local to the current thread. An instance of the thread local pool must be maintained somewhere in the thread to ensure initialization and destruction of the thread local pools. Creating multiple instances is fine, it is reference counted. The thread local instance of pools will be freed once the last <a class="el" href="classvoltdb_1_1ThreadLocalPool.html">ThreadLocalPool</a> reference in the thread is destructed. </p>
<hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a16680fbe25a1e4cd7ac34f6c4d37b99c"></a><!-- doxytag: member="voltdb::ThreadLocalPool::ThreadLocalPool" ref="a16680fbe25a1e4cd7ac34f6c4d37b99c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">voltdb::ThreadLocalPool::ThreadLocalPool </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="abc7ef247d7685d20d4a617fa8ac993bc"></a><!-- doxytag: member="voltdb::ThreadLocalPool::~ThreadLocalPool" ref="abc7ef247d7685d20d4a617fa8ac993bc" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">voltdb::ThreadLocalPool::~ThreadLocalPool </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a4aab64b6e076d804892630b27b34bca3"></a><!-- doxytag: member="voltdb::ThreadLocalPool::get" ref="a4aab64b6e076d804892630b27b34bca3" args="(std::size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt; boost::pool&lt; <a class="el" href="structvoltdb_1_1voltdb__pool__allocator__new__delete.html">voltdb_pool_allocator_new_delete</a> &gt; &gt; voltdb::ThreadLocalPool::get </td>
          <td>(</td>
          <td class="paramtype">std::size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Retrieve a pool that allocates approximately sized chunks of memory. Provides pools that are powers of two and powers of two + the previous power of two. </p>

</div>
</div>
<a class="anchor" id="a89f2ee83a4d85cae76471d62f984633c"></a><!-- doxytag: member="voltdb::ThreadLocalPool::getAllocationSizeForObject" ref="a89f2ee83a4d85cae76471d62f984633c" args="(std::size_t length)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::size_t voltdb::ThreadLocalPool::getAllocationSizeForObject </td>
          <td>(</td>
          <td class="paramtype">std::size_t&nbsp;</td>
          <td class="paramname"> <em>length</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Return the nearest power-of-two-plus-or-minus buffer size that will be allocated for an object of the given length </p>

</div>
</div>
<a class="anchor" id="ae8f17e7a342e4f87f68ad10efd24b452"></a><!-- doxytag: member="voltdb::ThreadLocalPool::getExact" ref="ae8f17e7a342e4f87f68ad10efd24b452" args="(std::size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boost::shared_ptr&lt; boost::pool&lt; <a class="el" href="structvoltdb_1_1voltdb__pool__allocator__new__delete.html">voltdb_pool_allocator_new_delete</a> &gt; &gt; voltdb::ThreadLocalPool::getExact </td>
          <td>(</td>
          <td class="paramtype">std::size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Retrieve a pool that allocate chunks that are exactly the requested size. Only creates pools up to 1 megabyte + 4 bytes. </p>

<p><p>The goal of this code is to bypass the pool sizing algorithm used by boost and replace it with something that bounds allocations to a series of 2 meg blocks for small allocations. For large allocations fall back to a strategy of allocating two of these huge things at a time. The goal of this bounding is make the amount of untouched but allocated memory relatively small so that the counting done by the volt allocator accurately represents the effect on RSS.</p>
</p>

</div>
</div>
<a class="anchor" id="aadf5dfacb808d05a1aa24574ecf42a38"></a><!-- doxytag: member="voltdb::ThreadLocalPool::getPoolAllocationSize" ref="aadf5dfacb808d05a1aa24574ecf42a38" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::size_t voltdb::ThreadLocalPool::getPoolAllocationSize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a685d3364ee351271d45b2350a7183c44"></a><!-- doxytag: member="voltdb::ThreadLocalPool::getStringPool" ref="a685d3364ee351271d45b2350a7183c44" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classvoltdb_1_1CompactingStringStorage.html">CompactingStringStorage</a> * voltdb::ThreadLocalPool::getStringPool </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>common/<a class="el" href="ThreadLocalPool_8h_source.html">ThreadLocalPool.h</a></li>
<li>common/<a class="el" href="ThreadLocalPool_8cpp.html">ThreadLocalPool.cpp</a></li>
</ul>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 2 Oct 2014 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
