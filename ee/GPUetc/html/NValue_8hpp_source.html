<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>common/NValue.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>common/NValue.hpp</h1><a href="NValue_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* This file is part of VoltDB.</span>
<a name="l00002"></a>00002 <span class="comment"> * Copyright (C) 2008-2014 VoltDB Inc.</span>
<a name="l00003"></a>00003 <span class="comment"> *</span>
<a name="l00004"></a>00004 <span class="comment"> * This program is free software: you can redistribute it and/or modify</span>
<a name="l00005"></a>00005 <span class="comment"> * it under the terms of the GNU Affero General Public License as</span>
<a name="l00006"></a>00006 <span class="comment"> * published by the Free Software Foundation, either version 3 of the</span>
<a name="l00007"></a>00007 <span class="comment"> * License, or (at your option) any later version.</span>
<a name="l00008"></a>00008 <span class="comment"> *</span>
<a name="l00009"></a>00009 <span class="comment"> * This program is distributed in the hope that it will be useful,</span>
<a name="l00010"></a>00010 <span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00011"></a>00011 <span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00012"></a>00012 <span class="comment"> * GNU Affero General Public License for more details.</span>
<a name="l00013"></a>00013 <span class="comment"> *</span>
<a name="l00014"></a>00014 <span class="comment"> * You should have received a copy of the GNU Affero General Public License</span>
<a name="l00015"></a>00015 <span class="comment"> * along with VoltDB.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00016"></a>00016 <span class="comment"> */</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="preprocessor">#ifndef NVALUE_HPP_</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span><span class="preprocessor">#define NVALUE_HPP_</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00022"></a>00022 <span class="preprocessor">#include &lt;cfloat&gt;</span>
<a name="l00023"></a>00023 <span class="preprocessor">#include &lt;climits&gt;</span>
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;exception&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;stdint.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;boost/scoped_ptr.hpp&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;boost/functional/hash.hpp&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;ttmath/ttmathint.h&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="ExportSerializeIo_8h.html">common/ExportSerializeIo.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="FatalException_8hpp.html">common/FatalException.hpp</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="Pool_8hpp.html">common/Pool.hpp</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="SQLException_8h.html">common/SQLException.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="StringRef_8h.html">common/StringRef.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="ThreadLocalPool_8h.html">common/ThreadLocalPool.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="debuglog_8h.html">common/debuglog.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="serializeio_8h.html">common/serializeio.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="types_8h.html">common/types.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="value__defs_8h.html">common/value_defs.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;utf8.h&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;murmur3/MurmurHash3.h&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="keyword">namespace </span>voltdb {
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">/*</span>
<a name="l00053"></a>00053 <span class="comment"> * Objects are length preceded with a short length value or a long length value</span>
<a name="l00054"></a>00054 <span class="comment"> * depending on how many bytes are needed to represent the length. These</span>
<a name="l00055"></a>00055 <span class="comment"> * define how many bytes are used for the short value vs. the long value.</span>
<a name="l00056"></a>00056 <span class="comment"> */</span>
<a name="l00057"></a><a class="code" href="NValue_8hpp.html#a55aac814b8e8b7d50c07257f51c633fd">00057</a> <span class="preprocessor">#define SHORT_OBJECT_LENGTHLENGTH static_cast&lt;char&gt;(1)</span>
<a name="l00058"></a><a class="code" href="NValue_8hpp.html#a0797802e1211ea00e42020de39c5bf03">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define LONG_OBJECT_LENGTHLENGTH static_cast&lt;char&gt;(4)</span>
<a name="l00059"></a><a class="code" href="NValue_8hpp.html#a739d0b39c04a69c173db87bce273e19c">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define OBJECT_NULL_BIT static_cast&lt;char&gt;(1 &lt;&lt; 6)</span>
<a name="l00060"></a><a class="code" href="NValue_8hpp.html#ab41edea328152f927ebf6ff9eae5af6c">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define OBJECT_CONTINUATION_BIT static_cast&lt;char&gt;(1 &lt;&lt; 7)</span>
<a name="l00061"></a><a class="code" href="NValue_8hpp.html#acfd5d895e8bdc4331b1e9ca681653442">00061</a> <span class="preprocessor"></span><span class="preprocessor">#define OBJECT_MAX_LENGTH_SHORT_LENGTH 63</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a><a class="code" href="NValue_8hpp.html#a8c6f1797e452cb5b69e635459b961c65">00063</a> <span class="preprocessor">#define FULL_STRING_IN_MESSAGE_THRESHOLD 100</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00065"></a>00065 <span class="comment">//The int used for storage and return values</span>
<a name="l00066"></a><a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">00066</a> <span class="keyword">typedef</span> ttmath::Int&lt;2&gt; <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>;
<a name="l00067"></a>00067 <span class="comment">//Long integer with space for multiplication and division without carry/overflow</span>
<a name="l00068"></a><a class="code" href="namespacevoltdb.html#a034dcd3d13a8293e0fc8bbf07aac39ed">00068</a> <span class="keyword">typedef</span> ttmath::Int&lt;4&gt; <a class="code" href="namespacevoltdb.html#a034dcd3d13a8293e0fc8bbf07aac39ed">TTLInt</a>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l00071"></a><a class="code" href="namespacevoltdb.html#a30d1fb04637ce4bce79c33b9e1526827">00071</a> <span class="keywordtype">void</span> <a class="code" href="namespacevoltdb.html#a30d1fb04637ce4bce79c33b9e1526827">throwCastSQLValueOutOfRangeException</a>(
<a name="l00072"></a>00072         <span class="keyword">const</span> T value,
<a name="l00073"></a>00073         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> origType,
<a name="l00074"></a>00074         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> newType)
<a name="l00075"></a>00075 {
<a name="l00076"></a>00076     <a class="code" href="namespacevoltdb.html#a30d1fb04637ce4bce79c33b9e1526827">throwCastSQLValueOutOfRangeException</a>((<span class="keyword">const</span> int64_t)value, origType, newType);
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="keyword">template</span>&lt;&gt;
<a name="l00080"></a>00080 <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacevoltdb.html#a10c377bb16b21d9a907063cd8fa277db">throwCastSQLValueOutOfRangeException&lt;double&gt;</a>(
<a name="l00081"></a>00081         <span class="keyword">const</span> <span class="keywordtype">double</span> value,
<a name="l00082"></a>00082         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> origType,
<a name="l00083"></a>00083         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> newType)
<a name="l00084"></a>00084 {
<a name="l00085"></a>00085     <span class="keywordtype">char</span> msg[1024];
<a name="l00086"></a>00086     snprintf(msg, 1024, <span class="stringliteral">&quot;Type %s with value %f can&apos;t be cast as %s because the value is &quot;</span>
<a name="l00087"></a>00087             <span class="stringliteral">&quot;out of range for the destination type&quot;</span>,
<a name="l00088"></a>00088             <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(origType).c_str(),
<a name="l00089"></a>00089             value,
<a name="l00090"></a>00090             <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(newType).c_str());
<a name="l00091"></a>00091     <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l00092"></a>00092                        msg);
<a name="l00093"></a>00093 }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="keyword">template</span>&lt;&gt;
<a name="l00096"></a>00096 <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacevoltdb.html#a3167aecefa48bcba64446e1ac39f13f6">throwCastSQLValueOutOfRangeException&lt;int64_t&gt;</a>(
<a name="l00097"></a>00097                                   <span class="keyword">const</span> int64_t value,
<a name="l00098"></a>00098                                   <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> origType,
<a name="l00099"></a>00099                                   <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> newType)
<a name="l00100"></a>00100 {
<a name="l00101"></a>00101     <span class="keywordtype">char</span> msg[1024];
<a name="l00102"></a>00102     snprintf(msg, 1024, <span class="stringliteral">&quot;Type %s with value %jd can&apos;t be cast as %s because the value is &quot;</span>
<a name="l00103"></a>00103             <span class="stringliteral">&quot;out of range for the destination type&quot;</span>,
<a name="l00104"></a>00104             <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(origType).c_str(),
<a name="l00105"></a>00105             (intmax_t)value,
<a name="l00106"></a>00106             <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(newType).c_str());
<a name="l00107"></a>00107 
<a name="l00108"></a>00108     <span class="comment">// record underflow or overflow for executors that catch this (indexes, mostly)</span>
<a name="l00109"></a>00109     <span class="keywordtype">int</span> internalFlags = 0;
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (value &gt; 0) internalFlags |= <a class="code" href="classvoltdb_1_1SQLException.html#a732022c6d3f2998901df1719e190512f">SQLException::TYPE_OVERFLOW</a>;
<a name="l00111"></a>00111     <span class="keywordflow">if</span> (value &lt; 0) internalFlags |= <a class="code" href="classvoltdb_1_1SQLException.html#a02b35ff9c8a78defb0c857f3253f9033">SQLException::TYPE_UNDERFLOW</a>;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l00114"></a>00114                        msg, internalFlags);
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <span class="keyword">template</span>&lt;&gt;
<a name="l00118"></a>00118 <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacevoltdb.html#a4a0a0f6edbe011a7c303306b3244abc7">throwCastSQLValueOutOfRangeException&lt;TTInt&gt;</a>(
<a name="l00119"></a>00119                                   <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> value,
<a name="l00120"></a>00120                                   <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> origType,
<a name="l00121"></a>00121                                   <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> newType)
<a name="l00122"></a>00122 {
<a name="l00123"></a>00123     <span class="keywordtype">char</span> msg[1024];
<a name="l00124"></a>00124     snprintf(msg, 1024, <span class="stringliteral">&quot;Type %s with value %s can&apos;t be cast as %s because the value is &quot;</span>
<a name="l00125"></a>00125             <span class="stringliteral">&quot;out of range for the destination type&quot;</span>,
<a name="l00126"></a>00126             <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(origType).c_str(),
<a name="l00127"></a>00127             value.ToString().c_str(),
<a name="l00128"></a>00128             <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(newType).c_str());
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="comment">// record underflow or overflow for executors that catch this (indexes, mostly)</span>
<a name="l00131"></a>00131     <span class="keywordtype">int</span> internalFlags = 0;
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (value &gt; 0) internalFlags |= <a class="code" href="classvoltdb_1_1SQLException.html#a732022c6d3f2998901df1719e190512f">SQLException::TYPE_OVERFLOW</a>;
<a name="l00133"></a>00133     <span class="keywordflow">if</span> (value &lt; 0) internalFlags |= <a class="code" href="classvoltdb_1_1SQLException.html#a02b35ff9c8a78defb0c857f3253f9033">SQLException::TYPE_UNDERFLOW</a>;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135     <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l00136"></a>00136                        msg, internalFlags);
<a name="l00137"></a>00137 }
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 <span class="keywordtype">int</span> <a class="code" href="namespacevoltdb.html#a0bd9987e25d4df4f6d7125f8c35f2acf">warn_if</a>(<span class="keywordtype">int</span> condition, <span class="keyword">const</span> <span class="keywordtype">char</span>* message);
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="comment">// This has been demonstrated to be more reliable than std::isinf</span>
<a name="l00142"></a>00142 <span class="comment">// -- less sensitive on LINUX to the &quot;g++ -ffast-math&quot; option.</span>
<a name="l00143"></a><a class="code" href="namespacevoltdb.html#a4333787961ba4bad4467fb0a2f7302c3">00143</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="namespacevoltdb.html#a4333787961ba4bad4467fb0a2f7302c3">non_std_isinf</a>( <span class="keywordtype">double</span> x ) { <span class="keywordflow">return</span> (x &gt; DBL_MAX) || (x &lt; -DBL_MAX); }
<a name="l00144"></a>00144 
<a name="l00145"></a><a class="code" href="namespacevoltdb.html#a662266842be07fb1d28f4e530b6db8c3">00145</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacevoltdb.html#a662266842be07fb1d28f4e530b6db8c3">throwDataExceptionIfInfiniteOrNaN</a>(<span class="keywordtype">double</span> value, <span class="keyword">const</span> <span class="keywordtype">char</span>* function)
<a name="l00146"></a>00146 {
<a name="l00147"></a>00147     <span class="keyword">static</span> <span class="keywordtype">int</span> warned_once_no_nan = <a class="code" href="namespacevoltdb.html#a0bd9987e25d4df4f6d7125f8c35f2acf">warn_if</a>( ! std::isnan(sqrt(-1.0)),
<a name="l00148"></a>00148                                             <span class="stringliteral">&quot;The C++ configuration (e.g. \&quot;g++ --fast-math\&quot;) &quot;</span>
<a name="l00149"></a>00149                                             <span class="stringliteral">&quot;does not support SQL standard handling of NaN errors.&quot;</span>);
<a name="l00150"></a>00150     <span class="keyword">static</span> <span class="keywordtype">int</span> warned_once_no_inf = <a class="code" href="namespacevoltdb.html#a0bd9987e25d4df4f6d7125f8c35f2acf">warn_if</a>( ! <a class="code" href="namespacevoltdb.html#a4333787961ba4bad4467fb0a2f7302c3">non_std_isinf</a>(std::pow(0.0, -1.0)),
<a name="l00151"></a>00151                                             <span class="stringliteral">&quot;The C++ configuration (e.g. \&quot;g++ --fast-math\&quot;) &quot;</span>
<a name="l00152"></a>00152                                             <span class="stringliteral">&quot;does not support SQL standard handling of numeric infinity errors.&quot;</span>);
<a name="l00153"></a>00153     <span class="comment">// This uses a standard test for NaN, even though that fails in some configurations like LINUX &quot;g++ -ffast-math&quot;.</span>
<a name="l00154"></a>00154     <span class="comment">// If it is known to fail in the current config, a warning has been sent to the log,</span>
<a name="l00155"></a>00155     <span class="comment">// so at this point, just relax the check.</span>
<a name="l00156"></a>00156     <span class="keywordflow">if</span> ((warned_once_no_nan || ! std::isnan(value)) &amp;&amp; (warned_once_no_inf || ! <a class="code" href="namespacevoltdb.html#a4333787961ba4bad4467fb0a2f7302c3">non_std_isinf</a>(value))) {
<a name="l00157"></a>00157         <span class="keywordflow">return</span>;
<a name="l00158"></a>00158     }
<a name="l00159"></a>00159     <span class="keywordtype">char</span> msg[1024];
<a name="l00160"></a>00160     snprintf(msg, 1024, <span class="stringliteral">&quot;Invalid result value (%f) from floating point %s&quot;</span>, value, function);
<a name="l00161"></a>00161     <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>, msg);
<a name="l00162"></a>00162 }
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 
<a name="l00168"></a><a class="code" href="namespacevoltdb.html#a82d68b012690bdd7af478e91252859d3">00168</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="namespacevoltdb.html#a82d68b012690bdd7af478e91252859d3">streamSQLFloatFormat</a>(std::stringstream&amp; streamOut, <span class="keywordtype">double</span> floatValue)
<a name="l00169"></a>00169 {
<a name="l00170"></a>00170     <span class="comment">// Standard SQL wants capital E scientific notation.</span>
<a name="l00171"></a>00171     <span class="comment">// Yet it differs in some detail from C/C++ E notation, even with all of its customization options.</span>
<a name="l00172"></a>00172 
<a name="l00173"></a>00173     <span class="comment">// For starters, for 0, the standard explicitly calls for &apos;0E0&apos;.</span>
<a name="l00174"></a>00174     <span class="comment">// For across-the-board compatibility, the HSQL backend had to be patched it was using &apos;0.0E0&apos;.</span>
<a name="l00175"></a>00175     <span class="comment">// C++ uses 0.000000E+00 by default. So override that explicitly.</span>
<a name="l00176"></a>00176     <span class="keywordflow">if</span> (0.0 == floatValue) {
<a name="l00177"></a>00177         streamOut &lt;&lt; <span class="stringliteral">&quot;0E0&quot;</span>;
<a name="l00178"></a>00178         <span class="keywordflow">return</span>;
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180     <span class="comment">// For other values, C++ generally adds too much garnish to be standard</span>
<a name="l00181"></a>00181     <span class="comment">// -- trailing zeros in the mantissa, an explicit &apos;+&apos; on the exponent, and a</span>
<a name="l00182"></a>00182     <span class="comment">// leading 0 before single-digit exponents.  Trim it down to the minimalist sql standard.</span>
<a name="l00183"></a>00183     std::stringstream fancy;
<a name="l00184"></a>00184     fancy &lt;&lt; std::setiosflags(std::ios::scientific | std::ios::uppercase) &lt;&lt; floatValue;
<a name="l00185"></a>00185     <span class="comment">// match any format with the regular expression:</span>
<a name="l00186"></a>00186     std::string fancyText = fancy.str();
<a name="l00187"></a>00187     <span class="keywordtype">size_t</span> ePos = fancyText.find(<span class="charliteral">&apos;E&apos;</span>, 3); <span class="comment">// find E after &quot;[-]n.n&quot;.</span>
<a name="l00188"></a>00188     assert(ePos != std::string::npos);
<a name="l00189"></a>00189     <span class="keywordtype">size_t</span> endSignifMantissa;
<a name="l00190"></a>00190     <span class="comment">// Never truncate mantissa down to the bare &apos;.&apos; EVEN for the case of &quot;n.0&quot;.</span>
<a name="l00191"></a>00191     <span class="keywordflow">for</span> (endSignifMantissa = ePos; fancyText[endSignifMantissa-2] != <span class="charliteral">&apos;.&apos;</span>; --endSignifMantissa) {
<a name="l00192"></a>00192         <span class="comment">// Only truncate trailing &apos;0&apos;s.</span>
<a name="l00193"></a>00193         <span class="keywordflow">if</span> (fancyText[endSignifMantissa-1] != <span class="charliteral">&apos;0&apos;</span>) {
<a name="l00194"></a>00194             <span class="keywordflow">break</span>; <span class="comment">// from loop</span>
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196     }
<a name="l00197"></a>00197     <span class="keyword">const</span> <span class="keywordtype">char</span>* optionalSign = (fancyText[ePos+1] == <span class="charliteral">&apos;-&apos;</span>) ? <span class="stringliteral">&quot;-&quot;</span> : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00198"></a>00198     <span class="keywordtype">size_t</span> startSignifExponent;
<a name="l00199"></a>00199     <span class="comment">// Always keep at least 1 exponent digit.</span>
<a name="l00200"></a>00200     <span class="keywordtype">size_t</span> endExponent = fancyText.length()-1;
<a name="l00201"></a>00201     <span class="keywordflow">for</span> (startSignifExponent = ePos+1; startSignifExponent &lt; endExponent; ++startSignifExponent) {
<a name="l00202"></a>00202         <span class="keyword">const</span> <span class="keywordtype">char</span>&amp; exponentLeadChar = fancyText[startSignifExponent];
<a name="l00203"></a>00203         <span class="comment">// Only skip leading &apos;-&apos;s, &apos;+&apos;s and &apos;0&apos;s.</span>
<a name="l00204"></a>00204         <span class="keywordflow">if</span> (exponentLeadChar != <span class="charliteral">&apos;-&apos;</span> &amp;&amp; exponentLeadChar != <span class="charliteral">&apos;+&apos;</span> &amp;&amp; exponentLeadChar != <span class="charliteral">&apos;0&apos;</span>) {
<a name="l00205"></a>00205             <span class="keywordflow">break</span>; <span class="comment">// from loop</span>
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208     <span class="comment">// Bring the truncated pieces together.</span>
<a name="l00209"></a>00209     streamOut &lt;&lt; fancyText.substr(0, endSignifMantissa)
<a name="l00210"></a>00210               &lt;&lt; <span class="charliteral">&apos;E&apos;</span> &lt;&lt; optionalSign &lt;&lt; fancyText.substr(startSignifExponent);
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00226"></a><a class="code" href="classvoltdb_1_1NValue.html">00226</a> <span class="keyword">class </span><a class="code" href="classvoltdb_1_1NValue.html">NValue</a> {
<a name="l00227"></a><a class="code" href="classvoltdb_1_1NValue.html#a3c892f7026e77653d9b60818bcb0c8b6">00227</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classvoltdb_1_1ValuePeeker.html">ValuePeeker</a>;
<a name="l00228"></a><a class="code" href="classvoltdb_1_1NValue.html#a4d62690780a27414dc462de765bdfbb4">00228</a>     <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classvoltdb_1_1ValueFactory.html">ValueFactory</a>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230   <span class="keyword">public</span>:
<a name="l00231"></a>00231     <span class="comment">/* Create a default NValue */</span>
<a name="l00232"></a>00232     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a>();
<a name="l00233"></a>00233 
<a name="l00234"></a>00234         <span class="comment">// todo: free() should not really be const</span>
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">/* Release memory associated to object type NValues */</span>
<a name="l00237"></a>00237     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#aa876019cd4d75772a0dd8b608275f07f">free</a>() <span class="keyword">const</span>;
<a name="l00238"></a>00238 
<a name="l00239"></a>00239     <span class="comment">/* Release memory associated to object type tuple columns */</span>
<a name="l00240"></a>00240     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a1ded28b253bd9bc49c3d159bba67476f">freeObjectsFromTupleStorage</a>(std::vector&lt;char*&gt; <span class="keyword">const</span> &amp;oldObjects);
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     <span class="comment">/* Set value to the correct SQL NULL representation. */</span>
<a name="l00243"></a>00243     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a249dfdbc4b3bfa2f1b9e9303c4ba0de4">setNull</a>();
<a name="l00244"></a>00244 
<a name="l00245"></a>00245     <span class="comment">/* Reveal the contained pointer for type values  */</span>
<a name="l00246"></a>00246     <span class="keywordtype">void</span>* <a class="code" href="classvoltdb_1_1NValue.html#a8e5c4f131c04834ab9b30492cb4f4123">castAsAddress</a>() <span class="keyword">const</span>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="comment">/* Create a boolean true NValue */</span>
<a name="l00249"></a>00249     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>();
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     <span class="comment">/* Create a boolean false NValue */</span>
<a name="l00252"></a>00252     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l00253"></a>00253 
<a name="l00254"></a>00254     <span class="comment">/* Create an NValue with the null representation for valueType */</span>
<a name="l00255"></a>00255     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">getNullValue</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a>);
<a name="l00256"></a>00256 
<a name="l00257"></a>00257     <span class="comment">/* Create an NValue promoted/demoted to type */</span>
<a name="l00258"></a>00258     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#af433c630b5bc5d9fb5ebda5e5d7aa369">castAs</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type) <span class="keyword">const</span>;
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         <span class="comment">// todo: Why doesn&apos;t this return size_t? Also, this is a</span>
<a name="l00261"></a>00261         <span class="comment">// quality of ValueType, not NValue.</span>
<a name="l00262"></a>00262 
<a name="l00263"></a>00263     <span class="comment">/* Calculate the tuple storage size for an NValue type. VARCHARs</span>
<a name="l00264"></a>00264 <span class="comment">       assume out-of-band tuple storage */</span>
<a name="l00265"></a>00265     <span class="keyword">static</span> uint16_t <a class="code" href="classvoltdb_1_1NValue.html#a1aa0d26a314b33da709fc441a4f74eb2">getTupleStorageSize</a>(<span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type);
<a name="l00266"></a>00266 
<a name="l00267"></a>00267        <span class="comment">// todo: Could the isInlined argument be removed by have the</span>
<a name="l00268"></a>00268        <span class="comment">// caller dereference the pointer?</span>
<a name="l00269"></a>00269 
<a name="l00270"></a>00270     <span class="comment">/* Deserialize a scalar of the specified type from the tuple</span>
<a name="l00271"></a>00271 <span class="comment">       storage area provided. If this is an Object type then the third</span>
<a name="l00272"></a>00272 <span class="comment">       argument indicates whether the object is stored in the tuple</span>
<a name="l00273"></a>00273 <span class="comment">       inline */</span>
<a name="l00274"></a>00274     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a37dd81843b76fa8b374ae4b456b12e49">initFromTupleStorage</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *storage, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keywordtype">bool</span> isInlined);
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <span class="comment">/* Serialize the scalar this NValue represents to the provided</span>
<a name="l00277"></a>00277 <span class="comment">       storage area. If the scalar is an Object type that is not</span>
<a name="l00278"></a>00278 <span class="comment">       inlined then the provided data pool or the heap will be used to</span>
<a name="l00279"></a>00279 <span class="comment">       allocated storage for a copy of the object. */</span>
<a name="l00280"></a>00280     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a83842fe74fb3154969144a67d2350b4d">serializeToTupleStorageAllocateForObjects</a>(
<a name="l00281"></a>00281         <span class="keywordtype">void</span> *storage, <span class="keyword">const</span> <span class="keywordtype">bool</span> isInlined, <span class="keyword">const</span> int32_t maxLength,
<a name="l00282"></a>00282         <span class="keyword">const</span> <span class="keywordtype">bool</span> isInBytes, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool) <span class="keyword">const</span>;
<a name="l00283"></a>00283 
<a name="l00284"></a>00284     <span class="comment">/* Serialize the scalar this NValue represents to the storage area</span>
<a name="l00285"></a>00285 <span class="comment">       provided. If the scalar is an Object type then the object will</span>
<a name="l00286"></a>00286 <span class="comment">       be copy if it can be inlined into the tuple. Otherwise a</span>
<a name="l00287"></a>00287 <span class="comment">       pointer to the object will be copied into the storage area. Any</span>
<a name="l00288"></a>00288 <span class="comment">       allocations needed (if this NValue refers to inlined memory</span>
<a name="l00289"></a>00289 <span class="comment">       whereas the field in the tuple is not inlined), will be done in</span>
<a name="l00290"></a>00290 <span class="comment">       the temp string pool. */</span>
<a name="l00291"></a>00291     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a52176939ccf0825e11b056a8a89be171">serializeToTupleStorage</a>(
<a name="l00292"></a>00292         <span class="keywordtype">void</span> *storage, <span class="keyword">const</span> <span class="keywordtype">bool</span> isInlined, <span class="keyword">const</span> int32_t maxLength, <span class="keyword">const</span> <span class="keywordtype">bool</span> isInBytes) <span class="keyword">const</span>;
<a name="l00293"></a>00293 
<a name="l00294"></a>00294     <span class="comment">/* Deserialize a scalar value of the specified type from the</span>
<a name="l00295"></a>00295 <span class="comment">       SerializeInput directly into the tuple storage area</span>
<a name="l00296"></a>00296 <span class="comment">       provided. This function will perform memory allocations for</span>
<a name="l00297"></a>00297 <span class="comment">       Object types as necessary using the provided data pool or the</span>
<a name="l00298"></a>00298 <span class="comment">       heap. This is used to deserialize tables. */</span>
<a name="l00299"></a>00299     <span class="keyword">template</span> &lt;TupleSerializationFormat F, Endianess E&gt;
<a name="l00300"></a>00300     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a44a90f734b8acbc77bed5d307922af90">deserializeFrom</a>(
<a name="l00301"></a>00301         <a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInput&lt;E&gt;</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool, <span class="keywordtype">char</span> *storage,
<a name="l00302"></a>00302         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keywordtype">bool</span> isInlined, int32_t maxLength, <span class="keywordtype">bool</span> isInBytes);
<a name="l00303"></a>00303     <span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a44a90f734b8acbc77bed5d307922af90">deserializeFrom</a>(
<a name="l00304"></a>00304         <a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInputBE</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool, <span class="keywordtype">char</span> *storage,
<a name="l00305"></a>00305         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keywordtype">bool</span> isInlined, int32_t maxLength, <span class="keywordtype">bool</span> isInBytes);
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="comment">// TODO: no callers use the first form; Should combine these</span>
<a name="l00308"></a>00308         <span class="comment">// eliminate the potential NValue copy.</span>
<a name="l00309"></a>00309 
<a name="l00310"></a>00310     <span class="comment">/* Read a ValueType from the SerializeInput stream and deserialize</span>
<a name="l00311"></a>00311 <span class="comment">       a scalar value of the specified type into this NValue from the provided</span>
<a name="l00312"></a>00312 <span class="comment">       SerializeInput and perform allocations as necessary. */</span>
<a name="l00313"></a>00313     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a2b74136eb54a4b009716d2292c323658">deserializeFromAllocateForStorage</a>(<a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInputBE</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool);
<a name="l00314"></a>00314     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a2b74136eb54a4b009716d2292c323658">deserializeFromAllocateForStorage</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> vt, <a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInputBE</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     <span class="comment">/* Serialize this NValue to a SerializeOutput */</span>
<a name="l00317"></a>00317     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a40be242bf1ec481e07b0dc83dc959819">serializeTo</a>(<a class="code" href="classvoltdb_1_1SerializeOutput.html">SerializeOutput</a> &amp;output) <span class="keyword">const</span>;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     <span class="comment">/* Serialize this NValue to an Export stream */</span>
<a name="l00320"></a>00320     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d2c344acd24009ca16316be9091f007">serializeToExport_withoutNull</a>(<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html">ExportSerializeOutput</a>&amp;) <span class="keyword">const</span>;
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <span class="comment">// See comment with inlined body, below.  If NULL is supplied for</span>
<a name="l00323"></a>00323     <span class="comment">// the pool, use the temp string pool.</span>
<a name="l00324"></a>00324     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a6a8fc61d7eab259a50bc2a1846558f1d">allocateObjectFromInlinedValue</a>(<a class="code" href="classvoltdb_1_1Pool.html">Pool</a>* pool);
<a name="l00325"></a>00325 
<a name="l00326"></a>00326     <span class="comment">/* Check if the value represents SQL NULL */</span>
<a name="l00327"></a>00327     <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() <span class="keyword">const</span>;
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="comment">/* Check if the value represents IEEE 754 NaN */</span>
<a name="l00330"></a>00330     <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#adb4f22b24452cab40f641c424621ba4e">isNaN</a>() <span class="keyword">const</span>;
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     <span class="comment">/* For boolean NValues, convert to bool */</span>
<a name="l00333"></a>00333     <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#a2efd2a52c08f486da5f379c6ac6a32fc">isTrue</a>() <span class="keyword">const</span>;
<a name="l00334"></a>00334     <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#ab3a6d921f60ebb10a1d539db39c38089">isFalse</a>() <span class="keyword">const</span>;
<a name="l00335"></a>00335 
<a name="l00336"></a>00336     <span class="comment">/* Tell caller if this NValue&apos;s value refers back to VARCHAR or</span>
<a name="l00337"></a>00337 <span class="comment">       VARBINARY data internal to a TableTuple (and not a</span>
<a name="l00338"></a>00338 <span class="comment">       StringRef) */</span>
<a name="l00339"></a>00339     <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#a3402a342cb62159a651623f825ed5e3d">getSourceInlined</a>() <span class="keyword">const</span>;
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     <span class="comment">/* For number values, check the number line. */</span>
<a name="l00342"></a>00342     <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#a4b1d41287bc752d1d1a77a47164b366e">isZero</a>() <span class="keyword">const</span>;
<a name="l00343"></a>00343 
<a name="l00344"></a>00344     <span class="comment">/* For boolean NValues only, logical operators */</span>
<a name="l00345"></a>00345     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ab78b1c7ad1765610c47ac2e6676da501">op_negate</a>() <span class="keyword">const</span>;
<a name="l00346"></a>00346     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a1a71a047b8446062c68f3c396bd46bc7">op_and</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00347"></a>00347     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a4294956d6e81f4b7984a85185c1ce994">op_or</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <span class="comment">/* Evaluate the ordering relation against two NValues. Promotes</span>
<a name="l00350"></a>00350 <span class="comment">       exact types to allow disparate type comparison. See also the</span>
<a name="l00351"></a>00351 <span class="comment">       op_ functions which return boolean NValues.</span>
<a name="l00352"></a>00352 <span class="comment">     */</span>
<a name="l00353"></a>00353     <span class="keywordtype">int</span> <a class="code" href="classvoltdb_1_1NValue.html#a35090b8292141609554abf4201abda02">compareNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00354"></a>00354     <span class="keywordtype">int</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00355"></a>00355     <span class="keywordtype">int</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     <span class="comment">/* Return a boolean NValue with the comparison result */</span>
<a name="l00358"></a>00358     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ac709e560976174bd7007dd52dd9f589e">op_equals</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00359"></a>00359     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#af3272aae43be4235cabd6226fb6404d4">op_notEquals</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00360"></a>00360     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aad91fcf299132a90eb8b0f102a9742b9">op_lessThan</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00361"></a>00361     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a1b57d0f33c04a4b896e4675de1d8ea13">op_lessThanOrEqual</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00362"></a>00362     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ac6c1a187cd80967ec6613cba414ad9b1">op_greaterThan</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00363"></a>00363     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aa2e37b134a97f60c0a264d9459c2b1c8">op_greaterThanOrEqual</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ae70bc292105a4102f81c873cc2f6dcd1">op_equals_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00366"></a>00366     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a6d2b3b98a1e9d3e8ca056ace72642b96">op_notEquals_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00367"></a>00367     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a747a8e64c69a675f545bd172f5351f95">op_lessThan_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00368"></a>00368     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a2afe5bd0c2f8c7b067c3b2a1224cc1b4">op_lessThanOrEqual_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00369"></a>00369     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aed56ac3fdda0424056f74e08881645d3">op_greaterThan_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00370"></a>00370     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a01494d4d2ba2662c2ebba1fefad03f6f">op_greaterThanOrEqual_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     <span class="comment">/* Return a copy of MAX(this, rhs) */</span>
<a name="l00374"></a>00374     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#adbd3180d56c40e167caca4fc6a22401c">op_max</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     <span class="comment">/* Return a copy of MIN(this, rhs) */</span>
<a name="l00377"></a>00377     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a7a086c6020ebd382fe5a2e32852e3167">op_min</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379     <span class="comment">/* For number NValues, compute new NValues for arithmetic operators */</span>
<a name="l00380"></a>00380     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a13fd170affa3767eb7ad731b62438bda">op_increment</a>() <span class="keyword">const</span>;
<a name="l00381"></a>00381     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a5446ad7dad5bdceeb84a54d62d6d13a4">op_decrement</a>() <span class="keyword">const</span>;
<a name="l00382"></a>00382     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a193bee11bf9390ffda7b8b34a86bad1f">op_subtract</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00383"></a>00383     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ac3b1c41c170f8724cf65d09bce5508ee">op_add</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00384"></a>00384     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a0cd4654fecd5e388791ffd26aba6f55c">op_multiply</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00385"></a>00385     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a8175720427be40c7cccddb04c1f16d44">op_divide</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00386"></a>00386     <span class="comment">/*</span>
<a name="l00387"></a>00387 <span class="comment">     * This NValue must be VARCHAR and the rhs must be VARCHAR.</span>
<a name="l00388"></a>00388 <span class="comment">     * This NValue is the value and the rhs is the pattern</span>
<a name="l00389"></a>00389 <span class="comment">     */</span>
<a name="l00390"></a>00390     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aed66e25934b659b4925a0cd652513ecb">like</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs) <span class="keyword">const</span>;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="comment">//TODO: passing NValue arguments by const reference SHOULD be standard practice</span>
<a name="l00393"></a>00393     <span class="comment">// for the dozens of NValue &quot;operator&quot; functions. It saves on needless NValue copies.</span>
<a name="l00394"></a>00394     <span class="comment">//TODO: returning bool (vs. NValue getTrue()/getFalse()) SHOULD be standard practice</span>
<a name="l00395"></a>00395     <span class="comment">// for NValue &quot;logical operator&quot; functions.</span>
<a name="l00396"></a>00396     <span class="comment">// It saves on needless NValue copies and makes unit tests more readable.</span>
<a name="l00397"></a>00397     <span class="comment">// Cases that need the NValue -- for some actual purpose other than an immediate call to</span>
<a name="l00398"></a>00398     <span class="comment">// &quot;isTrue()&quot; -- are rare and getting rarer as optimizations like short-cut eval are introduced.</span>
<a name="l00403"></a>00403 <span class="comment"></span>    <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#ac6dab387ca9fcca7fc6710a25ae8c5c4">inList</a>(<a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <span class="keyword">const</span>&amp; rhsList) <span class="keyword">const</span>;
<a name="l00404"></a>00404 
<a name="l00409"></a>00409     <span class="keywordtype">int</span> <a class="code" href="classvoltdb_1_1NValue.html#a9b86081d03ad76dbc1b09fbd71f4e948">arrayLength</a>() <span class="keyword">const</span>;
<a name="l00410"></a>00410 
<a name="l00415"></a>00415     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a84c0e65edb02819e9fe9483d29b1ae47">itemAtIndex</a>(<span class="keywordtype">int</span> index) <span class="keyword">const</span>;
<a name="l00416"></a>00416 
<a name="l00426"></a>00426     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a9bdcc3a37cb9a9f2e0ca4dc92188e090">castAndSortAndDedupArrayForInList</a>(<span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> outputType, std::vector&lt;NValue&gt; &amp;outList) <span class="keyword">const</span>;
<a name="l00427"></a>00427 
<a name="l00428"></a>00428     <span class="comment">/*</span>
<a name="l00429"></a>00429 <span class="comment">     * Out must have space for 16 bytes</span>
<a name="l00430"></a>00430 <span class="comment">     */</span>
<a name="l00431"></a>00431     int32_t <a class="code" href="classvoltdb_1_1NValue.html#ae755d0db2ec0c566062c59f6791214d3">murmurHash3</a>() <span class="keyword">const</span>;
<a name="l00432"></a>00432 
<a name="l00433"></a>00433     <span class="comment">/*</span>
<a name="l00434"></a>00434 <span class="comment">     * callConstant, callUnary, and call are templates for arbitrary NValue member functions that implement</span>
<a name="l00435"></a>00435 <span class="comment">     * SQL &quot;column functions&quot;. They differ in how many arguments they accept:</span>
<a name="l00436"></a>00436 <span class="comment">     * 0 for callConstant, 1 (&quot;this&quot;) for callUnary, and any number (packaged in a vector) for call.</span>
<a name="l00437"></a>00437 <span class="comment">     * The main benefit of these functions being (always explicit) template instantiations for each</span>
<a name="l00438"></a>00438 <span class="comment">     * &quot;FUNC_*&quot; int value instead of a more normal named member function</span>
<a name="l00439"></a>00439 <span class="comment">     * of NValue is that it allows them to be invoked from the default eval method of the</span>
<a name="l00440"></a>00440 <span class="comment">     * correspondingly templated expression subclass</span>
<a name="l00441"></a>00441 <span class="comment">     * (ConstantFunctionExpression, UnaryFunctionExpression, or GeneralFunctionExpression).</span>
<a name="l00442"></a>00442 <span class="comment">     * The alternative would be to name each function (abs, substring, etc.)</span>
<a name="l00443"></a>00443 <span class="comment">     * and explicitly implement the eval method for every expression subclass template instantiation</span>
<a name="l00444"></a>00444 <span class="comment">     * (UnaryFunctionExpression&lt;FUNC_ABS&gt;::eval,</span>
<a name="l00445"></a>00445 <span class="comment">     * GeneralFunctionExpression&lt;FUNC_VOLT_SUBSTRING_FROM&gt;::eval, etc.</span>
<a name="l00446"></a>00446 <span class="comment">     * to call the corresponding NValue member function.</span>
<a name="l00447"></a>00447 <span class="comment">     * So, these member function templates save a bit of boilerplate for each SQL function and allow</span>
<a name="l00448"></a>00448 <span class="comment">     * the function expression subclass templates to be implemented completely generically.</span>
<a name="l00449"></a>00449 <span class="comment">     */</span>
<a name="l00450"></a>00450     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> F&gt; <span class="comment">// template for SQL functions returning constants (like pi)</span>
<a name="l00451"></a>00451     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a77d915cfffa1e03650ec77fc5878430f">callConstant</a>();
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> F&gt; <span class="comment">// template for SQL functions of one NValue (&quot;this&quot;)</span>
<a name="l00454"></a>00454     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a771f79854bf01f46fc0b1b7c2db47f3e">callUnary</a>() <span class="keyword">const</span>;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="keyword">template</span> &lt;<span class="keywordtype">int</span> F&gt; <span class="comment">// template for SQL functions of multiple NValues</span>
<a name="l00457"></a>00457     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a70c40fb99d941435890b2ac3b12b7d42">call</a>(<span class="keyword">const</span> std::vector&lt;NValue&gt;&amp; arguments);
<a name="l00458"></a>00458 
<a name="l00460"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html">00460</a>     <span class="keyword">class </span><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html" title="Iterates over UTF8 strings one character &amp;quot;code point&amp;quot; at a time, being...">UTF8Iterator</a> {
<a name="l00461"></a>00461     <span class="keyword">public</span>:
<a name="l00462"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a3912a3356e8185f371c90446cbc977a6">00462</a>         <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a3912a3356e8185f371c90446cbc977a6">UTF8Iterator</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *start, <span class="keyword">const</span> <span class="keywordtype">char</span> *end) :
<a name="l00463"></a>00463             <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a>(start),
<a name="l00464"></a>00464             <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>(end)
<a name="l00465"></a>00465             <span class="comment">// TODO: We could validate up front that the string is well-formed UTF8,</span>
<a name="l00466"></a>00466             <span class="comment">// at least to the extent that multi-byte characters have a valid</span>
<a name="l00467"></a>00467             <span class="comment">// prefix byte and continuation bytes that will not cause a read</span>
<a name="l00468"></a>00468             <span class="comment">// off the end of the buffer.</span>
<a name="l00469"></a>00469             <span class="comment">// That done, extractCodePoint could be considerably simpler/faster.</span>
<a name="l00470"></a>00470             { assert(<a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a> &lt;= <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>); }
<a name="l00471"></a>00471 
<a name="l00472"></a>00472         <span class="comment">//Construct a one-off with an alternative current cursor position</span>
<a name="l00473"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a60a51c80e4e762e11e05f7963e739d22">00473</a>         <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a3912a3356e8185f371c90446cbc977a6">UTF8Iterator</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html" title="Iterates over UTF8 strings one character &amp;quot;code point&amp;quot; at a time, being...">UTF8Iterator</a>&amp; other, <span class="keyword">const</span> <span class="keywordtype">char</span> *start) :
<a name="l00474"></a>00474             <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a>(start),
<a name="l00475"></a>00475             <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>(other.<a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>)
<a name="l00476"></a>00476             { assert(<a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a> &lt;= <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>); }
<a name="l00477"></a>00477 
<a name="l00478"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#ab346994d7c35f0ef9fceb182dd26ed66">00478</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#ab346994d7c35f0ef9fceb182dd26ed66">getCursor</a>() { <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a>; }
<a name="l00479"></a>00479 
<a name="l00480"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a4ef60ab7bbb70fe5a483913771e75f44">00480</a>         <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a4ef60ab7bbb70fe5a483913771e75f44">atEnd</a>() { <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a> &gt;= <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>; }
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a0e75d9a00ba69c7fce83ade3ab4ad048">00482</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a0e75d9a00ba69c7fce83ade3ab4ad048">skipCodePoints</a>(int64_t skips) {
<a name="l00483"></a>00483             <span class="keywordflow">while</span> (skips-- &gt; 0 &amp;&amp; ! <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a4ef60ab7bbb70fe5a483913771e75f44">atEnd</a>()) {
<a name="l00484"></a>00484                 <span class="comment">// TODO: since the returned code point is ignored, it might be better</span>
<a name="l00485"></a>00485                 <span class="comment">// to call a faster, simpler, skipCodePoint method -- maybe once that</span>
<a name="l00486"></a>00486                 <span class="comment">// becomes trivial due to up-front validation.</span>
<a name="l00487"></a>00487                 <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#aab8df7e252a6fb77ba947fab3a7de9de">extractCodePoint</a>();
<a name="l00488"></a>00488             }
<a name="l00489"></a>00489             <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a4ef60ab7bbb70fe5a483913771e75f44">atEnd</a>()) {
<a name="l00490"></a>00490                 <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>;
<a name="l00491"></a>00491             }
<a name="l00492"></a>00492             <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a>;
<a name="l00493"></a>00493         }
<a name="l00494"></a>00494 
<a name="l00495"></a>00495         <span class="comment">/*</span>
<a name="l00496"></a>00496 <span class="comment">         * Go through a lot of trouble to make sure that corrupt</span>
<a name="l00497"></a>00497 <span class="comment">         * utf8 data doesn&apos;t result in touching uninitialized memory</span>
<a name="l00498"></a>00498 <span class="comment">         * by copying the character data onto the stack.</span>
<a name="l00499"></a>00499 <span class="comment">         * That wouldn&apos;t be needed if we pre-validated the buffer.</span>
<a name="l00500"></a>00500 <span class="comment">         */</span>
<a name="l00501"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#aab8df7e252a6fb77ba947fab3a7de9de">00501</a>         uint32_t <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#aab8df7e252a6fb77ba947fab3a7de9de">extractCodePoint</a>() {
<a name="l00502"></a>00502             assert(<a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a> &lt; <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>); <span class="comment">// Caller should have tested and handled atEnd() condition</span>
<a name="l00503"></a>00503             <span class="comment">/*</span>
<a name="l00504"></a>00504 <span class="comment">             * Copy the next 6 bytes to a temp buffer and retrieve.</span>
<a name="l00505"></a>00505 <span class="comment">             * We should only get 4 byte code points, and the library</span>
<a name="l00506"></a>00506 <span class="comment">             * should only accept 4 byte code points, but once upon a time there</span>
<a name="l00507"></a>00507 <span class="comment">             * were 6 byte code points in UTF-8 so be careful here.</span>
<a name="l00508"></a>00508 <span class="comment">             */</span>
<a name="l00509"></a>00509             <span class="keywordtype">char</span> nextPotentialCodePoint[] = { 0, 0, 0, 0, 0, 0 };
<a name="l00510"></a>00510             <span class="keywordtype">char</span> *nextPotentialCodePointIter = nextPotentialCodePoint;
<a name="l00511"></a>00511             <span class="comment">//Copy 6 bytes or until the end</span>
<a name="l00512"></a>00512             ::memcpy( nextPotentialCodePoint, <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a>, std::min( 6L, <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a> - m_cursor));
<a name="l00513"></a>00513 
<a name="l00514"></a>00514             <span class="comment">/*</span>
<a name="l00515"></a>00515 <span class="comment">             * Extract the code point, find out how many bytes it was</span>
<a name="l00516"></a>00516 <span class="comment">             */</span>
<a name="l00517"></a>00517             uint32_t codePoint = utf8::unchecked::next(nextPotentialCodePointIter);
<a name="l00518"></a>00518             <span class="keywordtype">long</span> <span class="keywordtype">int</span> delta = nextPotentialCodePointIter - nextPotentialCodePoint;
<a name="l00519"></a>00519 
<a name="l00520"></a>00520             <span class="comment">/*</span>
<a name="l00521"></a>00521 <span class="comment">             * Increment the iterator that was passed in by ref, by the delta</span>
<a name="l00522"></a>00522 <span class="comment">             */</span>
<a name="l00523"></a>00523             m_cursor += delta;
<a name="l00524"></a>00524             <span class="keywordflow">return</span> codePoint;
<a name="l00525"></a>00525         }
<a name="l00526"></a>00526 
<a name="l00527"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">00527</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> * <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#a13c3b649b1e88060fb492afc17abfa0a">m_cursor</a>;
<a name="l00528"></a><a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">00528</a>         <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html#abdaa973d9cc29c3c2996816b0b41b232">m_end</a>;
<a name="l00529"></a>00529     };
<a name="l00530"></a>00530 
<a name="l00531"></a>00531 
<a name="l00532"></a>00532     <span class="comment">/* For boost hashing */</span>
<a name="l00533"></a>00533     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#aada5b31dcd7acf3ff7d42eb00e2200f9">hashCombine</a>(std::size_t &amp;seed) <span class="keyword">const</span>;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535     <span class="comment">/* Functor comparator for use with std::set */</span>
<a name="l00536"></a><a class="code" href="structvoltdb_1_1NValue_1_1ltNValue.html">00536</a>     <span class="keyword">struct </span><a class="code" href="structvoltdb_1_1NValue_1_1ltNValue.html">ltNValue</a> {
<a name="l00537"></a><a class="code" href="structvoltdb_1_1NValue_1_1ltNValue.html#afd1051b28ca511c35f100c495ca72734">00537</a>         <span class="keywordtype">bool</span> <a class="code" href="structvoltdb_1_1NValue_1_1ltNValue.html#afd1051b28ca511c35f100c495ca72734">operator()</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> v1, <span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> v2)<span class="keyword"> const </span>{
<a name="l00538"></a>00538             <span class="keywordflow">return</span> v1.<a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(v2) &lt; 0;
<a name="l00539"></a>00539         }
<a name="l00540"></a>00540     };
<a name="l00541"></a>00541 
<a name="l00542"></a>00542     <span class="comment">/* Functor equality predicate for use with boost unordered */</span>
<a name="l00543"></a><a class="code" href="structvoltdb_1_1NValue_1_1equal__to.html">00543</a>     <span class="keyword">struct </span><a class="code" href="structvoltdb_1_1NValue_1_1equal__to.html">equal_to</a> : std::binary_function&lt;NValue, NValue, bool&gt;
<a name="l00544"></a>00544     {
<a name="l00545"></a><a class="code" href="structvoltdb_1_1NValue_1_1equal__to.html#a3903e1baa1fd6e3fb1eba0d3bb7aa0a5">00545</a>         <span class="keywordtype">bool</span> <a class="code" href="structvoltdb_1_1NValue_1_1equal__to.html#a3903e1baa1fd6e3fb1eba0d3bb7aa0a5">operator()</a>(<a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <span class="keyword">const</span>&amp; x,
<a name="l00546"></a>00546             <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <span class="keyword">const</span>&amp; y)<span class="keyword"> const</span>
<a name="l00547"></a>00547 <span class="keyword">        </span>{
<a name="l00548"></a>00548             <span class="keywordflow">return</span> x.<a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(y) == 0;
<a name="l00549"></a>00549         }
<a name="l00550"></a>00550     };
<a name="l00551"></a>00551 
<a name="l00552"></a>00552     <span class="comment">/* Functor hash predicate for use with boost unordered */</span>
<a name="l00553"></a><a class="code" href="structvoltdb_1_1NValue_1_1hash.html">00553</a>     <span class="keyword">struct </span><a class="code" href="structvoltdb_1_1NValue_1_1hash.html">hash</a> : std::unary_function&lt;NValue, std::size_t&gt;
<a name="l00554"></a>00554     {
<a name="l00555"></a><a class="code" href="structvoltdb_1_1NValue_1_1hash.html#a4e3565decdaf774d7600bb18c2b9c579">00555</a>         std::size_t <a class="code" href="structvoltdb_1_1NValue_1_1hash.html#a4e3565decdaf774d7600bb18c2b9c579">operator()</a>(<a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <span class="keyword">const</span>&amp; x)<span class="keyword"> const</span>
<a name="l00556"></a>00556 <span class="keyword">        </span>{
<a name="l00557"></a>00557             std::size_t seed = 0;
<a name="l00558"></a>00558             x.<a class="code" href="classvoltdb_1_1NValue.html#aada5b31dcd7acf3ff7d42eb00e2200f9">hashCombine</a>(seed);
<a name="l00559"></a>00559             <span class="keywordflow">return</span> seed;
<a name="l00560"></a>00560         }
<a name="l00561"></a>00561     };
<a name="l00562"></a>00562 
<a name="l00563"></a>00563     <span class="comment">/* Return a string full of arcana and wonder. */</span>
<a name="l00564"></a>00564     std::string <a class="code" href="classvoltdb_1_1NValue.html#a91dcb3b560f489eb85afd20e94170ef9">debug</a>() <span class="keyword">const</span>;
<a name="l00565"></a>00565 
<a name="l00566"></a>00566     <span class="comment">// Constants for Decimal type</span>
<a name="l00567"></a>00567     <span class="comment">// Precision and scale (inherent in the schema)</span>
<a name="l00568"></a><a class="code" href="classvoltdb_1_1NValue.html#a92b02d228c0cf751960432638d31cec0">00568</a>     <span class="keyword">static</span> <span class="keyword">const</span> uint16_t <a class="code" href="classvoltdb_1_1NValue.html#a92b02d228c0cf751960432638d31cec0">kMaxDecPrec</a> = 38;
<a name="l00569"></a><a class="code" href="classvoltdb_1_1NValue.html#a944849ac1efbf04fe1b47f378cb7973b">00569</a>     <span class="keyword">static</span> <span class="keyword">const</span> uint16_t <a class="code" href="classvoltdb_1_1NValue.html#a944849ac1efbf04fe1b47f378cb7973b">kMaxDecScale</a> = 12;
<a name="l00570"></a><a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">00570</a>     <span class="keyword">static</span> <span class="keyword">const</span> int64_t <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a> = 1000000000000;
<a name="l00571"></a>00571 
<a name="l00572"></a>00572     <span class="comment">// setArrayElements is a const method since it doesn&apos;t actually mutate any NValue state, just</span>
<a name="l00573"></a>00573     <span class="comment">// the state of the contained NValues which are referenced via the allocated object storage.</span>
<a name="l00574"></a>00574     <span class="comment">// For example, it is not intended to ever &quot;grow the array&quot; which would require the NValue&apos;s</span>
<a name="l00575"></a>00575     <span class="comment">// object reference (in m_data) to be mutable.</span>
<a name="l00576"></a>00576     <span class="comment">// The array size is predetermined in allocateANewNValueList.</span>
<a name="l00577"></a>00577     <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a0fab5a1ebcaf886741113522a4e423be">setArrayElements</a>(std::vector&lt;NValue&gt; &amp;args) <span class="keyword">const</span>;
<a name="l00578"></a>00578 
<a name="l00579"></a><a class="code" href="classvoltdb_1_1NValue.html#a6962d2ac22ab8f66fe65fe64f0ba0186">00579</a>     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> <a class="code" href="classvoltdb_1_1NValue.html#a6962d2ac22ab8f66fe65fe64f0ba0186">promoteForOp</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> vta, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> vtb) {
<a name="l00580"></a>00580         <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> rt;
<a name="l00581"></a>00581         <span class="keywordflow">switch</span> (vta) {
<a name="l00582"></a>00582           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l00583"></a>00583           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l00584"></a>00584           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l00585"></a>00585           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l00586"></a>00586           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l00587"></a>00587             rt = s_intPromotionTable[vtb];
<a name="l00588"></a>00588             <span class="keywordflow">break</span>;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l00591"></a>00591             rt = s_decimalPromotionTable[vtb];
<a name="l00592"></a>00592             <span class="keywordflow">break</span>;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l00595"></a>00595             rt = s_doublePromotionTable[vtb];
<a name="l00596"></a>00596             <span class="keywordflow">break</span>;
<a name="l00597"></a>00597 
<a name="l00598"></a>00598           <span class="comment">// no valid promotion (currently) for these types</span>
<a name="l00599"></a>00599           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>:
<a name="l00600"></a>00600           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l00601"></a>00601           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l00602"></a>00602           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>:
<a name="l00603"></a>00603           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfadf0950da0461f672a649ed99379c3f6f">VALUE_TYPE_INVALID</a>:
<a name="l00604"></a>00604           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>:
<a name="l00605"></a>00605           <span class="keywordflow">default</span>:
<a name="l00606"></a>00606             rt = <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfadf0950da0461f672a649ed99379c3f6f">VALUE_TYPE_INVALID</a>;
<a name="l00607"></a>00607             <span class="keywordflow">break</span>;
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609         <span class="comment">// There ARE rare but legitimate runtime type check exceptions in SQL, so</span>
<a name="l00610"></a>00610         <span class="comment">// unless/until those legitimate cases get re-routed to some other code path,</span>
<a name="l00611"></a>00611         <span class="comment">// it is not safe here to ...</span>
<a name="l00612"></a>00612         <span class="comment">// assert(rt != VALUE_TYPE_INVALID);</span>
<a name="l00613"></a>00613         <span class="keywordflow">return</span> rt;
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616     <span class="comment">// Declared public for cppunit test purposes .</span>
<a name="l00617"></a>00617     <span class="keyword">static</span> int64_t <a class="code" href="classvoltdb_1_1NValue.html#a4e827dbd2e54fcc998ed3baa9e5d4489">parseTimestampString</a>(<span class="keyword">const</span> std::string &amp;txt);
<a name="l00618"></a>00618 
<a name="l00619"></a><a class="code" href="classvoltdb_1_1NValue.html#a7aa6214292ad5a33204fbc21d90f989e">00619</a>     <span class="keyword">static</span> <span class="keyword">inline</span> int32_t <a class="code" href="classvoltdb_1_1NValue.html#a7aa6214292ad5a33204fbc21d90f989e">getCharLength</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *valueChars, <span class="keyword">const</span> <span class="keywordtype">size_t</span> length) {
<a name="l00620"></a>00620         <span class="comment">// very efficient code to count characters in UTF string and ASCII string</span>
<a name="l00621"></a>00621         int32_t j = 0;
<a name="l00622"></a>00622         <span class="keywordtype">size_t</span> i = length;
<a name="l00623"></a>00623         <span class="keywordflow">while</span> (i-- &gt; 0) {
<a name="l00624"></a>00624             <span class="keywordflow">if</span> ((valueChars[i] &amp; 0xc0) != 0x80) j++;
<a name="l00625"></a>00625         }
<a name="l00626"></a>00626         <span class="keywordflow">return</span> j;
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 
<a name="l00629"></a><a class="code" href="classvoltdb_1_1NValue.html#a59f7d72504cdd65fc096b5c122459b98">00629</a>     <span class="keyword">static</span> <span class="keyword">inline</span> int32_t <a class="code" href="classvoltdb_1_1NValue.html#a59f7d72504cdd65fc096b5c122459b98">getIthCharIndex</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *valueChars, <span class="keyword">const</span> int64_t length, <span class="keyword">const</span> int64_t ith) {
<a name="l00630"></a>00630         <span class="keywordflow">if</span> (ith &lt;= 0) <span class="keywordflow">return</span> -1;
<a name="l00631"></a>00631         int32_t i = 0, j = 0;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633         <span class="keywordflow">while</span> (i &lt; length) {
<a name="l00634"></a>00634             <span class="keywordflow">if</span> ((valueChars[i] &amp; 0xc0) != 0x80) {
<a name="l00635"></a>00635                 <span class="keywordflow">if</span> (++j == ith) <span class="keywordflow">break</span>;
<a name="l00636"></a>00636             }
<a name="l00637"></a>00637             i++;
<a name="l00638"></a>00638         }
<a name="l00639"></a>00639         <span class="keywordflow">return</span> i;
<a name="l00640"></a>00640     }
<a name="l00641"></a>00641 
<a name="l00642"></a>00642     <span class="comment">// Return the beginning char * place of the ith char.</span>
<a name="l00643"></a>00643     <span class="comment">// Return the end char* when ith is larger than it has, NULL if ith is less and equal to zero.</span>
<a name="l00644"></a><a class="code" href="classvoltdb_1_1NValue.html#a9e05ee900c76c3e90c6d1456c5aca956">00644</a>     <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="classvoltdb_1_1NValue.html#a9e05ee900c76c3e90c6d1456c5aca956">getIthCharPosition</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *valueChars, <span class="keyword">const</span> <span class="keywordtype">size_t</span> length, <span class="keyword">const</span> int32_t ith) {
<a name="l00645"></a>00645         <span class="comment">// very efficient code to count characters in UTF string and ASCII string</span>
<a name="l00646"></a>00646         int32_t i = <a class="code" href="classvoltdb_1_1NValue.html#a59f7d72504cdd65fc096b5c122459b98">getIthCharIndex</a>(valueChars,length, ith);
<a name="l00647"></a>00647         <span class="keywordflow">if</span> (i &lt; 0) <span class="keywordflow">return</span> NULL;
<a name="l00648"></a>00648         <span class="keywordflow">return</span> &amp;valueChars[i];
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 
<a name="l00652"></a>00652   <span class="keyword">private</span>:
<a name="l00653"></a>00653     <span class="comment">/*</span>
<a name="l00654"></a>00654 <span class="comment">     * Private methods are private for a reason. Don&apos;t expose the raw</span>
<a name="l00655"></a>00655 <span class="comment">     * data so that it can be operated on directly.</span>
<a name="l00656"></a>00656 <span class="comment">     */</span>
<a name="l00657"></a>00657 
<a name="l00658"></a>00658     <span class="comment">// Function declarations for NValue.cpp definitions.</span>
<a name="l00659"></a>00659     <span class="keywordtype">void</span> createDecimalFromString(<span class="keyword">const</span> std::string &amp;txt);
<a name="l00660"></a>00660     std::string createStringFromDecimal() <span class="keyword">const</span>;
<a name="l00661"></a>00661 
<a name="l00662"></a>00662     <span class="comment">// Helpers for inList.</span>
<a name="l00663"></a>00663     <span class="comment">// These are purposely not inlines to avoid exposure of NValueList details.</span>
<a name="l00664"></a>00664     <span class="keywordtype">void</span> deserializeIntoANewNValueList(<a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInputBE</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool);
<a name="l00665"></a>00665     <span class="keywordtype">void</span> allocateANewNValueList(<span class="keywordtype">size_t</span> elementCount, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> elementType);
<a name="l00666"></a>00666 
<a name="l00667"></a>00667     <span class="comment">// Promotion Rules. Initialized in NValue.cpp</span>
<a name="l00668"></a>00668     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> s_intPromotionTable[];
<a name="l00669"></a>00669     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> s_decimalPromotionTable[];
<a name="l00670"></a>00670     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> s_doublePromotionTable[];
<a name="l00671"></a>00671     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> s_maxDecimalValue;
<a name="l00672"></a>00672     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> s_minDecimalValue;
<a name="l00673"></a>00673     <span class="comment">// These initializers give the unique double values that are</span>
<a name="l00674"></a>00674     <span class="comment">// closest but not equal to +/-1E26 within the accuracy of a double.</span>
<a name="l00675"></a>00675     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> s_gtMaxDecimalAsDouble;
<a name="l00676"></a>00676     <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> s_ltMinDecimalAsDouble;
<a name="l00677"></a>00677     <span class="comment">// These are the bound of converting decimal</span>
<a name="l00678"></a>00678     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> s_maxInt64AsDecimal;
<a name="l00679"></a>00679     <span class="keyword">static</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> s_minInt64AsDecimal;
<a name="l00680"></a>00680 
<a name="l00684"></a>00684     <span class="keywordtype">char</span> m_data[16];
<a name="l00685"></a>00685     <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> m_valueType;
<a name="l00686"></a>00686     <span class="keywordtype">bool</span> m_sourceInlined;
<a name="l00687"></a>00687 
<a name="l00692"></a>00692     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a>(<span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type) {
<a name="l00693"></a>00693         ::memset( m_data, 0, 16);
<a name="l00694"></a>00694         setValueType(type);
<a name="l00695"></a>00695         m_sourceInlined = <span class="keyword">false</span>;
<a name="l00696"></a>00696     }
<a name="l00697"></a>00697 
<a name="l00703"></a>00703     <span class="keywordtype">void</span> setValueType(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type) {
<a name="l00704"></a>00704         m_valueType = type;
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706 
<a name="l00711"></a>00711     <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> getValueType()<span class="keyword"> const </span>{
<a name="l00712"></a>00712         <span class="keywordflow">return</span> m_valueType;
<a name="l00713"></a>00713     }
<a name="l00714"></a>00714 
<a name="l00719"></a>00719     std::string getValueTypeString()<span class="keyword"> const </span>{
<a name="l00720"></a>00720         <span class="keywordflow">return</span> <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(m_valueType);
<a name="l00721"></a>00721     }
<a name="l00722"></a>00722 
<a name="l00723"></a>00723     <span class="keywordtype">void</span> setSourceInlined(<span class="keywordtype">bool</span> sourceInlined)
<a name="l00724"></a>00724     {
<a name="l00725"></a>00725         m_sourceInlined = sourceInlined;
<a name="l00726"></a>00726     }
<a name="l00727"></a>00727 
<a name="l00728"></a>00728     <span class="keywordtype">void</span> tagAsNull() { m_data[13] = <a class="code" href="NValue_8hpp.html#a739d0b39c04a69c173db87bce273e19c">OBJECT_NULL_BIT</a>; }
<a name="l00729"></a>00729 
<a name="l00740"></a>00740     int32_t getObjectLength_withoutNull()<span class="keyword"> const </span>{
<a name="l00741"></a>00741         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l00742"></a>00742         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a> || getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>);
<a name="l00743"></a>00743         <span class="comment">// now safe to read and return the length preceding value.</span>
<a name="l00744"></a>00744         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int32_t *<span class="keyword">&gt;</span>(&amp;m_data[8]);
<a name="l00745"></a>00745     }
<a name="l00746"></a>00746 
<a name="l00747"></a>00747 
<a name="l00748"></a>00748     int8_t setObjectLength(int32_t length) {
<a name="l00749"></a>00749         *<span class="keyword">reinterpret_cast&lt;</span>int32_t *<span class="keyword">&gt;</span>(&amp;m_data[8]) = length;
<a name="l00750"></a>00750         int8_t lengthLength = getAppropriateObjectLengthLength(length);
<a name="l00751"></a>00751         setObjectLengthLength(lengthLength);
<a name="l00752"></a>00752         <span class="keywordflow">return</span> lengthLength;
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     <span class="comment">/*</span>
<a name="l00756"></a>00756 <span class="comment">     * Retrieve the number of bytes used by the length preceding value</span>
<a name="l00757"></a>00757 <span class="comment">     * in the object&apos;s storage area. This value</span>
<a name="l00758"></a>00758 <span class="comment">     * is cached in the NValue&apos;s 13th byte.</span>
<a name="l00759"></a>00759 <span class="comment">     */</span>
<a name="l00760"></a>00760     int8_t getObjectLengthLength()<span class="keyword"> const </span>{
<a name="l00761"></a>00761         <span class="keywordflow">return</span> m_data[12];
<a name="l00762"></a>00762     }
<a name="l00763"></a>00763 
<a name="l00764"></a>00764     <span class="comment">/*</span>
<a name="l00765"></a>00765 <span class="comment">     * Set the objects length preceding values length to</span>
<a name="l00766"></a>00766 <span class="comment">     * the specified value</span>
<a name="l00767"></a>00767 <span class="comment">     */</span>
<a name="l00768"></a>00768     <span class="keywordtype">void</span> setObjectLengthLength(int8_t length) {
<a name="l00769"></a>00769         m_data[12] = length;
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     <span class="comment">/*</span>
<a name="l00773"></a>00773 <span class="comment">     * Based on the objects actual length value get the length of the</span>
<a name="l00774"></a>00774 <span class="comment">     * length preceding value to the appropriate length</span>
<a name="l00775"></a>00775 <span class="comment">     */</span>
<a name="l00776"></a>00776     <span class="keyword">static</span> int8_t getAppropriateObjectLengthLength(int32_t length) {
<a name="l00777"></a>00777         <span class="keywordflow">if</span> (length &lt;= <a class="code" href="NValue_8hpp.html#acfd5d895e8bdc4331b1e9ca681653442">OBJECT_MAX_LENGTH_SHORT_LENGTH</a>) {
<a name="l00778"></a>00778             <span class="keywordflow">return</span> <a class="code" href="NValue_8hpp.html#a55aac814b8e8b7d50c07257f51c633fd">SHORT_OBJECT_LENGTHLENGTH</a>;
<a name="l00779"></a>00779         } <span class="keywordflow">else</span> {
<a name="l00780"></a>00780             <span class="keywordflow">return</span> <a class="code" href="NValue_8hpp.html#a0797802e1211ea00e42020de39c5bf03">LONG_OBJECT_LENGTHLENGTH</a>;
<a name="l00781"></a>00781         }
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     <span class="comment">/*</span>
<a name="l00785"></a>00785 <span class="comment">     * Set the length preceding value using the short or long representation depending</span>
<a name="l00786"></a>00786 <span class="comment">     * on what is necessary to represent the length.</span>
<a name="l00787"></a>00787 <span class="comment">     */</span>
<a name="l00788"></a>00788     <span class="keyword">static</span> <span class="keywordtype">void</span> setObjectLengthToLocation(int32_t length, <span class="keywordtype">char</span> *location) {
<a name="l00789"></a>00789         int32_t beNumber = htonl(length);
<a name="l00790"></a>00790         <span class="keywordflow">if</span> (length &lt; -1) {
<a name="l00791"></a>00791             <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#ab96f63f9ce8ae86362975374a237ef38">SQLException::dynamic_sql_error</a>, <span class="stringliteral">&quot;Object length cannot be &lt; -1&quot;</span>);
<a name="l00792"></a>00792         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (length == -1) {
<a name="l00793"></a>00793             location[0] = <a class="code" href="NValue_8hpp.html#a739d0b39c04a69c173db87bce273e19c">OBJECT_NULL_BIT</a>;
<a name="l00794"></a>00794         } <span class="keywordflow">if</span> (length &lt;= <a class="code" href="NValue_8hpp.html#acfd5d895e8bdc4331b1e9ca681653442">OBJECT_MAX_LENGTH_SHORT_LENGTH</a>) {
<a name="l00795"></a>00795             location[0] = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(&amp;beNumber)[3];
<a name="l00796"></a>00796         } <span class="keywordflow">else</span> {
<a name="l00797"></a>00797             <span class="keywordtype">char</span> *pointer = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(&amp;beNumber);
<a name="l00798"></a>00798             location[0] = pointer[0];
<a name="l00799"></a>00799             location[0] |= <a class="code" href="NValue_8hpp.html#ab41edea328152f927ebf6ff9eae5af6c">OBJECT_CONTINUATION_BIT</a>;
<a name="l00800"></a>00800             location[1] = pointer[1];
<a name="l00801"></a>00801             location[2] = pointer[2];
<a name="l00802"></a>00802             location[3] = pointer[3];
<a name="l00803"></a>00803         }
<a name="l00804"></a>00804     }
<a name="l00805"></a>00805 
<a name="l00806"></a>00806     <span class="comment">/*</span>
<a name="l00807"></a>00807 <span class="comment">     * Not truly symmetrical with getObjectValue which returns the actual object past</span>
<a name="l00808"></a>00808 <span class="comment">     * the length preceding value</span>
<a name="l00809"></a>00809 <span class="comment">     */</span>
<a name="l00810"></a>00810     <span class="keywordtype">void</span> setObjectValue(<span class="keywordtype">void</span>* <span class="keywordtype">object</span>) {
<a name="l00811"></a>00811         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>**<span class="keyword">&gt;</span>(m_data) = <span class="keywordtype">object</span>;
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813 
<a name="l00814"></a>00814     <span class="keywordtype">void</span>* getObjectValue_withoutNull()<span class="keyword"> const </span>{
<a name="l00815"></a>00815         <span class="keywordtype">void</span>* value;
<a name="l00816"></a>00816         <span class="keywordflow">if</span> (m_sourceInlined) {
<a name="l00817"></a>00817             value = *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>* const*<span class="keyword">&gt;</span>(m_data) + getObjectLengthLength();
<a name="l00818"></a>00818         }
<a name="l00819"></a>00819         <span class="keywordflow">else</span> {
<a name="l00820"></a>00820             StringRef* sref = *<span class="keyword">reinterpret_cast&lt;</span>StringRef* const*<span class="keyword">&gt;</span>(m_data);
<a name="l00821"></a>00821             value = sref-&gt;get() + getObjectLengthLength();
<a name="l00822"></a>00822         }
<a name="l00823"></a>00823         <span class="keywordflow">return</span> value;
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825 
<a name="l00829"></a>00829     <span class="keywordtype">void</span>* getObjectValue()<span class="keyword"> const </span>{
<a name="l00830"></a>00830         <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l00831"></a>00831             <span class="keywordflow">return</span> NULL;
<a name="l00832"></a>00832         }
<a name="l00833"></a>00833         <span class="keywordflow">return</span> getObjectValue_withoutNull();
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836     <span class="comment">// getters</span>
<a name="l00837"></a>00837     <span class="keyword">const</span> int8_t&amp; getTinyInt()<span class="keyword"> const </span>{
<a name="l00838"></a>00838         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>);
<a name="l00839"></a>00839         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int8_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00840"></a>00840     }
<a name="l00841"></a>00841 
<a name="l00842"></a>00842     int8_t&amp; getTinyInt() {
<a name="l00843"></a>00843         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>);
<a name="l00844"></a>00844         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span>int8_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00845"></a>00845     }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <span class="keyword">const</span> int16_t&amp; getSmallInt()<span class="keyword"> const </span>{
<a name="l00848"></a>00848         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>);
<a name="l00849"></a>00849         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int16_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00850"></a>00850     }
<a name="l00851"></a>00851 
<a name="l00852"></a>00852     int16_t&amp; getSmallInt() {
<a name="l00853"></a>00853         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>);
<a name="l00854"></a>00854         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span>int16_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00855"></a>00855     }
<a name="l00856"></a>00856 
<a name="l00857"></a>00857     <span class="keyword">const</span> int32_t&amp; getInteger()<span class="keyword"> const </span>{
<a name="l00858"></a>00858         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l00859"></a>00859         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int32_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00860"></a>00860     }
<a name="l00861"></a>00861 
<a name="l00862"></a>00862     int32_t&amp; getInteger() {
<a name="l00863"></a>00863         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l00864"></a>00864         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span>int32_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00865"></a>00865     }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867     <span class="keyword">const</span> int64_t&amp; getBigInt()<span class="keyword"> const </span>{
<a name="l00868"></a>00868         assert((getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>) ||
<a name="l00869"></a>00869                (getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>) ||
<a name="l00870"></a>00870                (getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>));
<a name="l00871"></a>00871         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int64_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00872"></a>00872     }
<a name="l00873"></a>00873 
<a name="l00874"></a>00874     int64_t&amp; getBigInt() {
<a name="l00875"></a>00875         assert((getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>) ||
<a name="l00876"></a>00876                (getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>) ||
<a name="l00877"></a>00877                (getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>));
<a name="l00878"></a>00878         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00879"></a>00879     }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881     <span class="keyword">const</span> int64_t&amp; getTimestamp()<span class="keyword"> const </span>{
<a name="l00882"></a>00882         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>);
<a name="l00883"></a>00883         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int64_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00884"></a>00884     }
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     int64_t&amp; getTimestamp() {
<a name="l00887"></a>00887         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>);
<a name="l00888"></a>00888         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(m_data);
<a name="l00889"></a>00889     }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891     <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; getDouble()<span class="keyword"> const </span>{
<a name="l00892"></a>00892         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>);
<a name="l00893"></a>00893         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(m_data);
<a name="l00894"></a>00894     }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896     <span class="keywordtype">double</span>&amp; getDouble() {
<a name="l00897"></a>00897         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>);
<a name="l00898"></a>00898         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(m_data);
<a name="l00899"></a>00899     }
<a name="l00900"></a>00900 
<a name="l00901"></a>00901     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>&amp; getDecimal()<span class="keyword"> const </span>{
<a name="l00902"></a>00902         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l00903"></a>00903         <span class="keyword">const</span> <span class="keywordtype">void</span>* retval = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(m_data);
<a name="l00904"></a>00904         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>*<span class="keyword">&gt;</span>(retval);
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907     <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>&amp; getDecimal() {
<a name="l00908"></a>00908         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l00909"></a>00909         <span class="keywordtype">void</span>* retval = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(m_data);
<a name="l00910"></a>00910         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>*<span class="keyword">&gt;</span>(retval);
<a name="l00911"></a>00911     }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913     <span class="keyword">const</span> <span class="keywordtype">bool</span>&amp; getBoolean()<span class="keyword"> const </span>{
<a name="l00914"></a>00914         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>);
<a name="l00915"></a>00915         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">bool</span>*<span class="keyword">&gt;</span>(m_data);
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="keywordtype">bool</span>&amp; getBoolean() {
<a name="l00919"></a>00919         assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>);
<a name="l00920"></a>00920         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">bool</span>*<span class="keyword">&gt;</span>(m_data);
<a name="l00921"></a>00921     }
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="keywordtype">bool</span> isBooleanNULL() <span class="keyword">const</span> ;
<a name="l00924"></a>00924 
<a name="l00925"></a>00925     std::size_t getAllocationSizeForObject() <span class="keyword">const</span>;
<a name="l00926"></a>00926     <span class="keyword">static</span> std::size_t getAllocationSizeForObject(int32_t length);
<a name="l00927"></a>00927 
<a name="l00928"></a>00928     <span class="keyword">static</span> <span class="keywordtype">void</span> throwCastSQLException(<span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> origType,
<a name="l00929"></a>00929                                       <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> newType)
<a name="l00930"></a>00930     {
<a name="l00931"></a>00931         <span class="keywordtype">char</span> msg[1024];
<a name="l00932"></a>00932         snprintf(msg, 1024, <span class="stringliteral">&quot;Type %s can&apos;t be cast as %s&quot;</span>,
<a name="l00933"></a>00933                  <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(origType).c_str(),
<a name="l00934"></a>00934                  <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(newType).c_str());
<a name="l00935"></a>00935         <span class="keywordflow">throw</span> SQLException(SQLException::
<a name="l00936"></a>00936                            data_exception_most_specific_type_mismatch,
<a name="l00937"></a>00937                            msg);
<a name="l00938"></a>00938     }
<a name="l00939"></a>00939 
<a name="l00941"></a>00941     <span class="keyword">static</span> <span class="keyword">inline</span> int64_t narrowDecimalToBigInt(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> &amp;scaledValue) {
<a name="l00942"></a>00942         <span class="keywordflow">if</span> (scaledValue &gt; NValue::s_maxInt64AsDecimal || scaledValue &lt; NValue::s_minInt64AsDecimal) {
<a name="l00943"></a>00943             <a class="code" href="namespacevoltdb.html#a4a0a0f6edbe011a7c303306b3244abc7">throwCastSQLValueOutOfRangeException&lt;TTInt&gt;</a>(scaledValue, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l00944"></a>00944         }
<a name="l00945"></a>00945         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> whole(scaledValue);
<a name="l00946"></a>00946         whole /= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l00947"></a>00947         <span class="keywordflow">return</span> whole.ToInt();
<a name="l00948"></a>00948     }
<a name="l00949"></a>00949 
<a name="l00951"></a>00951     <span class="keyword">static</span> <span class="keyword">inline</span> int64_t getFractionalPart(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>&amp; scaledValue) {
<a name="l00952"></a>00952         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> fractional(scaledValue);
<a name="l00953"></a>00953         fractional %= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l00954"></a>00954         <span class="keywordflow">return</span> fractional.ToInt();
<a name="l00955"></a>00955     }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     int64_t castAsBigIntAndGetValue()<span class="keyword"> const </span>{
<a name="l00958"></a>00958         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l00959"></a>00959 
<a name="l00960"></a>00960         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l00961"></a>00961         assert(type != <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>);
<a name="l00962"></a>00962         <span class="keywordflow">switch</span> (type) {
<a name="l00963"></a>00963         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l00964"></a>00964             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getTinyInt());
<a name="l00965"></a>00965         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l00966"></a>00966             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getSmallInt());
<a name="l00967"></a>00967         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l00968"></a>00968             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getInteger());
<a name="l00969"></a>00969         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l00970"></a>00970             <span class="keywordflow">return</span> getBigInt();
<a name="l00971"></a>00971         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l00972"></a>00972             <span class="keywordflow">return</span> getTimestamp();
<a name="l00973"></a>00973         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l00974"></a>00974             <span class="keywordflow">if</span> (getDouble() &gt; (<span class="keywordtype">double</span>)INT64_MAX || getDouble() &lt; (<span class="keywordtype">double</span>)<a class="code" href="value__defs_8h.html#a7752e67bdf97fc19fd7415697c19629e">VOLT_INT64_MIN</a>) {
<a name="l00975"></a>00975                 <a class="code" href="namespacevoltdb.html#a10c377bb16b21d9a907063cd8fa277db">throwCastSQLValueOutOfRangeException&lt;double&gt;</a>(getDouble(), <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l00976"></a>00976             }
<a name="l00977"></a>00977             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getDouble());
<a name="l00978"></a>00978         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>:
<a name="l00979"></a>00979             <span class="keywordflow">return</span> getBigInt();
<a name="l00980"></a>00980         <span class="keywordflow">default</span>:
<a name="l00981"></a>00981             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l00982"></a>00982             <span class="keywordflow">return</span> 0; <span class="comment">// NOT REACHED</span>
<a name="l00983"></a>00983         }
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     int64_t castAsRawInt64AndGetValue()<span class="keyword"> const </span>{
<a name="l00987"></a>00987         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l00988"></a>00988 
<a name="l00989"></a>00989         <span class="keywordflow">switch</span> (type) {
<a name="l00990"></a>00990         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l00991"></a>00991             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getTinyInt());
<a name="l00992"></a>00992         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l00993"></a>00993             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getSmallInt());
<a name="l00994"></a>00994         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l00995"></a>00995             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getInteger());
<a name="l00996"></a>00996         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l00997"></a>00997             <span class="keywordflow">return</span> getBigInt();
<a name="l00998"></a>00998         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l00999"></a>00999             <span class="keywordflow">return</span> getTimestamp();
<a name="l01000"></a>01000         <span class="keywordflow">default</span>:
<a name="l01001"></a>01001             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l01002"></a>01002             <span class="keywordflow">return</span> 0; <span class="comment">// NOT REACHED</span>
<a name="l01003"></a>01003         }
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005 
<a name="l01006"></a>01006     int32_t castAsIntegerAndGetValue()<span class="keyword"> const </span>{
<a name="l01007"></a>01007         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01008"></a>01008 
<a name="l01009"></a>01009         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01010"></a>01010         <span class="keywordflow">switch</span> (type) {
<a name="l01011"></a>01011         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>:
<a name="l01012"></a>01012             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a7b37f75b664751ae17bd3a801355bd7e">INT32_NULL</a>;
<a name="l01013"></a>01013         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01014"></a>01014             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(getTinyInt());
<a name="l01015"></a>01015         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01016"></a>01016             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(getSmallInt());
<a name="l01017"></a>01017         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01018"></a>01018             <span class="keywordflow">return</span> getInteger();
<a name="l01019"></a>01019         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01020"></a>01020         {
<a name="l01021"></a>01021             <span class="keyword">const</span> int64_t value = getBigInt();
<a name="l01022"></a>01022             <span class="keywordflow">if</span> (value &gt; (int64_t)INT32_MAX || value &lt; (int64_t)<a class="code" href="value__defs_8h.html#a24d61a07215d5575d7f911bdeeaeb4d7">VOLT_INT32_MIN</a>) {
<a name="l01023"></a>01023                 <a class="code" href="namespacevoltdb.html#a3167aecefa48bcba64446e1ac39f13f6">throwCastSQLValueOutOfRangeException&lt;int64_t&gt;</a>(value, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l01024"></a>01024             }
<a name="l01025"></a>01025             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(value);
<a name="l01026"></a>01026         }
<a name="l01027"></a>01027         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01028"></a>01028         {
<a name="l01029"></a>01029             <span class="keyword">const</span> <span class="keywordtype">double</span> value = getDouble();
<a name="l01030"></a>01030             <span class="keywordflow">if</span> (value &gt; (<span class="keywordtype">double</span>)INT32_MAX || value &lt; (<span class="keywordtype">double</span>)<a class="code" href="value__defs_8h.html#a24d61a07215d5575d7f911bdeeaeb4d7">VOLT_INT32_MIN</a>) {
<a name="l01031"></a>01031                 <a class="code" href="namespacevoltdb.html#a30d1fb04637ce4bce79c33b9e1526827">throwCastSQLValueOutOfRangeException</a>(value, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l01032"></a>01032             }
<a name="l01033"></a>01033             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(value);
<a name="l01034"></a>01034         }
<a name="l01035"></a>01035         <span class="keywordflow">default</span>:
<a name="l01036"></a>01036             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l01037"></a>01037             <span class="keywordflow">return</span> 0; <span class="comment">// NOT REACHED</span>
<a name="l01038"></a>01038         }
<a name="l01039"></a>01039     }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041     <span class="keywordtype">double</span> castAsDoubleAndGetValue()<span class="keyword"> const </span>{
<a name="l01042"></a>01042         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01045"></a>01045 
<a name="l01046"></a>01046         <span class="keywordflow">switch</span> (type) {
<a name="l01047"></a>01047           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>:
<a name="l01048"></a>01048               <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a526639fcb172e9377c68fc180820269d">DOUBLE_MIN</a>;
<a name="l01049"></a>01049           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01050"></a>01050             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getTinyInt());
<a name="l01051"></a>01051           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01052"></a>01052             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getSmallInt());
<a name="l01053"></a>01053           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01054"></a>01054             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getInteger());
<a name="l01055"></a>01055           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>:
<a name="l01056"></a>01056             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getBigInt());
<a name="l01057"></a>01057           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01058"></a>01058             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getBigInt());
<a name="l01059"></a>01059           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01060"></a>01060             <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getTimestamp());
<a name="l01061"></a>01061           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01062"></a>01062             <span class="keywordflow">return</span> getDouble();
<a name="l01063"></a>01063           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l01064"></a>01064           {
<a name="l01065"></a>01065             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = getDecimal();
<a name="l01066"></a>01066             <span class="comment">// we only deal with the decimal number within int64_t range here</span>
<a name="l01067"></a>01067             int64_t whole = narrowDecimalToBigInt(scaledValue);
<a name="l01068"></a>01068             int64_t fractional = getFractionalPart(scaledValue);
<a name="l01069"></a>01069             <span class="keywordtype">double</span> retval;
<a name="l01070"></a>01070             retval = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(whole) +
<a name="l01071"></a>01071                     (static_cast&lt;double&gt;(fractional)/<span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>));
<a name="l01072"></a>01072             <span class="keywordflow">return</span> retval;
<a name="l01073"></a>01073           }
<a name="l01074"></a>01074           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01075"></a>01075           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01076"></a>01076           <span class="keywordflow">default</span>:
<a name="l01077"></a>01077             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>);
<a name="l01078"></a>01078             <span class="keywordflow">return</span> 0; <span class="comment">// NOT REACHED</span>
<a name="l01079"></a>01079         }
<a name="l01080"></a>01080     }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082     <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> castAsDecimalAndGetValue()<span class="keyword"> const </span>{
<a name="l01083"></a>01083         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01084"></a>01084 
<a name="l01085"></a>01085         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01086"></a>01086 
<a name="l01087"></a>01087         <span class="keywordflow">switch</span> (type) {
<a name="l01088"></a>01088           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01089"></a>01089           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01090"></a>01090           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01091"></a>01091           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01092"></a>01092           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>: {
<a name="l01093"></a>01093             int64_t value = castAsRawInt64AndGetValue();
<a name="l01094"></a>01094             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> retval(value);
<a name="l01095"></a>01095             retval *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01096"></a>01096             <span class="keywordflow">return</span> retval;
<a name="l01097"></a>01097           }
<a name="l01098"></a>01098           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l01099"></a>01099               <span class="keywordflow">return</span> getDecimal();
<a name="l01100"></a>01100           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>: {
<a name="l01101"></a>01101             int64_t intValue = castAsBigIntAndGetValue();
<a name="l01102"></a>01102             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> retval(intValue);
<a name="l01103"></a>01103             retval *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01104"></a>01104 
<a name="l01105"></a>01105             <span class="keywordtype">double</span> value = getDouble();
<a name="l01106"></a>01106             value -= <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(intValue); <span class="comment">// isolate decimal part</span>
<a name="l01107"></a>01107             value *= <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>); <span class="comment">// scale up to integer.</span>
<a name="l01108"></a>01108             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> fracval((int64_t)value);
<a name="l01109"></a>01109             retval += fracval;
<a name="l01110"></a>01110             <span class="keywordflow">return</span> retval;
<a name="l01111"></a>01111           }
<a name="l01112"></a>01112           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01113"></a>01113           <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01114"></a>01114           <span class="keywordflow">default</span>:
<a name="l01115"></a>01115             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l01116"></a>01116             <span class="keywordflow">return</span> 0; <span class="comment">// NOT REACHED</span>
<a name="l01117"></a>01117         }
<a name="l01118"></a>01118     }
<a name="l01119"></a>01119 
<a name="l01123"></a>01123     <span class="keywordtype">double</span> getNumberFromString()<span class="keyword"> const</span>
<a name="l01124"></a>01124 <span class="keyword">    </span>{
<a name="l01125"></a>01125         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01126"></a>01126 
<a name="l01127"></a>01127         <span class="keyword">const</span> int32_t strLength = getObjectLength_withoutNull();
<a name="l01128"></a>01128         <span class="comment">// Guarantee termination at end of object -- or strtod might not stop there.</span>
<a name="l01129"></a>01129         <span class="keywordtype">char</span> safeBuffer[strLength+1];
<a name="l01130"></a>01130         memcpy(safeBuffer, getObjectValue_withoutNull(), strLength);
<a name="l01131"></a>01131         safeBuffer[strLength] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l01132"></a>01132         <span class="keywordtype">char</span> * bufferEnd = safeBuffer;
<a name="l01133"></a>01133         <span class="keywordtype">double</span> result = strtod(safeBuffer, &amp;bufferEnd);
<a name="l01134"></a>01134         <span class="comment">// Needs to have consumed SOMETHING.</span>
<a name="l01135"></a>01135         <span class="keywordflow">if</span> (bufferEnd &gt; safeBuffer) {
<a name="l01136"></a>01136             <span class="comment">// Unconsumed trailing chars are OK if they are whitespace.</span>
<a name="l01137"></a>01137             <span class="keywordflow">while</span> (bufferEnd &lt; safeBuffer+strLength &amp;&amp; isspace(*bufferEnd)) {
<a name="l01138"></a>01138                 ++bufferEnd;
<a name="l01139"></a>01139             }
<a name="l01140"></a>01140             <span class="keywordflow">if</span> (bufferEnd == safeBuffer+strLength) {
<a name="l01141"></a>01141                 <span class="keywordflow">return</span> result;
<a name="l01142"></a>01142             }
<a name="l01143"></a>01143         }
<a name="l01144"></a>01144 
<a name="l01145"></a>01145         std::ostringstream oss;
<a name="l01146"></a>01146         oss &lt;&lt; <span class="stringliteral">&quot;Could not convert to number: &apos;&quot;</span> &lt;&lt; safeBuffer &lt;&lt; <span class="stringliteral">&quot;&apos; contains invalid character value.&quot;</span>;
<a name="l01147"></a>01147         <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a84d254fbaa2071cffa421833e7abc2de">SQLException::data_exception_invalid_character_value_for_cast</a>, oss.str().c_str());
<a name="l01148"></a>01148     }
<a name="l01149"></a>01149 
<a name="l01150"></a>01150     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsBigInt()<span class="keyword"> const </span>{
<a name="l01151"></a>01151         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01152"></a>01152 
<a name="l01153"></a>01153         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l01154"></a>01154         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01155"></a>01155         <span class="keywordflow">switch</span> (type) {
<a name="l01156"></a>01156         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01157"></a>01157             retval.getBigInt() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getTinyInt()); <span class="keywordflow">break</span>;
<a name="l01158"></a>01158         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01159"></a>01159             retval.getBigInt() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getSmallInt()); <span class="keywordflow">break</span>;
<a name="l01160"></a>01160         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01161"></a>01161             retval.getBigInt() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getInteger()); <span class="keywordflow">break</span>;
<a name="l01162"></a>01162         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>:
<a name="l01163"></a>01163             retval.getBigInt() = getBigInt(); <span class="keywordflow">break</span>;
<a name="l01164"></a>01164         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01165"></a>01165             <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01166"></a>01166         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01167"></a>01167             retval.getBigInt() = getTimestamp(); <span class="keywordflow">break</span>;
<a name="l01168"></a>01168         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01169"></a>01169             <span class="keywordflow">if</span> (getDouble() &gt; (<span class="keywordtype">double</span>)INT64_MAX || getDouble() &lt; (<span class="keywordtype">double</span>)<a class="code" href="value__defs_8h.html#a7752e67bdf97fc19fd7415697c19629e">VOLT_INT64_MIN</a>) {
<a name="l01170"></a>01170                 <a class="code" href="namespacevoltdb.html#a10c377bb16b21d9a907063cd8fa277db">throwCastSQLValueOutOfRangeException&lt;double&gt;</a>(getDouble(), <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l01171"></a>01171             }
<a name="l01172"></a>01172             retval.getBigInt() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getDouble()); <span class="keywordflow">break</span>;
<a name="l01173"></a>01173         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l01174"></a>01174             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = getDecimal();
<a name="l01175"></a>01175             retval.getBigInt() = narrowDecimalToBigInt(scaledValue); <span class="keywordflow">break</span>;
<a name="l01176"></a>01176         }
<a name="l01177"></a>01177         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01178"></a>01178             retval.getBigInt() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getNumberFromString()); <span class="keywordflow">break</span>;
<a name="l01179"></a>01179         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01180"></a>01180         <span class="keywordflow">default</span>:
<a name="l01181"></a>01181             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l01182"></a>01182         }
<a name="l01183"></a>01183         <span class="keywordflow">return</span> retval;
<a name="l01184"></a>01184     }
<a name="l01185"></a>01185 
<a name="l01186"></a>01186     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsTimestamp()<span class="keyword"> const </span>{
<a name="l01187"></a>01187         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01188"></a>01188 
<a name="l01189"></a>01189         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>);
<a name="l01190"></a>01190         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01191"></a>01191         <span class="keywordflow">switch</span> (type) {
<a name="l01192"></a>01192         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01193"></a>01193             retval.getTimestamp() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getTinyInt()); <span class="keywordflow">break</span>;
<a name="l01194"></a>01194         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01195"></a>01195             retval.getTimestamp() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getSmallInt()); <span class="keywordflow">break</span>;
<a name="l01196"></a>01196         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01197"></a>01197             retval.getTimestamp() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getInteger()); <span class="keywordflow">break</span>;
<a name="l01198"></a>01198         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01199"></a>01199             retval.getTimestamp() = getBigInt(); <span class="keywordflow">break</span>;
<a name="l01200"></a>01200         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01201"></a>01201             retval.getTimestamp() = getTimestamp(); <span class="keywordflow">break</span>;
<a name="l01202"></a>01202         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01203"></a>01203             <span class="comment">// TODO: Consider just eliminating this switch case to throw a cast exception,</span>
<a name="l01204"></a>01204             <span class="comment">// or explicitly throwing some other exception here.</span>
<a name="l01205"></a>01205             <span class="comment">// Direct cast of double to timestamp (implemented via intermediate cast to integer, here)</span>
<a name="l01206"></a>01206             <span class="comment">// is not a SQL standard requirement, may not even make it past the planner&apos;s type-checks,</span>
<a name="l01207"></a>01207             <span class="comment">// or may just be too far a stretch.</span>
<a name="l01208"></a>01208             <span class="comment">// OR it might be a convenience for some obscure system-generated edge case?</span>
<a name="l01209"></a>01209 
<a name="l01210"></a>01210             <span class="keywordflow">if</span> (getDouble() &gt; (<span class="keywordtype">double</span>)INT64_MAX || getDouble() &lt; (<span class="keywordtype">double</span>)VOLT_INT64_MIN) {
<a name="l01211"></a>01211                 <a class="code" href="namespacevoltdb.html#a10c377bb16b21d9a907063cd8fa277db">throwCastSQLValueOutOfRangeException&lt;double&gt;</a>(getDouble(), <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l01212"></a>01212             }
<a name="l01213"></a>01213             retval.getTimestamp() = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getDouble()); <span class="keywordflow">break</span>;
<a name="l01214"></a>01214         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l01215"></a>01215             <span class="comment">// TODO: Consider just eliminating this switch case to throw a cast exception,</span>
<a name="l01216"></a>01216             <span class="comment">// or explicitly throwing some other exception here.</span>
<a name="l01217"></a>01217             <span class="comment">// Direct cast of decimal to timestamp (implemented via intermediate cast to integer, here)</span>
<a name="l01218"></a>01218             <span class="comment">// is not a SQL standard requirement, may not even make it past the planner&apos;s type-checks,</span>
<a name="l01219"></a>01219             <span class="comment">// or may just be too far a stretch.</span>
<a name="l01220"></a>01220             <span class="comment">// OR it might be a convenience for some obscure system-generated edge case?</span>
<a name="l01221"></a>01221 
<a name="l01222"></a>01222             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = getDecimal();
<a name="l01223"></a>01223             retval.getTimestamp() = narrowDecimalToBigInt(scaledValue); <span class="keywordflow">break</span>;
<a name="l01224"></a>01224         }
<a name="l01225"></a>01225         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>: {
<a name="l01226"></a>01226             <span class="keyword">const</span> int32_t length = getObjectLength_withoutNull();
<a name="l01227"></a>01227             <span class="keyword">const</span> <span class="keywordtype">char</span>* bytes = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l01228"></a>01228             <span class="keyword">const</span> std::string value(bytes, length);
<a name="l01229"></a>01229             retval.getTimestamp() = <a class="code" href="classvoltdb_1_1NValue.html#a4e827dbd2e54fcc998ed3baa9e5d4489">parseTimestampString</a>(value);
<a name="l01230"></a>01230             <span class="keywordflow">break</span>;
<a name="l01231"></a>01231         }
<a name="l01232"></a>01232         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01233"></a>01233         <span class="keywordflow">default</span>:
<a name="l01234"></a>01234             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>);
<a name="l01235"></a>01235         }
<a name="l01236"></a>01236         <span class="keywordflow">return</span> retval;
<a name="l01237"></a>01237     }
<a name="l01238"></a>01238 
<a name="l01239"></a>01239     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l01240"></a>01240     <span class="keywordtype">void</span> narrowToInteger(<span class="keyword">const</span> T value, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> sourceType)
<a name="l01241"></a>01241     {
<a name="l01242"></a>01242         <span class="keywordflow">if</span> (value &gt; (T)INT32_MAX || value &lt; (T)<a class="code" href="value__defs_8h.html#a24d61a07215d5575d7f911bdeeaeb4d7">VOLT_INT32_MIN</a>) {
<a name="l01243"></a>01243             <a class="code" href="namespacevoltdb.html#a30d1fb04637ce4bce79c33b9e1526827">throwCastSQLValueOutOfRangeException</a>(value, sourceType, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l01244"></a>01244         }
<a name="l01245"></a>01245         getInteger() = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(value);
<a name="l01246"></a>01246     }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsInteger()<span class="keyword"> const </span>{
<a name="l01249"></a>01249         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l01250"></a>01250         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01251"></a>01251         <span class="keywordflow">switch</span> (type) {
<a name="l01252"></a>01252         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01253"></a>01253             retval.getInteger() = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(getTinyInt()); <span class="keywordflow">break</span>;
<a name="l01254"></a>01254         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01255"></a>01255             retval.getInteger() = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(getSmallInt()); <span class="keywordflow">break</span>;
<a name="l01256"></a>01256         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01257"></a>01257             <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l01258"></a>01258         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01259"></a>01259             retval.narrowToInteger(getBigInt(), type); <span class="keywordflow">break</span>;
<a name="l01260"></a>01260         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01261"></a>01261             retval.narrowToInteger(getTimestamp(), type); <span class="keywordflow">break</span>;
<a name="l01262"></a>01262         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01263"></a>01263             retval.narrowToInteger(getDouble(), type); <span class="keywordflow">break</span>;
<a name="l01264"></a>01264         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l01265"></a>01265             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = getDecimal();
<a name="l01266"></a>01266             <span class="comment">// get the whole part of the decimal</span>
<a name="l01267"></a>01267             int64_t whole = narrowDecimalToBigInt(scaledValue);
<a name="l01268"></a>01268             <span class="comment">// try to convert the whole part, which is a int64_t</span>
<a name="l01269"></a>01269             retval.narrowToInteger(whole, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>); <span class="keywordflow">break</span>;
<a name="l01270"></a>01270         }
<a name="l01271"></a>01271         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01272"></a>01272             retval.narrowToInteger(getNumberFromString(), type); <span class="keywordflow">break</span>;
<a name="l01273"></a>01273         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01274"></a>01274         <span class="keywordflow">default</span>:
<a name="l01275"></a>01275             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l01276"></a>01276         }
<a name="l01277"></a>01277         <span class="keywordflow">return</span> retval;
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279 
<a name="l01280"></a>01280     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l01281"></a>01281     <span class="keywordtype">void</span> narrowToSmallInt(<span class="keyword">const</span> T value, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> sourceType)
<a name="l01282"></a>01282     {
<a name="l01283"></a>01283         <span class="keywordflow">if</span> (value &gt; (T)INT16_MAX || value &lt; (T)<a class="code" href="value__defs_8h.html#a7da6c3e8db01b49f2816852c9d9898fa">VOLT_INT16_MIN</a>) {
<a name="l01284"></a>01284             <a class="code" href="namespacevoltdb.html#a30d1fb04637ce4bce79c33b9e1526827">throwCastSQLValueOutOfRangeException</a>(value, sourceType, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>);
<a name="l01285"></a>01285         }
<a name="l01286"></a>01286         getSmallInt() = <span class="keyword">static_cast&lt;</span>int16_t<span class="keyword">&gt;</span>(value);
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288 
<a name="l01289"></a>01289     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsSmallInt()<span class="keyword"> const </span>{
<a name="l01290"></a>01290         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01291"></a>01291 
<a name="l01292"></a>01292         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>);
<a name="l01293"></a>01293         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01294"></a>01294         <span class="keywordflow">switch</span> (type) {
<a name="l01295"></a>01295         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01296"></a>01296             retval.getSmallInt() = <span class="keyword">static_cast&lt;</span>int16_t<span class="keyword">&gt;</span>(getTinyInt()); <span class="keywordflow">break</span>;
<a name="l01297"></a>01297         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01298"></a>01298             retval.getSmallInt() = getSmallInt(); <span class="keywordflow">break</span>;
<a name="l01299"></a>01299         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01300"></a>01300             retval.narrowToSmallInt(getInteger(), type); <span class="keywordflow">break</span>;
<a name="l01301"></a>01301         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01302"></a>01302             retval.narrowToSmallInt(getBigInt(), type); <span class="keywordflow">break</span>;
<a name="l01303"></a>01303         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01304"></a>01304             retval.narrowToSmallInt(getTimestamp(), type); <span class="keywordflow">break</span>;
<a name="l01305"></a>01305         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01306"></a>01306             retval.narrowToSmallInt(getDouble(), type); <span class="keywordflow">break</span>;
<a name="l01307"></a>01307         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l01308"></a>01308             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = getDecimal();
<a name="l01309"></a>01309             int64_t whole = narrowDecimalToBigInt(scaledValue);
<a name="l01310"></a>01310             retval.narrowToSmallInt(whole, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>); <span class="keywordflow">break</span>;
<a name="l01311"></a>01311         }
<a name="l01312"></a>01312         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01313"></a>01313             retval.narrowToSmallInt(getNumberFromString(), type); <span class="keywordflow">break</span>;
<a name="l01314"></a>01314         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01315"></a>01315         <span class="keywordflow">default</span>:
<a name="l01316"></a>01316             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>);
<a name="l01317"></a>01317         }
<a name="l01318"></a>01318         <span class="keywordflow">return</span> retval;
<a name="l01319"></a>01319     }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321     <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;
<a name="l01322"></a>01322     <span class="keywordtype">void</span> narrowToTinyInt(<span class="keyword">const</span> T value, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> sourceType)
<a name="l01323"></a>01323     {
<a name="l01324"></a>01324         <span class="keywordflow">if</span> (value &gt; (T)INT8_MAX || value &lt; (T)<a class="code" href="value__defs_8h.html#a2311db07b6d806ab2f12e6e64349424a">VOLT_INT8_MIN</a>) {
<a name="l01325"></a>01325             <a class="code" href="namespacevoltdb.html#a30d1fb04637ce4bce79c33b9e1526827">throwCastSQLValueOutOfRangeException</a>(value, sourceType, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>);
<a name="l01326"></a>01326         }
<a name="l01327"></a>01327         getTinyInt() = <span class="keyword">static_cast&lt;</span>int8_t<span class="keyword">&gt;</span>(value);
<a name="l01328"></a>01328     }
<a name="l01329"></a>01329 
<a name="l01330"></a>01330     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsTinyInt()<span class="keyword"> const </span>{
<a name="l01331"></a>01331         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01332"></a>01332 
<a name="l01333"></a>01333         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>);
<a name="l01334"></a>01334         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01335"></a>01335         <span class="keywordflow">switch</span> (type) {
<a name="l01336"></a>01336         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01337"></a>01337             retval.getTinyInt() = getTinyInt(); <span class="keywordflow">break</span>;
<a name="l01338"></a>01338         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01339"></a>01339             retval.narrowToTinyInt(getSmallInt(), type); <span class="keywordflow">break</span>;
<a name="l01340"></a>01340         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01341"></a>01341             retval.narrowToTinyInt(getInteger(), type); <span class="keywordflow">break</span>;
<a name="l01342"></a>01342         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01343"></a>01343             retval.narrowToTinyInt(getBigInt(), type); <span class="keywordflow">break</span>;
<a name="l01344"></a>01344         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01345"></a>01345             retval.narrowToTinyInt(getTimestamp(), type); <span class="keywordflow">break</span>;
<a name="l01346"></a>01346         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01347"></a>01347             retval.narrowToTinyInt(getDouble(), type); <span class="keywordflow">break</span>;
<a name="l01348"></a>01348         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l01349"></a>01349             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = getDecimal();
<a name="l01350"></a>01350             int64_t whole = narrowDecimalToBigInt(scaledValue);
<a name="l01351"></a>01351             retval.narrowToTinyInt(whole, type); <span class="keywordflow">break</span>;
<a name="l01352"></a>01352         }
<a name="l01353"></a>01353         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01354"></a>01354             retval.narrowToTinyInt(getNumberFromString(), type); <span class="keywordflow">break</span>;
<a name="l01355"></a>01355         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01356"></a>01356         <span class="keywordflow">default</span>:
<a name="l01357"></a>01357             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>);
<a name="l01358"></a>01358         }
<a name="l01359"></a>01359         <span class="keywordflow">return</span> retval;
<a name="l01360"></a>01360     }
<a name="l01361"></a>01361 
<a name="l01362"></a>01362     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsDouble()<span class="keyword"> const </span>{
<a name="l01363"></a>01363         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01364"></a>01364 
<a name="l01365"></a>01365         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>);
<a name="l01366"></a>01366         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01367"></a>01367         <span class="keywordflow">switch</span> (type) {
<a name="l01368"></a>01368         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01369"></a>01369             retval.getDouble() = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getTinyInt()); <span class="keywordflow">break</span>;
<a name="l01370"></a>01370         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01371"></a>01371             retval.getDouble() = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getSmallInt()); <span class="keywordflow">break</span>;
<a name="l01372"></a>01372         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01373"></a>01373             retval.getDouble() = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getInteger()); <span class="keywordflow">break</span>;
<a name="l01374"></a>01374         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01375"></a>01375             retval.getDouble() = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getBigInt()); <span class="keywordflow">break</span>;
<a name="l01376"></a>01376         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01377"></a>01377             retval.getDouble() = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(getTimestamp()); <span class="keywordflow">break</span>;
<a name="l01378"></a>01378         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01379"></a>01379             retval.getDouble() = getDouble(); <span class="keywordflow">break</span>;
<a name="l01380"></a>01380         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l01381"></a>01381             retval.getDouble() = castAsDoubleAndGetValue(); <span class="keywordflow">break</span>;
<a name="l01382"></a>01382         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01383"></a>01383             retval.getDouble() = getNumberFromString(); <span class="keywordflow">break</span>;
<a name="l01384"></a>01384         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01385"></a>01385         <span class="keywordflow">default</span>:
<a name="l01386"></a>01386             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>);
<a name="l01387"></a>01387         }
<a name="l01388"></a>01388         <span class="keywordflow">return</span> retval;
<a name="l01389"></a>01389     }
<a name="l01390"></a>01390 
<a name="l01391"></a>01391     <span class="keywordtype">void</span> streamTimestamp(std::stringstream&amp; value) <span class="keyword">const</span>;
<a name="l01392"></a>01392 
<a name="l01393"></a>01393     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsString()<span class="keyword"> const </span>{
<a name="l01394"></a>01394         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01395"></a>01395 
<a name="l01396"></a>01396         std::stringstream value;
<a name="l01397"></a>01397         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01398"></a>01398         <span class="keywordflow">switch</span> (type) {
<a name="l01399"></a>01399         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01400"></a>01400             <span class="comment">// This cast keeps the tiny int from being confused for a char.</span>
<a name="l01401"></a>01401             value &lt;&lt; static_cast&lt;int&gt;(getTinyInt()); <span class="keywordflow">break</span>;
<a name="l01402"></a>01402         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01403"></a>01403             value &lt;&lt; getSmallInt(); <span class="keywordflow">break</span>;
<a name="l01404"></a>01404         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01405"></a>01405             value &lt;&lt; getInteger(); <span class="keywordflow">break</span>;
<a name="l01406"></a>01406         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01407"></a>01407             value &lt;&lt; getBigInt(); <span class="keywordflow">break</span>;
<a name="l01408"></a>01408         <span class="comment">//case VALUE_TYPE_TIMESTAMP:</span>
<a name="l01409"></a>01409             <span class="comment">//TODO: The SQL standard wants an actual date literal rather than a numeric value, here. See ENG-4284.</span>
<a name="l01410"></a>01410             <span class="comment">//value &lt;&lt; static_cast&lt;double&gt;(getTimestamp()); break;</span>
<a name="l01411"></a>01411         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01412"></a>01412             <span class="comment">// Use the specific standard SQL formatting for float values,</span>
<a name="l01413"></a>01413             <span class="comment">// which the C/C++ format options don&apos;t quite support.</span>
<a name="l01414"></a>01414             <a class="code" href="namespacevoltdb.html#a82d68b012690bdd7af478e91252859d3">streamSQLFloatFormat</a>(value, getDouble());
<a name="l01415"></a>01415             <span class="keywordflow">break</span>;
<a name="l01416"></a>01416         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l01417"></a>01417             value &lt;&lt; createStringFromDecimal(); <span class="keywordflow">break</span>;
<a name="l01418"></a>01418         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01419"></a>01419         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>: {
<a name="l01420"></a>01420         <span class="comment">// note: we allow binary conversion to strings to support</span>
<a name="l01421"></a>01421         <span class="comment">// byte[] as string parameters...</span>
<a name="l01422"></a>01422         <span class="comment">// In the future, it would be nice to check this is a decent string here...</span>
<a name="l01423"></a>01423             <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>);
<a name="l01424"></a>01424             memcpy(retval.m_data, m_data, <span class="keyword">sizeof</span>(m_data));
<a name="l01425"></a>01425             <span class="keywordflow">return</span> retval;
<a name="l01426"></a>01426         }
<a name="l01427"></a>01427         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>: {
<a name="l01428"></a>01428             streamTimestamp(value);
<a name="l01429"></a>01429             <span class="keywordflow">break</span>;
<a name="l01430"></a>01430         }
<a name="l01431"></a>01431         <span class="keywordflow">default</span>:
<a name="l01432"></a>01432             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>);
<a name="l01433"></a>01433         }
<a name="l01434"></a>01434         <span class="keywordflow">return</span> getTempStringValue(value.str().c_str(), value.str().length());
<a name="l01435"></a>01435     }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsBinary()<span class="keyword"> const </span>{
<a name="l01438"></a>01438         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01439"></a>01439 
<a name="l01440"></a>01440         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>);
<a name="l01441"></a>01441         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01442"></a>01442         <span class="keywordflow">switch</span> (type) {
<a name="l01443"></a>01443         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l01444"></a>01444             memcpy(retval.m_data, m_data, <span class="keyword">sizeof</span>(m_data));
<a name="l01445"></a>01445             <span class="keywordflow">break</span>;
<a name="l01446"></a>01446         <span class="keywordflow">default</span>:
<a name="l01447"></a>01447             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>);
<a name="l01448"></a>01448         }
<a name="l01449"></a>01449         <span class="keywordflow">return</span> retval;
<a name="l01450"></a>01450     }
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <span class="keywordtype">void</span> createDecimalFromInt(int64_t rhsint)
<a name="l01453"></a>01453     {
<a name="l01454"></a>01454         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaled(rhsint);
<a name="l01455"></a>01455         scaled *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01456"></a>01456         getDecimal() = scaled;
<a name="l01457"></a>01457     }
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> castAsDecimal()<span class="keyword"> const </span>{
<a name="l01460"></a>01460         assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l01461"></a>01461         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l01462"></a>01462         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l01463"></a>01463         <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l01464"></a>01464             retval.setNull();
<a name="l01465"></a>01465             <span class="keywordflow">return</span> retval;
<a name="l01466"></a>01466         }
<a name="l01467"></a>01467         <span class="keywordflow">switch</span> (type) {
<a name="l01468"></a>01468         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01469"></a>01469         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01470"></a>01470         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01471"></a>01471         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01472"></a>01472         {
<a name="l01473"></a>01473             int64_t rhsint = castAsRawInt64AndGetValue();
<a name="l01474"></a>01474             retval.createDecimalFromInt(rhsint);
<a name="l01475"></a>01475             <span class="keywordflow">break</span>;
<a name="l01476"></a>01476         }
<a name="l01477"></a>01477         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l01478"></a>01478             ::memcpy(retval.m_data, m_data, <span class="keyword">sizeof</span>(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>));
<a name="l01479"></a>01479             <span class="keywordflow">break</span>;
<a name="l01480"></a>01480         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01481"></a>01481         {
<a name="l01482"></a>01482             <span class="keyword">const</span> <span class="keywordtype">double</span>&amp; value = getDouble();
<a name="l01483"></a>01483             <span class="keywordflow">if</span> (value &gt;= s_gtMaxDecimalAsDouble || value &lt;= s_ltMinDecimalAsDouble) {
<a name="l01484"></a>01484                 <span class="keywordtype">char</span> message[4096];
<a name="l01485"></a>01485                 snprintf(message, 4096, <span class="stringliteral">&quot;Attempted to cast value %f causing overflow/underflow&quot;</span>, value);
<a name="l01486"></a>01486                 <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>, message);
<a name="l01487"></a>01487             }
<a name="l01488"></a>01488             <span class="comment">// Resort to string as the intermediary since even int64_t does not cover the full range.</span>
<a name="l01489"></a>01489             <span class="keywordtype">char</span> decimalAsString[41]; <span class="comment">// Large enough to account for digits, sign, decimal, and terminating null.</span>
<a name="l01490"></a>01490             snprintf(decimalAsString, <span class="keyword">sizeof</span>(decimalAsString), <span class="stringliteral">&quot;%.12f&quot;</span>, value);
<a name="l01491"></a>01491             <span class="comment">// Shift the entire integer part 1 digit to the right, overwriting the decimal point.</span>
<a name="l01492"></a>01492             <span class="comment">// This effectively creates a potentially very large integer value</span>
<a name="l01493"></a>01493             <span class="comment">//  equal to the original double scaled up by 10^12.</span>
<a name="l01494"></a>01494             <span class="keywordflow">for</span> (<span class="keywordtype">char</span>* intDigit = strchr(decimalAsString, <span class="charliteral">&apos;.&apos;</span>); intDigit &gt; decimalAsString; --intDigit) {
<a name="l01495"></a>01495                 *intDigit = *(intDigit-1);
<a name="l01496"></a>01496             }
<a name="l01497"></a>01497             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> result(decimalAsString+1);
<a name="l01498"></a>01498             retval.getDecimal() = result;
<a name="l01499"></a>01499             <span class="keywordflow">break</span>;
<a name="l01500"></a>01500         }
<a name="l01501"></a>01501         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l01502"></a>01502         {
<a name="l01503"></a>01503             <span class="keyword">const</span> int32_t length = getObjectLength_withoutNull();
<a name="l01504"></a>01504             <span class="keyword">const</span> <span class="keywordtype">char</span>* bytes = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l01505"></a>01505             <span class="keyword">const</span> std::string value(bytes, length);
<a name="l01506"></a>01506             retval.createDecimalFromString(value);
<a name="l01507"></a>01507             <span class="keywordflow">break</span>;
<a name="l01508"></a>01508         }
<a name="l01509"></a>01509         <span class="keywordflow">default</span>:
<a name="l01510"></a>01510             throwCastSQLException(type, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l01511"></a>01511         }
<a name="l01512"></a>01512         <span class="keywordflow">return</span> retval;
<a name="l01513"></a>01513     }
<a name="l01514"></a>01514 
<a name="l01519"></a>01519     <span class="keywordtype">void</span> inlineCopyObject(<span class="keywordtype">void</span> *storage, int32_t maxLength, <span class="keywordtype">bool</span> isInBytes)<span class="keyword"> const </span>{
<a name="l01520"></a>01520         <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l01521"></a>01521             <span class="comment">/*</span>
<a name="l01522"></a>01522 <span class="comment">             * The 7th bit of the length preceding value</span>
<a name="l01523"></a>01523 <span class="comment">             * is used to indicate that the object is null.</span>
<a name="l01524"></a>01524 <span class="comment">             */</span>
<a name="l01525"></a>01525             *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(storage) = <a class="code" href="NValue_8hpp.html#a739d0b39c04a69c173db87bce273e19c">OBJECT_NULL_BIT</a>;
<a name="l01526"></a>01526         }
<a name="l01527"></a>01527         <span class="keywordflow">else</span> {
<a name="l01528"></a>01528             <span class="keyword">const</span> int32_t objLength = getObjectLength_withoutNull();
<a name="l01529"></a>01529             <span class="keyword">const</span> <span class="keywordtype">char</span>* ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l01530"></a>01530             checkTooNarrowVarcharAndVarbinary(m_valueType, ptr, objLength, maxLength, isInBytes);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532             <span class="keywordflow">if</span> (m_sourceInlined)
<a name="l01533"></a>01533             {
<a name="l01534"></a>01534                 ::memcpy( storage, *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span> *<span class="keyword">const </span>*<span class="keyword">&gt;</span>(m_data), getObjectLengthLength() + objLength);
<a name="l01535"></a>01535             }
<a name="l01536"></a>01536             <span class="keywordflow">else</span>
<a name="l01537"></a>01537             {
<a name="l01538"></a>01538                 <span class="keyword">const</span> StringRef* sref =
<a name="l01539"></a>01539                     *<span class="keyword">reinterpret_cast&lt;</span>StringRef* const*<span class="keyword">&gt;</span>(m_data);
<a name="l01540"></a>01540                 ::memcpy(storage, sref-&gt;get(),
<a name="l01541"></a>01541                          getObjectLengthLength() + objLength);
<a name="l01542"></a>01542             }
<a name="l01543"></a>01543         }
<a name="l01544"></a>01544 
<a name="l01545"></a>01545     }
<a name="l01546"></a>01546 
<a name="l01547"></a>01547     <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> validVarcharSize(<span class="keyword">const</span> <span class="keywordtype">char</span> *valueChars, <span class="keyword">const</span> <span class="keywordtype">size_t</span> length, <span class="keyword">const</span> int32_t maxLength) {
<a name="l01548"></a>01548         int32_t min_continuation_bytes = <span class="keyword">static_cast&lt;</span>int32_t<span class="keyword">&gt;</span>(length - maxLength);
<a name="l01549"></a>01549         <span class="keywordflow">if</span> (min_continuation_bytes &lt;= 0) {
<a name="l01550"></a>01550             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01551"></a>01551         }
<a name="l01552"></a>01552         <span class="keywordtype">size_t</span> i = length;
<a name="l01553"></a>01553         <span class="keywordflow">while</span> (i--) {
<a name="l01554"></a>01554             <span class="keywordflow">if</span> ((valueChars[i] &amp; 0xc0) == 0x80) {
<a name="l01555"></a>01555                 <span class="keywordflow">if</span> (--min_continuation_bytes == 0) {
<a name="l01556"></a>01556                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01557"></a>01557                 }
<a name="l01558"></a>01558             }
<a name="l01559"></a>01559         }
<a name="l01560"></a>01560         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01561"></a>01561     }
<a name="l01562"></a>01562 
<a name="l01566"></a>01566     <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> checkTooNarrowVarcharAndVarbinary(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keyword">const</span> <span class="keywordtype">char</span>* ptr,
<a name="l01567"></a>01567             int32_t objLength, int32_t maxLength, <span class="keywordtype">bool</span> isInBytes) {
<a name="l01568"></a>01568         <span class="keywordflow">if</span> (maxLength == 0) {
<a name="l01569"></a>01569             <a class="code" href="FatalException_8hpp.html#a737d6eb405a650b23d77201ef123ff6e">throwFatalLogicErrorStreamed</a>(<span class="stringliteral">&quot;Zero maxLength for object type &quot;</span> &lt;&lt; <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(type));
<a name="l01570"></a>01570         }
<a name="l01571"></a>01571 
<a name="l01572"></a>01572         <span class="keywordflow">if</span> (type == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>) {
<a name="l01573"></a>01573             <span class="keywordflow">if</span> (objLength &gt; maxLength) {
<a name="l01574"></a>01574                 <span class="keywordtype">char</span> msg[1024];
<a name="l01575"></a>01575                 snprintf(msg, 1024,
<a name="l01576"></a>01576                         <span class="stringliteral">&quot;The size %d of the value exceeds the size of the VARBINARY(%d) column.&quot;</span>,
<a name="l01577"></a>01577                         objLength, maxLength);
<a name="l01578"></a>01578                 <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#abd118fbdc8ffffb7bf3ad85a30d082cd">SQLException::data_exception_string_data_length_mismatch</a>,
<a name="l01579"></a>01579                         msg);
<a name="l01580"></a>01580             }
<a name="l01581"></a>01581         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (type == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>) {
<a name="l01582"></a>01582             <span class="keywordflow">if</span> (isInBytes) {
<a name="l01583"></a>01583                 <span class="keywordflow">if</span> (objLength &gt; maxLength) {
<a name="l01584"></a>01584                     std::string inputValue;
<a name="l01585"></a>01585                     <span class="keywordflow">if</span> (objLength &gt; <a class="code" href="NValue_8hpp.html#a8c6f1797e452cb5b69e635459b961c65">FULL_STRING_IN_MESSAGE_THRESHOLD</a>) {
<a name="l01586"></a>01586                         inputValue = std::string(ptr, <a class="code" href="NValue_8hpp.html#a8c6f1797e452cb5b69e635459b961c65">FULL_STRING_IN_MESSAGE_THRESHOLD</a>) + std::string(<span class="stringliteral">&quot;...&quot;</span>);
<a name="l01587"></a>01587                     } <span class="keywordflow">else</span> {
<a name="l01588"></a>01588                         inputValue = std::string(ptr, objLength);
<a name="l01589"></a>01589                     }
<a name="l01590"></a>01590                     <span class="keywordtype">char</span> msg[1024];
<a name="l01591"></a>01591                     snprintf(msg, 1024,
<a name="l01592"></a>01592                             <span class="stringliteral">&quot;The size %d of the value &apos;%s&apos; exceeds the size of the VARCHAR(%d BYTES) column.&quot;</span>,
<a name="l01593"></a>01593                             objLength, inputValue.c_str(), maxLength);
<a name="l01594"></a>01594                     <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#abd118fbdc8ffffb7bf3ad85a30d082cd">SQLException::data_exception_string_data_length_mismatch</a>,
<a name="l01595"></a>01595                             msg);
<a name="l01596"></a>01596                 }
<a name="l01597"></a>01597             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!validVarcharSize(ptr, objLength, maxLength)) {
<a name="l01598"></a>01598                 <span class="keyword">const</span> int32_t charLength = <a class="code" href="classvoltdb_1_1NValue.html#a7aa6214292ad5a33204fbc21d90f989e">getCharLength</a>(ptr, objLength);
<a name="l01599"></a>01599                 <span class="keywordtype">char</span> msg[1024];
<a name="l01600"></a>01600                 std::string inputValue;
<a name="l01601"></a>01601                 <span class="keywordflow">if</span> (charLength &gt; <a class="code" href="NValue_8hpp.html#a8c6f1797e452cb5b69e635459b961c65">FULL_STRING_IN_MESSAGE_THRESHOLD</a>) {
<a name="l01602"></a>01602                     <span class="keyword">const</span> <span class="keywordtype">char</span> * end = <a class="code" href="classvoltdb_1_1NValue.html#a9e05ee900c76c3e90c6d1456c5aca956">getIthCharPosition</a>(ptr, objLength, <a class="code" href="NValue_8hpp.html#a8c6f1797e452cb5b69e635459b961c65">FULL_STRING_IN_MESSAGE_THRESHOLD</a>+1);
<a name="l01603"></a>01603                     int32_t numBytes = (int32_t)(end - ptr);
<a name="l01604"></a>01604                     inputValue = std::string(ptr, numBytes) + std::string(<span class="stringliteral">&quot;...&quot;</span>);
<a name="l01605"></a>01605                 } <span class="keywordflow">else</span> {
<a name="l01606"></a>01606                     inputValue = std::string(ptr, objLength);
<a name="l01607"></a>01607                 }
<a name="l01608"></a>01608                 snprintf(msg, 1024,
<a name="l01609"></a>01609                         <span class="stringliteral">&quot;The size %d of the value &apos;%s&apos; exceeds the size of the VARCHAR(%d) column.&quot;</span>,
<a name="l01610"></a>01610                         charLength, inputValue.c_str(), maxLength);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612                 <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#abd118fbdc8ffffb7bf3ad85a30d082cd">SQLException::data_exception_string_data_length_mismatch</a>,
<a name="l01613"></a>01613                         msg);
<a name="l01614"></a>01614             }
<a name="l01615"></a>01615         } <span class="keywordflow">else</span> {
<a name="l01616"></a>01616             <a class="code" href="FatalException_8hpp.html#a737d6eb405a650b23d77201ef123ff6e">throwFatalLogicErrorStreamed</a>(<span class="stringliteral">&quot;NValue::checkTooNarrowVarcharAndVarbinary, &quot;</span>
<a name="l01617"></a>01617                     <span class="stringliteral">&quot;Invalid object type &quot;</span> &lt;&lt; <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(type));
<a name="l01618"></a>01618         }
<a name="l01619"></a>01619     }
<a name="l01620"></a>01620 
<a name="l01621"></a>01621     <span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;
<a name="l01622"></a>01622     <span class="keywordtype">int</span> compareValue (<span class="keyword">const</span> T lhsValue, <span class="keyword">const</span> T rhsValue)<span class="keyword"> const </span>{
<a name="l01623"></a>01623         <span class="keywordflow">if</span> (lhsValue == rhsValue) {
<a name="l01624"></a>01624             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2ffcae2039122e5a2a498803d320dbb5">VALUE_COMPARE_EQUAL</a>;
<a name="l01625"></a>01625         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lhsValue &gt; rhsValue) {
<a name="l01626"></a>01626             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l01627"></a>01627         } <span class="keywordflow">else</span> {
<a name="l01628"></a>01628             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l01629"></a>01629         }
<a name="l01630"></a>01630     }
<a name="l01631"></a>01631 
<a name="l01632"></a>01632     <span class="keywordtype">int</span> compareDoubleValue (<span class="keyword">const</span> <span class="keywordtype">double</span> lhsValue, <span class="keyword">const</span> <span class="keywordtype">double</span> rhsValue)<span class="keyword"> const </span>{
<a name="l01633"></a>01633         <span class="comment">// Treat NaN values as equals and also make them smaller than neagtive infinity.</span>
<a name="l01634"></a>01634         <span class="comment">// This breaks IEEE754 for expressions slightly.</span>
<a name="l01635"></a>01635         <span class="keywordflow">if</span> (std::isnan(lhsValue)) {
<a name="l01636"></a>01636             <span class="keywordflow">return</span> std::isnan(rhsValue) ? <a class="code" href="value__defs_8h.html#a2ffcae2039122e5a2a498803d320dbb5">VALUE_COMPARE_EQUAL</a> : <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l01637"></a>01637         }
<a name="l01638"></a>01638         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (std::isnan(rhsValue)) {
<a name="l01639"></a>01639             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l01640"></a>01640         }
<a name="l01641"></a>01641         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lhsValue &gt; rhsValue) {
<a name="l01642"></a>01642             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l01643"></a>01643         }
<a name="l01644"></a>01644         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (lhsValue &lt; rhsValue) {
<a name="l01645"></a>01645             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l01646"></a>01646         }
<a name="l01647"></a>01647         <span class="keywordflow">else</span> {
<a name="l01648"></a>01648             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2ffcae2039122e5a2a498803d320dbb5">VALUE_COMPARE_EQUAL</a>;
<a name="l01649"></a>01649         }
<a name="l01650"></a>01650     }
<a name="l01651"></a>01651 
<a name="l01652"></a>01652     <span class="keywordtype">int</span> compareTinyInt (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01653"></a>01653         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>);
<a name="l01654"></a>01654 
<a name="l01655"></a>01655         <span class="comment">// get the right hand side as a bigint</span>
<a name="l01656"></a>01656         <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>) {
<a name="l01657"></a>01657             <span class="keywordflow">return</span> compareDoubleValue(static_cast&lt;double&gt;(getTinyInt()), rhs.getDouble());
<a name="l01658"></a>01658         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>) {
<a name="l01659"></a>01659             <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue = rhs.getDecimal();
<a name="l01660"></a>01660             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> lhsValue(static_cast&lt;int64_t&gt;(getTinyInt()));
<a name="l01661"></a>01661             lhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01662"></a>01662             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(lhsValue, rhsValue);
<a name="l01663"></a>01663         } <span class="keywordflow">else</span> {
<a name="l01664"></a>01664             int64_t lhsValue, rhsValue;
<a name="l01665"></a>01665             lhsValue = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getTinyInt());
<a name="l01666"></a>01666             rhsValue = rhs.castAsBigIntAndGetValue();
<a name="l01667"></a>01667             <span class="keywordflow">return</span> compareValue&lt;int64_t&gt;(lhsValue, rhsValue);
<a name="l01668"></a>01668         }
<a name="l01669"></a>01669     }
<a name="l01670"></a>01670 
<a name="l01671"></a>01671     <span class="keywordtype">int</span> compareSmallInt (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01672"></a>01672         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>);
<a name="l01673"></a>01673 
<a name="l01674"></a>01674         <span class="comment">// get the right hand side as a bigint</span>
<a name="l01675"></a>01675         <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>) {
<a name="l01676"></a>01676             <span class="keywordflow">return</span> compareDoubleValue(static_cast&lt;double&gt;(getSmallInt()), rhs.getDouble());
<a name="l01677"></a>01677         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>) {
<a name="l01678"></a>01678             <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue = rhs.getDecimal();
<a name="l01679"></a>01679             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> lhsValue(static_cast&lt;int64_t&gt;(getSmallInt()));
<a name="l01680"></a>01680             lhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01681"></a>01681             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(lhsValue, rhsValue);
<a name="l01682"></a>01682         } <span class="keywordflow">else</span> {
<a name="l01683"></a>01683             int64_t lhsValue, rhsValue;
<a name="l01684"></a>01684             lhsValue = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getSmallInt());
<a name="l01685"></a>01685             rhsValue = rhs.castAsBigIntAndGetValue();
<a name="l01686"></a>01686             <span class="keywordflow">return</span> compareValue&lt;int64_t&gt;(lhsValue, rhsValue);
<a name="l01687"></a>01687         }
<a name="l01688"></a>01688     }
<a name="l01689"></a>01689 
<a name="l01690"></a>01690     <span class="keywordtype">int</span> compareInteger (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01691"></a>01691         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l01692"></a>01692 
<a name="l01693"></a>01693         <span class="comment">// get the right hand side as a bigint</span>
<a name="l01694"></a>01694         <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>) {
<a name="l01695"></a>01695             <span class="keywordflow">return</span> compareDoubleValue(static_cast&lt;double&gt;(getInteger()), rhs.getDouble());
<a name="l01696"></a>01696         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>) {
<a name="l01697"></a>01697             <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue = rhs.getDecimal();
<a name="l01698"></a>01698             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> lhsValue(static_cast&lt;int64_t&gt;(getInteger()));
<a name="l01699"></a>01699             lhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01700"></a>01700             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(lhsValue, rhsValue);
<a name="l01701"></a>01701         } <span class="keywordflow">else</span> {
<a name="l01702"></a>01702             int64_t lhsValue, rhsValue;
<a name="l01703"></a>01703             lhsValue = <span class="keyword">static_cast&lt;</span>int64_t<span class="keyword">&gt;</span>(getInteger());
<a name="l01704"></a>01704             rhsValue = rhs.castAsBigIntAndGetValue();
<a name="l01705"></a>01705             <span class="keywordflow">return</span> compareValue&lt;int64_t&gt;(lhsValue, rhsValue);
<a name="l01706"></a>01706         }
<a name="l01707"></a>01707     }
<a name="l01708"></a>01708 
<a name="l01709"></a>01709     <span class="keywordtype">int</span> compareBigInt (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01710"></a>01710         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l01711"></a>01711 
<a name="l01712"></a>01712         <span class="comment">// get the right hand side as a bigint</span>
<a name="l01713"></a>01713         <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>) {
<a name="l01714"></a>01714             <span class="keywordflow">return</span> compareDoubleValue(static_cast&lt;double&gt;(getBigInt()), rhs.getDouble());
<a name="l01715"></a>01715         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>) {
<a name="l01716"></a>01716             <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue = rhs.getDecimal();
<a name="l01717"></a>01717             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> lhsValue(getBigInt());
<a name="l01718"></a>01718             lhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01719"></a>01719             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(lhsValue, rhsValue);
<a name="l01720"></a>01720         } <span class="keywordflow">else</span> {
<a name="l01721"></a>01721             int64_t lhsValue, rhsValue;
<a name="l01722"></a>01722             lhsValue = getBigInt();
<a name="l01723"></a>01723             rhsValue = rhs.castAsBigIntAndGetValue();
<a name="l01724"></a>01724             <span class="keywordflow">return</span> compareValue&lt;int64_t&gt;(lhsValue, rhsValue);
<a name="l01725"></a>01725         }
<a name="l01726"></a>01726     }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728 
<a name="l01729"></a>01729     <span class="keywordtype">int</span> compareTimestamp (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01730"></a>01730         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732         <span class="comment">// get the right hand side as a bigint</span>
<a name="l01733"></a>01733         <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>) {
<a name="l01734"></a>01734             <span class="keywordflow">return</span> compareDoubleValue(static_cast&lt;double&gt;(getTimestamp()), rhs.getDouble());
<a name="l01735"></a>01735         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>) {
<a name="l01736"></a>01736             <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue = rhs.getDecimal();
<a name="l01737"></a>01737             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> lhsValue(getTimestamp());
<a name="l01738"></a>01738             lhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01739"></a>01739             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(lhsValue, rhsValue);
<a name="l01740"></a>01740         } <span class="keywordflow">else</span> {
<a name="l01741"></a>01741             int64_t lhsValue, rhsValue;
<a name="l01742"></a>01742             lhsValue = getTimestamp();
<a name="l01743"></a>01743             rhsValue = rhs.castAsBigIntAndGetValue();
<a name="l01744"></a>01744             <span class="keywordflow">return</span> compareValue&lt;int64_t&gt;(lhsValue, rhsValue);
<a name="l01745"></a>01745         }
<a name="l01746"></a>01746     }
<a name="l01747"></a>01747 
<a name="l01748"></a>01748     <span class="keywordtype">int</span> compareDoubleValue (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01749"></a>01749         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>);
<a name="l01750"></a>01750 
<a name="l01751"></a>01751         <span class="keyword">const</span> <span class="keywordtype">double</span> lhsValue = getDouble();
<a name="l01752"></a>01752         <span class="keywordtype">double</span> rhsValue;
<a name="l01753"></a>01753 
<a name="l01754"></a>01754         <span class="keywordflow">switch</span> (rhs.getValueType()) {
<a name="l01755"></a>01755         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01756"></a>01756             rhsValue = rhs.getDouble(); <span class="keywordflow">break</span>;
<a name="l01757"></a>01757         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01758"></a>01758             rhsValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(rhs.getTinyInt()); <span class="keywordflow">break</span>;
<a name="l01759"></a>01759         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01760"></a>01760             rhsValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(rhs.getSmallInt()); <span class="keywordflow">break</span>;
<a name="l01761"></a>01761         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01762"></a>01762             rhsValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(rhs.getInteger()); <span class="keywordflow">break</span>;
<a name="l01763"></a>01763         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01764"></a>01764             rhsValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(rhs.getBigInt()); <span class="keywordflow">break</span>;
<a name="l01765"></a>01765         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01766"></a>01766             rhsValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(rhs.getTimestamp()); <span class="keywordflow">break</span>;
<a name="l01767"></a>01767         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l01768"></a>01768         {
<a name="l01769"></a>01769             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = rhs.getDecimal();
<a name="l01770"></a>01770             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> whole(scaledValue);
<a name="l01771"></a>01771             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> fractional(scaledValue);
<a name="l01772"></a>01772             whole /= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01773"></a>01773             fractional %= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01774"></a>01774             rhsValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(whole.ToInt()) +
<a name="l01775"></a>01775                     (static_cast&lt;double&gt;(fractional.ToInt())/static_cast&lt;double&gt;(<a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>));
<a name="l01776"></a>01776             <span class="keywordflow">break</span>;
<a name="l01777"></a>01777         }
<a name="l01778"></a>01778         <span class="keywordflow">default</span>:
<a name="l01779"></a>01779             <span class="keywordtype">char</span> message[128];
<a name="l01780"></a>01780             snprintf(message, 128,
<a name="l01781"></a>01781                     <span class="stringliteral">&quot;Type %s cannot be cast for comparison to type %s&quot;</span>,
<a name="l01782"></a>01782                     <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(rhs.getValueType()).c_str(),
<a name="l01783"></a>01783                     <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(getValueType()).c_str());
<a name="l01784"></a>01784             <span class="keywordflow">throw</span> SQLException(SQLException::
<a name="l01785"></a>01785                     data_exception_most_specific_type_mismatch,
<a name="l01786"></a>01786                     message);
<a name="l01787"></a>01787             <span class="comment">// Not reached</span>
<a name="l01788"></a>01788         }
<a name="l01789"></a>01789 
<a name="l01790"></a>01790         <span class="keywordflow">return</span> compareDoubleValue(lhsValue, rhsValue);
<a name="l01791"></a>01791     }
<a name="l01792"></a>01792 
<a name="l01793"></a>01793     <span class="keywordtype">int</span> compareStringValue (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01794"></a>01794         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>);
<a name="l01795"></a>01795 
<a name="l01796"></a>01796         <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> rhsType = rhs.getValueType();
<a name="l01797"></a>01797         <span class="keywordflow">if</span> ((rhsType != <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>) &amp;&amp; (rhsType != <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>)) {
<a name="l01798"></a>01798             <span class="keywordtype">char</span> message[128];
<a name="l01799"></a>01799             snprintf(message, 128,
<a name="l01800"></a>01800                     <span class="stringliteral">&quot;Type %s cannot be cast for comparison to type %s&quot;</span>,
<a name="l01801"></a>01801                     <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(rhsType).c_str(),
<a name="l01802"></a>01802                     <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(m_valueType).c_str());
<a name="l01803"></a>01803             <span class="keywordflow">throw</span> SQLException(SQLException::
<a name="l01804"></a>01804                     data_exception_most_specific_type_mismatch,
<a name="l01805"></a>01805                     message);
<a name="l01806"></a>01806         }
<a name="l01807"></a>01807 
<a name="l01808"></a>01808         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>);
<a name="l01809"></a>01809 
<a name="l01810"></a>01810         <span class="keyword">const</span> int32_t leftLength = getObjectLength_withoutNull();
<a name="l01811"></a>01811         <span class="keyword">const</span> int32_t rightLength = rhs.getObjectLength_withoutNull();
<a name="l01812"></a>01812         <span class="keyword">const</span> <span class="keywordtype">char</span>* left = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l01813"></a>01813         <span class="keyword">const</span> <span class="keywordtype">char</span>* right = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(rhs.getObjectValue_withoutNull());
<a name="l01814"></a>01814 
<a name="l01815"></a>01815         <span class="keyword">const</span> <span class="keywordtype">int</span> result = ::strncmp(left, right, std::min(leftLength, rightLength));
<a name="l01816"></a>01816         <span class="keywordflow">if</span> (result == 0 &amp;&amp; leftLength != rightLength) {
<a name="l01817"></a>01817             <span class="keywordflow">if</span> (leftLength &gt; rightLength) {
<a name="l01818"></a>01818                 <span class="keywordflow">return</span>  <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l01819"></a>01819             } <span class="keywordflow">else</span> {
<a name="l01820"></a>01820                 <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l01821"></a>01821             }
<a name="l01822"></a>01822         }
<a name="l01823"></a>01823         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result &gt; 0) {
<a name="l01824"></a>01824             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l01825"></a>01825         }
<a name="l01826"></a>01826         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result &lt; 0) {
<a name="l01827"></a>01827             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l01828"></a>01828         }
<a name="l01829"></a>01829 
<a name="l01830"></a>01830         <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2ffcae2039122e5a2a498803d320dbb5">VALUE_COMPARE_EQUAL</a>;
<a name="l01831"></a>01831     }
<a name="l01832"></a>01832 
<a name="l01833"></a>01833     <span class="keywordtype">int</span> compareBinaryValue (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01834"></a>01834         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>);
<a name="l01835"></a>01835 
<a name="l01836"></a>01836         <span class="keywordflow">if</span> (rhs.getValueType() != <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>) {
<a name="l01837"></a>01837             <span class="keywordtype">char</span> message[128];
<a name="l01838"></a>01838             snprintf(message, 128,
<a name="l01839"></a>01839                      <span class="stringliteral">&quot;Type %s cannot be cast for comparison to type %s&quot;</span>,
<a name="l01840"></a>01840                      <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(rhs.getValueType()).c_str(),
<a name="l01841"></a>01841                      <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(m_valueType).c_str());
<a name="l01842"></a>01842             <span class="keywordflow">throw</span> SQLException(SQLException::
<a name="l01843"></a>01843                                data_exception_most_specific_type_mismatch,
<a name="l01844"></a>01844                                message);
<a name="l01845"></a>01845         }
<a name="l01846"></a>01846         <span class="keyword">const</span> int32_t leftLength = getObjectLength_withoutNull();
<a name="l01847"></a>01847         <span class="keyword">const</span> int32_t rightLength = rhs.getObjectLength_withoutNull();
<a name="l01848"></a>01848 
<a name="l01849"></a>01849         <span class="keyword">const</span> <span class="keywordtype">char</span>* left = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l01850"></a>01850         <span class="keyword">const</span> <span class="keywordtype">char</span>* right = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(rhs.getObjectValue_withoutNull());
<a name="l01851"></a>01851 
<a name="l01852"></a>01852         <span class="keyword">const</span> <span class="keywordtype">int</span> result = ::memcmp(left, right, std::min(leftLength, rightLength));
<a name="l01853"></a>01853         <span class="keywordflow">if</span> (result == 0 &amp;&amp; leftLength != rightLength) {
<a name="l01854"></a>01854             <span class="keywordflow">if</span> (leftLength &gt; rightLength) {
<a name="l01855"></a>01855                 <span class="keywordflow">return</span>  <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l01856"></a>01856             } <span class="keywordflow">else</span> {
<a name="l01857"></a>01857                 <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l01858"></a>01858             }
<a name="l01859"></a>01859         }
<a name="l01860"></a>01860         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result &gt; 0) {
<a name="l01861"></a>01861             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l01862"></a>01862         }
<a name="l01863"></a>01863         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (result &lt; 0) {
<a name="l01864"></a>01864             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l01865"></a>01865         }
<a name="l01866"></a>01866 
<a name="l01867"></a>01867         <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2ffcae2039122e5a2a498803d320dbb5">VALUE_COMPARE_EQUAL</a>;
<a name="l01868"></a>01868     }
<a name="l01869"></a>01869 
<a name="l01870"></a>01870     <span class="keywordtype">int</span> compareDecimalValue (<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l01871"></a>01871         assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l01872"></a>01872         <span class="keywordflow">switch</span> (rhs.getValueType()) {
<a name="l01873"></a>01873         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l01874"></a>01874         {
<a name="l01875"></a>01875             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(getDecimal(), rhs.getDecimal());
<a name="l01876"></a>01876         }
<a name="l01877"></a>01877         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l01878"></a>01878         {
<a name="l01879"></a>01879             <span class="keyword">const</span> <span class="keywordtype">double</span> rhsValue = rhs.getDouble();
<a name="l01880"></a>01880             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> scaledValue = getDecimal();
<a name="l01881"></a>01881             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> whole(scaledValue);
<a name="l01882"></a>01882             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> fractional(scaledValue);
<a name="l01883"></a>01883             whole /= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01884"></a>01884             fractional %= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01885"></a>01885             <span class="keyword">const</span> <span class="keywordtype">double</span> lhsValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(whole.ToInt()) +
<a name="l01886"></a>01886                     (static_cast&lt;double&gt;(fractional.ToInt())/static_cast&lt;double&gt;(<a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>));
<a name="l01887"></a>01887 
<a name="l01888"></a>01888             <span class="keywordflow">return</span> compareValue&lt;double&gt;(lhsValue, rhsValue);
<a name="l01889"></a>01889         }
<a name="l01890"></a>01890         <span class="comment">// create the equivalent decimal value</span>
<a name="l01891"></a>01891         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l01892"></a>01892         {
<a name="l01893"></a>01893             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue(static_cast&lt;int64_t&gt;(rhs.getTinyInt()));
<a name="l01894"></a>01894             rhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01895"></a>01895             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(getDecimal(), rhsValue);
<a name="l01896"></a>01896         }
<a name="l01897"></a>01897         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l01898"></a>01898         {
<a name="l01899"></a>01899             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue(static_cast&lt;int64_t&gt;(rhs.getSmallInt()));
<a name="l01900"></a>01900             rhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01901"></a>01901             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(getDecimal(), rhsValue);
<a name="l01902"></a>01902         }
<a name="l01903"></a>01903         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l01904"></a>01904         {
<a name="l01905"></a>01905             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue(static_cast&lt;int64_t&gt;(rhs.getInteger()));
<a name="l01906"></a>01906             rhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01907"></a>01907             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(getDecimal(), rhsValue);
<a name="l01908"></a>01908         }
<a name="l01909"></a>01909         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l01910"></a>01910         {
<a name="l01911"></a>01911             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue(rhs.getBigInt());
<a name="l01912"></a>01912             rhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01913"></a>01913             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(getDecimal(), rhsValue);
<a name="l01914"></a>01914         }
<a name="l01915"></a>01915         <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l01916"></a>01916         {
<a name="l01917"></a>01917             <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> rhsValue(rhs.getTimestamp());
<a name="l01918"></a>01918             rhsValue *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l01919"></a>01919             <span class="keywordflow">return</span> compareValue&lt;TTInt&gt;(getDecimal(), rhsValue);
<a name="l01920"></a>01920         }
<a name="l01921"></a>01921         <span class="keywordflow">default</span>:
<a name="l01922"></a>01922         {
<a name="l01923"></a>01923             <span class="keywordtype">char</span> message[128];
<a name="l01924"></a>01924             snprintf(message, 128,
<a name="l01925"></a>01925                     <span class="stringliteral">&quot;Type %s cannot be cast for comparison to type %s&quot;</span>,
<a name="l01926"></a>01926                     <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(rhs.getValueType()).c_str(),
<a name="l01927"></a>01927                     <a class="code" href="namespacevoltdb.html#ab42ed290730c857ee2708b709d9f4997">valueToString</a>(getValueType()).c_str());
<a name="l01928"></a>01928             <span class="keywordflow">throw</span> SQLException(SQLException::
<a name="l01929"></a>01929                     data_exception_most_specific_type_mismatch,
<a name="l01930"></a>01930                     message);
<a name="l01931"></a>01931             <span class="comment">// Not reached</span>
<a name="l01932"></a>01932             <span class="keywordflow">return</span> 0;
<a name="l01933"></a>01933         }
<a name="l01934"></a>01934         }
<a name="l01935"></a>01935     }
<a name="l01936"></a>01936 
<a name="l01937"></a>01937     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opAddBigInts(<span class="keyword">const</span> int64_t lhs, <span class="keyword">const</span> int64_t rhs)<span class="keyword"> const </span>{
<a name="l01938"></a>01938         <span class="comment">//Scary overflow check from https://www.securecoding.cert.org/confluence/display/cplusplus/INT32-CPP.+Ensure+that+operations+on+signed+integers+do+not+result+in+overflow</span>
<a name="l01939"></a>01939         <span class="keywordflow">if</span> ( ((lhs^rhs)
<a name="l01940"></a>01940                 | (((lhs^(~(lhs^rhs)
<a name="l01941"></a>01941                   &amp; (1L &lt;&lt; (<span class="keyword">sizeof</span>(int64_t)*CHAR_BIT-1))))+rhs)^rhs)) &gt;= 0) {
<a name="l01942"></a>01942             <span class="keywordtype">char</span> message[4096];
<a name="l01943"></a>01943             snprintf(message, 4096, <span class="stringliteral">&quot;Adding %jd and %jd will overflow BigInt storage&quot;</span>, (intmax_t)lhs, (intmax_t)rhs);
<a name="l01944"></a>01944             <span class="keywordflow">throw</span> SQLException( <a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>, message);
<a name="l01945"></a>01945         }
<a name="l01946"></a>01946         <span class="keywordflow">return</span> getBigIntValue(lhs + rhs);
<a name="l01947"></a>01947     }
<a name="l01948"></a>01948 
<a name="l01949"></a>01949     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opSubtractBigInts(<span class="keyword">const</span> int64_t lhs, <span class="keyword">const</span> int64_t rhs)<span class="keyword"> const </span>{
<a name="l01950"></a>01950         <span class="comment">//Scary overflow check from https://www.securecoding.cert.org/confluence/display/cplusplus/INT32-CPP.+Ensure+that+operations+on+signed+integers+do+not+result+in+overflow</span>
<a name="l01951"></a>01951         <span class="keywordflow">if</span> ( ((lhs^rhs)
<a name="l01952"></a>01952                 &amp; (((lhs ^ ((lhs^rhs)
<a name="l01953"></a>01953                   &amp; (1L &lt;&lt; (<span class="keyword">sizeof</span>(int64_t)*CHAR_BIT-1))))-rhs)^rhs)) &lt; 0) {
<a name="l01954"></a>01954             <span class="keywordtype">char</span> message[4096];
<a name="l01955"></a>01955             snprintf(message, 4096, <span class="stringliteral">&quot;Subtracting %jd from %jd will overflow BigInt storage&quot;</span>, (intmax_t)lhs, (intmax_t)rhs);
<a name="l01956"></a>01956             <span class="keywordflow">throw</span> SQLException( <a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>, message);
<a name="l01957"></a>01957         }
<a name="l01958"></a>01958         <span class="keywordflow">return</span> getBigIntValue(lhs - rhs);
<a name="l01959"></a>01959     }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opMultiplyBigInts(<span class="keyword">const</span> int64_t lhs, <span class="keyword">const</span> int64_t rhs)<span class="keyword"> const </span>{
<a name="l01962"></a>01962         <span class="keywordtype">bool</span> overflow = <span class="keyword">false</span>;
<a name="l01963"></a>01963         <span class="comment">//Scary overflow check from https://www.securecoding.cert.org/confluence/display/cplusplus/INT32-CPP.+Ensure+that+operations+on+signed+integers+do+not+result+in+overflow</span>
<a name="l01964"></a>01964         <span class="keywordflow">if</span> (lhs &gt; 0){  <span class="comment">/* lhs is positive */</span>
<a name="l01965"></a>01965             <span class="keywordflow">if</span> (rhs &gt; 0) {  <span class="comment">/* lhs and rhs are positive */</span>
<a name="l01966"></a>01966                 <span class="keywordflow">if</span> (lhs &gt; (INT64_MAX / rhs)) {
<a name="l01967"></a>01967                     overflow= <span class="keyword">true</span>;
<a name="l01968"></a>01968                 }
<a name="l01969"></a>01969             } <span class="comment">/* end if lhs and rhs are positive */</span>
<a name="l01970"></a>01970             <span class="keywordflow">else</span> { <span class="comment">/* lhs positive, rhs non-positive */</span>
<a name="l01971"></a>01971                 <span class="keywordflow">if</span> (rhs &lt; (INT64_MIN / lhs)) {
<a name="l01972"></a>01972                     overflow = <span class="keyword">true</span>;
<a name="l01973"></a>01973                 }
<a name="l01974"></a>01974             } <span class="comment">/* lhs positive, rhs non-positive */</span>
<a name="l01975"></a>01975         } <span class="comment">/* end if lhs is positive */</span>
<a name="l01976"></a>01976         <span class="keywordflow">else</span> { <span class="comment">/* lhs is non-positive */</span>
<a name="l01977"></a>01977             <span class="keywordflow">if</span> (rhs &gt; 0) { <span class="comment">/* lhs is non-positive, rhs is positive */</span>
<a name="l01978"></a>01978                 <span class="keywordflow">if</span> (lhs &lt; (INT64_MIN / rhs)) {
<a name="l01979"></a>01979                     overflow = <span class="keyword">true</span>;
<a name="l01980"></a>01980                 }
<a name="l01981"></a>01981             } <span class="comment">/* end if lhs is non-positive, rhs is positive */</span>
<a name="l01982"></a>01982             <span class="keywordflow">else</span> { <span class="comment">/* lhs and rhs are non-positive */</span>
<a name="l01983"></a>01983                 <span class="keywordflow">if</span> ( (lhs != 0) &amp;&amp; (rhs &lt; (INT64_MAX / lhs))) {
<a name="l01984"></a>01984                     overflow = <span class="keyword">true</span>;
<a name="l01985"></a>01985                 }
<a name="l01986"></a>01986             } <span class="comment">/* end if lhs and rhs non-positive */</span>
<a name="l01987"></a>01987         } <span class="comment">/* end if lhs is non-positive */</span>
<a name="l01988"></a>01988 
<a name="l01989"></a>01989         <span class="keyword">const</span> int64_t result = lhs * rhs;
<a name="l01990"></a>01990 
<a name="l01991"></a>01991         <span class="keywordflow">if</span> (result == <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>) {
<a name="l01992"></a>01992             overflow = <span class="keyword">true</span>;
<a name="l01993"></a>01993         }
<a name="l01994"></a>01994 
<a name="l01995"></a>01995         <span class="keywordflow">if</span> (overflow) {
<a name="l01996"></a>01996             <span class="keywordtype">char</span> message[4096];
<a name="l01997"></a>01997             snprintf(message, 4096, <span class="stringliteral">&quot;Multiplying %jd with %jd will overflow BigInt storage&quot;</span>, (intmax_t)lhs, (intmax_t)rhs);
<a name="l01998"></a>01998             <span class="keywordflow">throw</span> SQLException( <a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>, message);
<a name="l01999"></a>01999         }
<a name="l02000"></a>02000 
<a name="l02001"></a>02001         <span class="keywordflow">return</span> getBigIntValue(result);
<a name="l02002"></a>02002     }
<a name="l02003"></a>02003 
<a name="l02004"></a>02004     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opDivideBigInts(<span class="keyword">const</span> int64_t lhs, <span class="keyword">const</span> int64_t rhs)<span class="keyword"> const </span>{
<a name="l02005"></a>02005         <span class="keywordflow">if</span> (rhs == 0) {
<a name="l02006"></a>02006             <span class="keywordtype">char</span> message[4096];
<a name="l02007"></a>02007             snprintf(message, 4096, <span class="stringliteral">&quot;Attempted to divide %jd by 0&quot;</span>, (intmax_t)lhs);
<a name="l02008"></a>02008             <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a0010fab9fffd8f484e23c0c6d00726db">SQLException::data_exception_division_by_zero</a>,
<a name="l02009"></a>02009                                message);
<a name="l02010"></a>02010         }
<a name="l02011"></a>02011 
<a name="l02016"></a>02016         <span class="keywordflow">return</span> getBigIntValue(int64_t(lhs / rhs));
<a name="l02017"></a>02017     }
<a name="l02018"></a>02018 
<a name="l02019"></a>02019     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opAddDoubles(<span class="keyword">const</span> <span class="keywordtype">double</span> lhs, <span class="keyword">const</span> <span class="keywordtype">double</span> rhs)<span class="keyword"> const </span>{
<a name="l02020"></a>02020         <span class="keyword">const</span> <span class="keywordtype">double</span> result = lhs + rhs;
<a name="l02021"></a>02021         <a class="code" href="namespacevoltdb.html#a662266842be07fb1d28f4e530b6db8c3">throwDataExceptionIfInfiniteOrNaN</a>(result, <span class="stringliteral">&quot;&apos;+&apos; operator&quot;</span>);
<a name="l02022"></a>02022         <span class="keywordflow">return</span> getDoubleValue(result);
<a name="l02023"></a>02023     }
<a name="l02024"></a>02024 
<a name="l02025"></a>02025     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opSubtractDoubles(<span class="keyword">const</span> <span class="keywordtype">double</span> lhs, <span class="keyword">const</span> <span class="keywordtype">double</span> rhs)<span class="keyword"> const </span>{
<a name="l02026"></a>02026         <span class="keyword">const</span> <span class="keywordtype">double</span> result = lhs - rhs;
<a name="l02027"></a>02027         <a class="code" href="namespacevoltdb.html#a662266842be07fb1d28f4e530b6db8c3">throwDataExceptionIfInfiniteOrNaN</a>(result, <span class="stringliteral">&quot;&apos;-&apos; operator&quot;</span>);
<a name="l02028"></a>02028         <span class="keywordflow">return</span> getDoubleValue(result);
<a name="l02029"></a>02029     }
<a name="l02030"></a>02030 
<a name="l02031"></a>02031     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opMultiplyDoubles(<span class="keyword">const</span> <span class="keywordtype">double</span> lhs, <span class="keyword">const</span> <span class="keywordtype">double</span> rhs)<span class="keyword"> const </span>{
<a name="l02032"></a>02032         <span class="keyword">const</span> <span class="keywordtype">double</span> result = lhs * rhs;
<a name="l02033"></a>02033         <a class="code" href="namespacevoltdb.html#a662266842be07fb1d28f4e530b6db8c3">throwDataExceptionIfInfiniteOrNaN</a>(result, <span class="stringliteral">&quot;&apos;*&apos; operator&quot;</span>);
<a name="l02034"></a>02034         <span class="keywordflow">return</span> getDoubleValue(result);
<a name="l02035"></a>02035     }
<a name="l02036"></a>02036 
<a name="l02037"></a>02037     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opDivideDoubles(<span class="keyword">const</span> <span class="keywordtype">double</span> lhs, <span class="keyword">const</span> <span class="keywordtype">double</span> rhs)<span class="keyword"> const </span>{
<a name="l02038"></a>02038         <span class="keyword">const</span> <span class="keywordtype">double</span> result = lhs / rhs;
<a name="l02039"></a>02039         <a class="code" href="namespacevoltdb.html#a662266842be07fb1d28f4e530b6db8c3">throwDataExceptionIfInfiniteOrNaN</a>(result, <span class="stringliteral">&quot;&apos;/&apos; operator&quot;</span>);
<a name="l02040"></a>02040         <span class="keywordflow">return</span> getDoubleValue(result);
<a name="l02041"></a>02041     }
<a name="l02042"></a>02042 
<a name="l02043"></a>02043     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opAddDecimals(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;lhs, <span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;rhs)<span class="keyword"> const </span>{
<a name="l02044"></a>02044         assert(lhs.isNull() == <span class="keyword">false</span>);
<a name="l02045"></a>02045         assert(rhs.isNull() == <span class="keyword">false</span>);
<a name="l02046"></a>02046         assert(lhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02047"></a>02047         assert(rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02048"></a>02048 
<a name="l02049"></a>02049         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> retval(lhs.getDecimal());
<a name="l02050"></a>02050         <span class="keywordflow">if</span> (retval.Add(rhs.getDecimal()) || retval &gt; s_maxDecimalValue || retval &lt; s_minDecimalValue) {
<a name="l02051"></a>02051             <span class="keywordtype">char</span> message[4096];
<a name="l02052"></a>02052             snprintf(message, 4096, <span class="stringliteral">&quot;Attempted to add %s with %s causing overflow/underflow&quot;</span>,
<a name="l02053"></a>02053                     lhs.createStringFromDecimal().c_str(), rhs.createStringFromDecimal().c_str());
<a name="l02054"></a>02054             <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l02055"></a>02055                                message);
<a name="l02056"></a>02056         }
<a name="l02057"></a>02057 
<a name="l02058"></a>02058         <span class="keywordflow">return</span> getDecimalValue(retval);
<a name="l02059"></a>02059     }
<a name="l02060"></a>02060 
<a name="l02061"></a>02061     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opSubtractDecimals(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;lhs, <span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;rhs)<span class="keyword"> const </span>{
<a name="l02062"></a>02062         assert(lhs.isNull() == <span class="keyword">false</span>);
<a name="l02063"></a>02063         assert(rhs.isNull() == <span class="keyword">false</span>);
<a name="l02064"></a>02064         assert(lhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02065"></a>02065         assert(rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02066"></a>02066 
<a name="l02067"></a>02067         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> retval(lhs.getDecimal());
<a name="l02068"></a>02068         <span class="keywordflow">if</span> (retval.Sub(rhs.getDecimal()) || retval &gt; s_maxDecimalValue || retval &lt; s_minDecimalValue) {
<a name="l02069"></a>02069             <span class="keywordtype">char</span> message[4096];
<a name="l02070"></a>02070             snprintf(message, 4096, <span class="stringliteral">&quot;Attempted to subtract %s from %s causing overflow/underflow&quot;</span>,
<a name="l02071"></a>02071                     rhs.createStringFromDecimal().c_str(), lhs.createStringFromDecimal().c_str());
<a name="l02072"></a>02072             <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l02073"></a>02073                                message);
<a name="l02074"></a>02074         }
<a name="l02075"></a>02075 
<a name="l02076"></a>02076         <span class="keywordflow">return</span> getDecimalValue(retval);
<a name="l02077"></a>02077     }
<a name="l02078"></a>02078 
<a name="l02079"></a>02079     <span class="comment">/*</span>
<a name="l02080"></a>02080 <span class="comment">     * Avoid scaling both sides if possible. E.g, don&apos;t turn dec * 2 into</span>
<a name="l02081"></a>02081 <span class="comment">     * (dec * 2*kMaxScale*E-12). Then the result of simple multiplication</span>
<a name="l02082"></a>02082 <span class="comment">     * is a*b*E-24 and have to further multiply to get back to the assumed</span>
<a name="l02083"></a>02083 <span class="comment">     * E-12, which can overflow unnecessarily at the middle step.</span>
<a name="l02084"></a>02084 <span class="comment">     */</span>
<a name="l02085"></a>02085     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opMultiplyDecimals(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;lhs, <span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;rhs)<span class="keyword"> const </span>{
<a name="l02086"></a>02086         assert(lhs.isNull() == <span class="keyword">false</span>);
<a name="l02087"></a>02087         assert(rhs.isNull() == <span class="keyword">false</span>);
<a name="l02088"></a>02088         assert(lhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02089"></a>02089         assert(rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02090"></a>02090 
<a name="l02091"></a>02091         <a class="code" href="namespacevoltdb.html#a034dcd3d13a8293e0fc8bbf07aac39ed">TTLInt</a> calc;
<a name="l02092"></a>02092         calc.FromInt(lhs.getDecimal());
<a name="l02093"></a>02093         calc *= rhs.getDecimal();
<a name="l02094"></a>02094         calc /= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l02095"></a>02095         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> retval;
<a name="l02096"></a>02096         <span class="keywordflow">if</span> (retval.FromInt(calc)  || retval &gt; s_maxDecimalValue || retval &lt; s_minDecimalValue) {
<a name="l02097"></a>02097             <span class="keywordtype">char</span> message[4096];
<a name="l02098"></a>02098             snprintf(message, 4096, <span class="stringliteral">&quot;Attempted to multiply %s by %s causing overflow/underflow. Unscaled result was %s&quot;</span>,
<a name="l02099"></a>02099                     lhs.createStringFromDecimal().c_str(), rhs.createStringFromDecimal().c_str(),
<a name="l02100"></a>02100                     calc.ToString(10).c_str());
<a name="l02101"></a>02101             <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l02102"></a>02102                                message);
<a name="l02103"></a>02103         }
<a name="l02104"></a>02104         <span class="keywordflow">return</span> getDecimalValue(retval);
<a name="l02105"></a>02105     }
<a name="l02106"></a>02106 
<a name="l02107"></a>02107 
<a name="l02108"></a>02108     <span class="comment">/*</span>
<a name="l02109"></a>02109 <span class="comment">     * Divide two decimals and return a correctly scaled decimal.</span>
<a name="l02110"></a>02110 <span class="comment">     * A little cumbersome. Better algorithms welcome.</span>
<a name="l02111"></a>02111 <span class="comment">     *   (1) calculate the quotient and the remainder.</span>
<a name="l02112"></a>02112 <span class="comment">     *   (2) temporarily scale the remainder to 19 digits</span>
<a name="l02113"></a>02113 <span class="comment">     *   (3) divide out remainder to calculate digits after the radix point.</span>
<a name="l02114"></a>02114 <span class="comment">     *   (4) scale remainder to 12 digits (that&apos;s the default scale)</span>
<a name="l02115"></a>02115 <span class="comment">     *   (5) scale the quotient back to 19,12.</span>
<a name="l02116"></a>02116 <span class="comment">     *   (6) sum the scaled quotient and remainder.</span>
<a name="l02117"></a>02117 <span class="comment">     *   (7) construct the final decimal.</span>
<a name="l02118"></a>02118 <span class="comment">     */</span>
<a name="l02119"></a>02119 
<a name="l02120"></a>02120     <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> opDivideDecimals(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;lhs, <span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> &amp;rhs)<span class="keyword"> const </span>{
<a name="l02121"></a>02121         assert(lhs.isNull() == <span class="keyword">false</span>);
<a name="l02122"></a>02122         assert(rhs.isNull() == <span class="keyword">false</span>);
<a name="l02123"></a>02123         assert(lhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02124"></a>02124         assert(rhs.getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02125"></a>02125 
<a name="l02126"></a>02126         <a class="code" href="namespacevoltdb.html#a034dcd3d13a8293e0fc8bbf07aac39ed">TTLInt</a> calc;
<a name="l02127"></a>02127         calc.FromInt(lhs.getDecimal());
<a name="l02128"></a>02128         calc *= <a class="code" href="classvoltdb_1_1NValue.html#aa3cd92594698f8a7115b493459e90e6a">kMaxScaleFactor</a>;
<a name="l02129"></a>02129         <span class="keywordflow">if</span> (calc.Div(rhs.getDecimal())) {
<a name="l02130"></a>02130             <span class="keywordtype">char</span> message[4096];
<a name="l02131"></a>02131             snprintf( message, 4096, <span class="stringliteral">&quot;Attempted to divide %s by %s causing overflow/underflow (or divide by zero)&quot;</span>,
<a name="l02132"></a>02132                     lhs.createStringFromDecimal().c_str(), rhs.createStringFromDecimal().c_str());
<a name="l02133"></a>02133             <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l02134"></a>02134                                message);
<a name="l02135"></a>02135         }
<a name="l02136"></a>02136         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> retval;
<a name="l02137"></a>02137         <span class="keywordflow">if</span> (retval.FromInt(calc)  || retval &gt; s_maxDecimalValue || retval &lt; s_minDecimalValue) {
<a name="l02138"></a>02138             <span class="keywordtype">char</span> message[4096];
<a name="l02139"></a>02139             snprintf( message, 4096, <span class="stringliteral">&quot;Attempted to divide %s by %s causing overflow. Unscaled result was %s&quot;</span>,
<a name="l02140"></a>02140                     lhs.createStringFromDecimal().c_str(), rhs.createStringFromDecimal().c_str(),
<a name="l02141"></a>02141                     calc.ToString(10).c_str());
<a name="l02142"></a>02142             <span class="keywordflow">throw</span> SQLException(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l02143"></a>02143                                message);
<a name="l02144"></a>02144         }
<a name="l02145"></a>02145         <span class="keywordflow">return</span> getDecimalValue(retval);
<a name="l02146"></a>02146     }
<a name="l02147"></a>02147 
<a name="l02148"></a>02148     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getTinyIntValue(int8_t value) {
<a name="l02149"></a>02149         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>);
<a name="l02150"></a>02150         retval.getTinyInt() = value;
<a name="l02151"></a>02151         <span class="keywordflow">if</span> (value == <a class="code" href="value__defs_8h.html#a28837e97a5d6456361025639752e3619">INT8_NULL</a>) {
<a name="l02152"></a>02152             retval.tagAsNull();
<a name="l02153"></a>02153         }
<a name="l02154"></a>02154         <span class="keywordflow">return</span> retval;
<a name="l02155"></a>02155     }
<a name="l02156"></a>02156 
<a name="l02157"></a>02157     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getSmallIntValue(int16_t value) {
<a name="l02158"></a>02158         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>);
<a name="l02159"></a>02159         retval.getSmallInt() = value;
<a name="l02160"></a>02160         <span class="keywordflow">if</span> (value == <a class="code" href="value__defs_8h.html#a309a30298a279fb371620383187fd498">INT16_NULL</a>) {
<a name="l02161"></a>02161             retval.tagAsNull();
<a name="l02162"></a>02162         }
<a name="l02163"></a>02163         <span class="keywordflow">return</span> retval;
<a name="l02164"></a>02164     }
<a name="l02165"></a>02165 
<a name="l02166"></a>02166     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getIntegerValue(int32_t value) {
<a name="l02167"></a>02167         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>);
<a name="l02168"></a>02168         retval.getInteger() = value;
<a name="l02169"></a>02169         <span class="keywordflow">if</span> (value == <a class="code" href="value__defs_8h.html#a7b37f75b664751ae17bd3a801355bd7e">INT32_NULL</a>) {
<a name="l02170"></a>02170             retval.tagAsNull();
<a name="l02171"></a>02171         }
<a name="l02172"></a>02172         <span class="keywordflow">return</span> retval;
<a name="l02173"></a>02173     }
<a name="l02174"></a>02174 
<a name="l02175"></a>02175     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getBigIntValue(int64_t value) {
<a name="l02176"></a>02176         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>);
<a name="l02177"></a>02177         retval.getBigInt() = value;
<a name="l02178"></a>02178         <span class="keywordflow">if</span> (value == <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>) {
<a name="l02179"></a>02179             retval.tagAsNull();
<a name="l02180"></a>02180         }
<a name="l02181"></a>02181         <span class="keywordflow">return</span> retval;
<a name="l02182"></a>02182     }
<a name="l02183"></a>02183 
<a name="l02184"></a>02184     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getTimestampValue(int64_t value) {
<a name="l02185"></a>02185         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>);
<a name="l02186"></a>02186         retval.getTimestamp() = value;
<a name="l02187"></a>02187         <span class="keywordflow">if</span> (value == <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>) {
<a name="l02188"></a>02188             retval.tagAsNull();
<a name="l02189"></a>02189         }
<a name="l02190"></a>02190         <span class="keywordflow">return</span> retval;
<a name="l02191"></a>02191     }
<a name="l02192"></a>02192 
<a name="l02193"></a>02193     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getDoubleValue(<span class="keywordtype">double</span> value) {
<a name="l02194"></a>02194         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>);
<a name="l02195"></a>02195         retval.getDouble() = value;
<a name="l02196"></a>02196         <span class="keywordflow">if</span> (value &lt;= <a class="code" href="value__defs_8h.html#aa5313fdf2f378a2571bb4c554d992483">DOUBLE_NULL</a>) {
<a name="l02197"></a>02197             retval.tagAsNull();
<a name="l02198"></a>02198         }
<a name="l02199"></a>02199         <span class="keywordflow">return</span> retval;
<a name="l02200"></a>02200     }
<a name="l02201"></a>02201 
<a name="l02202"></a>02202     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getDecimalValueFromString(<span class="keyword">const</span> std::string &amp;value) {
<a name="l02203"></a>02203         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02204"></a>02204         retval.createDecimalFromString(value);
<a name="l02205"></a>02205         <span class="keywordflow">return</span> retval;
<a name="l02206"></a>02206     }
<a name="l02207"></a>02207 
<a name="l02208"></a>02208     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getAllocatedArrayValueFromSizeAndType(<span class="keywordtype">size_t</span> elementCount, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> elementType)
<a name="l02209"></a>02209     {
<a name="l02210"></a>02210         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaac3105256256a4983c6311316426b4f5">VALUE_TYPE_ARRAY</a>);
<a name="l02211"></a>02211         retval.allocateANewNValueList(elementCount, elementType);
<a name="l02212"></a>02212         <span class="keywordflow">return</span> retval;
<a name="l02213"></a>02213     }
<a name="l02214"></a>02214 
<a name="l02215"></a>02215     <span class="keyword">static</span> Pool* getTempStringPool();
<a name="l02216"></a>02216 
<a name="l02217"></a>02217     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getTempStringValue(<span class="keyword">const</span> <span class="keywordtype">char</span>* value, <span class="keywordtype">size_t</span> size) {
<a name="l02218"></a>02218         <span class="keywordflow">return</span> getAllocatedValue(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>, value, size, getTempStringPool());
<a name="l02219"></a>02219     }
<a name="l02220"></a>02220 
<a name="l02221"></a>02221     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getTempBinaryValue(<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* value, <span class="keywordtype">size_t</span> size) {
<a name="l02222"></a>02222         <span class="keywordflow">return</span> getAllocatedValue(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>, reinterpret_cast&lt;const char*&gt;(value), size, getTempStringPool());
<a name="l02223"></a>02223     }
<a name="l02224"></a>02224 
<a name="l02226"></a>02226     <span class="keyword">static</span> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getTempBinaryValueFromHex(<span class="keyword">const</span> std::string&amp; value) {
<a name="l02227"></a>02227         <span class="keywordtype">size_t</span> rawLength = value.length() / 2;
<a name="l02228"></a>02228         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> rawBuf[rawLength];
<a name="l02229"></a>02229         <a class="code" href="namespacevoltdb.html#a0acb647ea15150be83c793b636c67d8f">hexDecodeToBinary</a>(rawBuf, value.c_str());
<a name="l02230"></a>02230         <span class="keywordflow">return</span> getTempBinaryValue(rawBuf, rawLength);
<a name="l02231"></a>02231     }
<a name="l02232"></a>02232 
<a name="l02233"></a>02233     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getAllocatedValue(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keyword">const</span> <span class="keywordtype">char</span>* value, <span class="keywordtype">size_t</span> size, Pool* stringPool) {
<a name="l02234"></a>02234         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(type);
<a name="l02235"></a>02235         <span class="keywordtype">char</span>* storage = retval.allocateValueStorage((int32_t)size, stringPool);
<a name="l02236"></a>02236         ::memcpy(storage, value, (int32_t)size);
<a name="l02237"></a>02237         <span class="keywordflow">return</span> retval;
<a name="l02238"></a>02238     }
<a name="l02239"></a>02239 
<a name="l02240"></a>02240     <span class="keywordtype">char</span>* allocateValueStorage(int32_t length, Pool* stringPool)
<a name="l02241"></a>02241     {
<a name="l02242"></a>02242         <span class="comment">// This unsets the NValue&apos;s null tag and returns the length of the length.</span>
<a name="l02243"></a>02243         <span class="keyword">const</span> int8_t lengthLength = setObjectLength(length);
<a name="l02244"></a>02244         <span class="keyword">const</span> int32_t minLength = length + lengthLength;
<a name="l02245"></a>02245         StringRef* sref = <a class="code" href="classvoltdb_1_1StringRef.html#a895351e07df609b0385fe2c82ea891f9">StringRef::create</a>(minLength, stringPool);
<a name="l02246"></a>02246         <span class="keywordtype">char</span>* storage = sref-&gt;get();
<a name="l02247"></a>02247         setObjectLengthToLocation(length, storage);
<a name="l02248"></a>02248         storage += lengthLength;
<a name="l02249"></a>02249         setObjectValue(sref);
<a name="l02250"></a>02250         <span class="keywordflow">return</span> storage;
<a name="l02251"></a>02251     }
<a name="l02252"></a>02252 
<a name="l02253"></a>02253     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getNullStringValue() {
<a name="l02254"></a>02254         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>);
<a name="l02255"></a>02255         retval.tagAsNull();
<a name="l02256"></a>02256         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>**<span class="keyword">&gt;</span>(retval.m_data) = NULL;
<a name="l02257"></a>02257         <span class="keywordflow">return</span> retval;
<a name="l02258"></a>02258     }
<a name="l02259"></a>02259 
<a name="l02260"></a>02260     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getNullBinaryValue() {
<a name="l02261"></a>02261         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>);
<a name="l02262"></a>02262         retval.tagAsNull();
<a name="l02263"></a>02263         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>**<span class="keyword">&gt;</span>(retval.m_data) = NULL;
<a name="l02264"></a>02264         <span class="keywordflow">return</span> retval;
<a name="l02265"></a>02265     }
<a name="l02266"></a>02266 
<a name="l02267"></a>02267     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">getNullValue</a>() {
<a name="l02268"></a>02268         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>);
<a name="l02269"></a>02269         retval.tagAsNull();
<a name="l02270"></a>02270         <span class="keywordflow">return</span> retval;
<a name="l02271"></a>02271     }
<a name="l02272"></a>02272 
<a name="l02273"></a>02273     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getDecimalValue(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> value) {
<a name="l02274"></a>02274         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>);
<a name="l02275"></a>02275         retval.getDecimal() = value;
<a name="l02276"></a>02276         <span class="keywordflow">return</span> retval;
<a name="l02277"></a>02277     }
<a name="l02278"></a>02278 
<a name="l02279"></a>02279     <span class="keyword">static</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> getAddressValue(<span class="keywordtype">void</span> *address) {
<a name="l02280"></a>02280         <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>);
<a name="l02281"></a>02281         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>**<span class="keyword">&gt;</span>(retval.m_data) = address;
<a name="l02282"></a>02282         <span class="keywordflow">return</span> retval;
<a name="l02283"></a>02283     }
<a name="l02284"></a>02284 };
<a name="l02285"></a>02285 
<a name="l02290"></a><a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">02290</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html#a4012aec99fc553b30f3b722980413148">NValue::NValue</a>() {
<a name="l02291"></a>02291     ::memset( m_data, 0, 16);
<a name="l02292"></a>02292     setValueType(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfadf0950da0461f672a649ed99379c3f6f">VALUE_TYPE_INVALID</a>);
<a name="l02293"></a>02293     m_sourceInlined = <span class="keyword">false</span>;
<a name="l02294"></a>02294 }
<a name="l02295"></a>02295 
<a name="l02299"></a><a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">02299</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">NValue::getTrue</a>() {
<a name="l02300"></a>02300     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>);
<a name="l02301"></a>02301     retval.getBoolean() = <span class="keyword">true</span>;
<a name="l02302"></a>02302     <span class="keywordflow">return</span> retval;
<a name="l02303"></a>02303 }
<a name="l02304"></a>02304 
<a name="l02308"></a><a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">02308</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">NValue::getFalse</a>() {
<a name="l02309"></a>02309     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> retval(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>);
<a name="l02310"></a>02310     retval.getBoolean() = <span class="keyword">false</span>;
<a name="l02311"></a>02311     <span class="keywordflow">return</span> retval;
<a name="l02312"></a>02312 }
<a name="l02313"></a>02313 
<a name="l02318"></a><a class="code" href="classvoltdb_1_1NValue.html#a2efd2a52c08f486da5f379c6ac6a32fc">02318</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#a2efd2a52c08f486da5f379c6ac6a32fc">NValue::isTrue</a>()<span class="keyword"> const </span>{
<a name="l02319"></a>02319     <span class="keywordflow">if</span> (isBooleanNULL()) {
<a name="l02320"></a>02320         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02321"></a>02321     }
<a name="l02322"></a>02322     <span class="keywordflow">return</span> getBoolean();
<a name="l02323"></a>02323 }
<a name="l02324"></a>02324 
<a name="l02329"></a><a class="code" href="classvoltdb_1_1NValue.html#ab3a6d921f60ebb10a1d539db39c38089">02329</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#ab3a6d921f60ebb10a1d539db39c38089">NValue::isFalse</a>()<span class="keyword"> const </span>{
<a name="l02330"></a>02330     <span class="keywordflow">if</span> (isBooleanNULL()) {
<a name="l02331"></a>02331         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02332"></a>02332     }
<a name="l02333"></a>02333     <span class="keywordflow">return</span> !getBoolean();
<a name="l02334"></a>02334 }
<a name="l02335"></a>02335 
<a name="l02336"></a>02336 <span class="keyword">inline</span> <span class="keywordtype">bool</span> NValue::isBooleanNULL()<span class="keyword"> const </span>{
<a name="l02337"></a>02337     assert(getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>);
<a name="l02338"></a>02338     <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int8_t*<span class="keyword">&gt;</span>(m_data) == <a class="code" href="value__defs_8h.html#a28837e97a5d6456361025639752e3619">INT8_NULL</a>;
<a name="l02339"></a>02339 }
<a name="l02340"></a>02340 
<a name="l02341"></a><a class="code" href="classvoltdb_1_1NValue.html#a3402a342cb62159a651623f825ed5e3d">02341</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#a3402a342cb62159a651623f825ed5e3d">NValue::getSourceInlined</a>()<span class="keyword"> const </span>{
<a name="l02342"></a>02342     <span class="keywordflow">return</span> m_sourceInlined;
<a name="l02343"></a>02343 }
<a name="l02344"></a>02344 
<a name="l02349"></a><a class="code" href="classvoltdb_1_1NValue.html#aa876019cd4d75772a0dd8b608275f07f">02349</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#aa876019cd4d75772a0dd8b608275f07f">NValue::free</a>()<span class="keyword"> const </span>{
<a name="l02350"></a>02350     <span class="keywordflow">switch</span> (getValueType())
<a name="l02351"></a>02351     {
<a name="l02352"></a>02352     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02353"></a>02353     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02354"></a>02354     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaac3105256256a4983c6311316426b4f5">VALUE_TYPE_ARRAY</a>:
<a name="l02355"></a>02355         {
<a name="l02356"></a>02356             assert(!m_sourceInlined);
<a name="l02357"></a>02357             <a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>* sref = *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>* const*<span class="keyword">&gt;</span>(m_data);
<a name="l02358"></a>02358             <span class="keywordflow">if</span> (sref != NULL)
<a name="l02359"></a>02359             {
<a name="l02360"></a>02360                 <a class="code" href="classvoltdb_1_1StringRef.html#a42d5c43282b20f0eebd41550dc7c1dd3">StringRef::destroy</a>(sref);
<a name="l02361"></a>02361             }
<a name="l02362"></a>02362         }
<a name="l02363"></a>02363         <span class="keywordflow">break</span>;
<a name="l02364"></a>02364     <span class="keywordflow">default</span>:
<a name="l02365"></a>02365         <span class="keywordflow">return</span>;
<a name="l02366"></a>02366     }
<a name="l02367"></a>02367 }
<a name="l02368"></a>02368 
<a name="l02369"></a><a class="code" href="classvoltdb_1_1NValue.html#a1ded28b253bd9bc49c3d159bba67476f">02369</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a1ded28b253bd9bc49c3d159bba67476f">NValue::freeObjectsFromTupleStorage</a>(std::vector&lt;char*&gt; <span class="keyword">const</span> &amp;oldObjects)
<a name="l02370"></a>02370 {
<a name="l02371"></a>02371 
<a name="l02372"></a>02372     <span class="keywordflow">for</span> (std::vector&lt;char*&gt;::const_iterator it = oldObjects.begin(); it != oldObjects.end(); ++it) {
<a name="l02373"></a>02373         <a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>* sref = <span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>*<span class="keyword">&gt;</span>(*it);
<a name="l02374"></a>02374         <span class="keywordflow">if</span> (sref != NULL) {
<a name="l02375"></a>02375             <a class="code" href="classvoltdb_1_1StringRef.html#a42d5c43282b20f0eebd41550dc7c1dd3">StringRef::destroy</a>(sref);
<a name="l02376"></a>02376         }
<a name="l02377"></a>02377     }
<a name="l02378"></a>02378 }
<a name="l02379"></a>02379 
<a name="l02384"></a><a class="code" href="classvoltdb_1_1NValue.html#a1aa0d26a314b33da709fc441a4f74eb2">02384</a> <span class="keyword">inline</span> uint16_t <a class="code" href="classvoltdb_1_1NValue.html#a1aa0d26a314b33da709fc441a4f74eb2">NValue::getTupleStorageSize</a>(<span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type) {
<a name="l02385"></a>02385     <span class="keywordflow">switch</span> (type) {
<a name="l02386"></a>02386       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02387"></a>02387       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02388"></a>02388         <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(int64_t);
<a name="l02389"></a>02389       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02390"></a>02390         <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(int8_t);
<a name="l02391"></a>02391       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02392"></a>02392         <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(int16_t);
<a name="l02393"></a>02393       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02394"></a>02394         <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(int32_t);
<a name="l02395"></a>02395       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02396"></a>02396         <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(double);
<a name="l02397"></a>02397       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02398"></a>02398       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02399"></a>02399         <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*);
<a name="l02400"></a>02400       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l02401"></a>02401         <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>);
<a name="l02402"></a>02402       <span class="keywordflow">default</span>:
<a name="l02403"></a>02403           <span class="keywordtype">char</span> message[128];
<a name="l02404"></a>02404           snprintf(message, 128, <span class="stringliteral">&quot;NValue::getTupleStorageSize() unsupported type &apos;%s&apos;&quot;</span>,
<a name="l02405"></a>02405                    <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(type).c_str());
<a name="l02406"></a>02406           <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SerializableEEException.html">SerializableEEException</a>(<a class="code" href="namespacevoltdb.html#a88ec47ad3308f779e49d2fd43465ac21a438b236a5020b47ad206e5e7f2671d02">VOLT_EE_EXCEPTION_TYPE_EEEXCEPTION</a>,
<a name="l02407"></a>02407                                         message);
<a name="l02408"></a>02408     }
<a name="l02409"></a>02409 }
<a name="l02410"></a>02410 
<a name="l02416"></a><a class="code" href="classvoltdb_1_1NValue.html#a35090b8292141609554abf4201abda02">02416</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoltdb_1_1NValue.html#a35090b8292141609554abf4201abda02">NValue::compareNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l02417"></a>02417     <span class="keywordtype">bool</span> lnull = <a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>();
<a name="l02418"></a>02418     <span class="keywordtype">bool</span> rnull = rhs.<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>();
<a name="l02419"></a>02419 
<a name="l02420"></a>02420     <span class="keywordflow">if</span> (lnull) {
<a name="l02421"></a>02421         <span class="keywordflow">if</span> (rnull) {
<a name="l02422"></a>02422             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2ffcae2039122e5a2a498803d320dbb5">VALUE_COMPARE_EQUAL</a>;
<a name="l02423"></a>02423         } <span class="keywordflow">else</span> {
<a name="l02424"></a>02424             <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#af882bfbd493ce52cec9247407876176f">VALUE_COMPARE_LESSTHAN</a>;
<a name="l02425"></a>02425         }
<a name="l02426"></a>02426     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (rnull) {
<a name="l02427"></a>02427         <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a2f936387f4f8b063c6ab291b0337d41f">VALUE_COMPARE_GREATERTHAN</a>;
<a name="l02428"></a>02428     }
<a name="l02429"></a>02429     <span class="keywordflow">return</span> <a class="code" href="value__defs_8h.html#a8eeae2592597e062ef4aac9b2ffaa98d">VALUE_COMPARE_INVALID</a>;
<a name="l02430"></a>02430 }
<a name="l02431"></a>02431 
<a name="l02438"></a><a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">02438</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">NValue::compare_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l02439"></a>02439     assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span> &amp;&amp; rhs.<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l02440"></a>02440 
<a name="l02441"></a>02441     <span class="keywordflow">switch</span> (m_valueType) {
<a name="l02442"></a>02442     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02443"></a>02443         <span class="keywordflow">return</span> compareStringValue(rhs);
<a name="l02444"></a>02444     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02445"></a>02445         <span class="keywordflow">return</span> compareBigInt(rhs);
<a name="l02446"></a>02446     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02447"></a>02447         <span class="keywordflow">return</span> compareInteger(rhs);
<a name="l02448"></a>02448     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02449"></a>02449         <span class="keywordflow">return</span> compareSmallInt(rhs);
<a name="l02450"></a>02450     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02451"></a>02451         <span class="keywordflow">return</span> compareTinyInt(rhs);
<a name="l02452"></a>02452     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02453"></a>02453         <span class="keywordflow">return</span> compareTimestamp(rhs);
<a name="l02454"></a>02454     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02455"></a>02455         <span class="keywordflow">return</span> compareDoubleValue(rhs);
<a name="l02456"></a>02456     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02457"></a>02457         <span class="keywordflow">return</span> compareBinaryValue(rhs);
<a name="l02458"></a>02458     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l02459"></a>02459         <span class="keywordflow">return</span> compareDecimalValue(rhs);
<a name="l02460"></a>02460     <span class="keywordflow">default</span>: {
<a name="l02461"></a>02461         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(
<a name="l02462"></a>02462                 <span class="stringliteral">&quot;non comparable types lhs &apos;%s&apos; rhs &apos;%s&apos;&quot;</span>,
<a name="l02463"></a>02463                 getValueTypeString().c_str(),
<a name="l02464"></a>02464                 rhs.getValueTypeString().c_str());
<a name="l02465"></a>02465     }
<a name="l02466"></a>02466     <span class="comment">/* no break */</span>
<a name="l02467"></a>02467     }
<a name="l02468"></a>02468 }
<a name="l02469"></a>02469 
<a name="l02475"></a><a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">02475</a> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">NValue::compare</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l02476"></a>02476     <span class="keywordtype">int</span> hasNullCompare = <a class="code" href="classvoltdb_1_1NValue.html#a35090b8292141609554abf4201abda02">compareNull</a>(rhs);
<a name="l02477"></a>02477     <span class="keywordflow">if</span> (hasNullCompare != <a class="code" href="value__defs_8h.html#a8eeae2592597e062ef4aac9b2ffaa98d">VALUE_COMPARE_INVALID</a>) {
<a name="l02478"></a>02478         <span class="keywordflow">return</span> hasNullCompare;
<a name="l02479"></a>02479     }
<a name="l02480"></a>02480 
<a name="l02481"></a>02481     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(rhs);
<a name="l02482"></a>02482 }
<a name="l02483"></a>02483 
<a name="l02487"></a><a class="code" href="classvoltdb_1_1NValue.html#a249dfdbc4b3bfa2f1b9e9303c4ba0de4">02487</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a249dfdbc4b3bfa2f1b9e9303c4ba0de4">NValue::setNull</a>() {
<a name="l02488"></a>02488     tagAsNull(); <span class="comment">// This gets overwritten for DECIMAL -- but that&apos;s OK.</span>
<a name="l02489"></a>02489     <span class="keywordflow">switch</span> (getValueType())
<a name="l02490"></a>02490     {
<a name="l02491"></a>02491     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>:
<a name="l02492"></a>02492         <span class="comment">// HACK BOOL NULL</span>
<a name="l02493"></a>02493         *<span class="keyword">reinterpret_cast&lt;</span>int8_t*<span class="keyword">&gt;</span>(m_data) = <a class="code" href="value__defs_8h.html#a28837e97a5d6456361025639752e3619">INT8_NULL</a>;
<a name="l02494"></a>02494         <span class="keywordflow">break</span>;
<a name="l02495"></a>02495     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>:
<a name="l02496"></a>02496     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfadf0950da0461f672a649ed99379c3f6f">VALUE_TYPE_INVALID</a>:
<a name="l02497"></a>02497         <span class="keywordflow">return</span>;
<a name="l02498"></a>02498     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02499"></a>02499         getTinyInt() = <a class="code" href="value__defs_8h.html#a28837e97a5d6456361025639752e3619">INT8_NULL</a>;
<a name="l02500"></a>02500         <span class="keywordflow">break</span>;
<a name="l02501"></a>02501     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02502"></a>02502         getSmallInt() = <a class="code" href="value__defs_8h.html#a309a30298a279fb371620383187fd498">INT16_NULL</a>;
<a name="l02503"></a>02503         <span class="keywordflow">break</span>;
<a name="l02504"></a>02504     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02505"></a>02505         getInteger() = <a class="code" href="value__defs_8h.html#a7b37f75b664751ae17bd3a801355bd7e">INT32_NULL</a>;
<a name="l02506"></a>02506         <span class="keywordflow">break</span>;
<a name="l02507"></a>02507     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02508"></a>02508         getTimestamp() = <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>;
<a name="l02509"></a>02509         <span class="keywordflow">break</span>;
<a name="l02510"></a>02510     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02511"></a>02511         getBigInt() = <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>;
<a name="l02512"></a>02512         <span class="keywordflow">break</span>;
<a name="l02513"></a>02513     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02514"></a>02514         getDouble() = <a class="code" href="value__defs_8h.html#a526639fcb172e9377c68fc180820269d">DOUBLE_MIN</a>;
<a name="l02515"></a>02515         <span class="keywordflow">break</span>;
<a name="l02516"></a>02516     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02517"></a>02517     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02518"></a>02518         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>**<span class="keyword">&gt;</span>(m_data) = NULL;
<a name="l02519"></a>02519         <span class="keywordflow">break</span>;
<a name="l02520"></a>02520     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l02521"></a>02521         getDecimal().SetMin();
<a name="l02522"></a>02522         <span class="keywordflow">break</span>;
<a name="l02523"></a>02523     <span class="keywordflow">default</span>: {
<a name="l02524"></a>02524         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;NValue::setNull() called with unsupported ValueType &apos;%d&apos;&quot;</span>, getValueType());
<a name="l02525"></a>02525     }
<a name="l02526"></a>02526     }
<a name="l02527"></a>02527 }
<a name="l02528"></a>02528 
<a name="l02534"></a><a class="code" href="classvoltdb_1_1NValue.html#a37dd81843b76fa8b374ae4b456b12e49">02534</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a37dd81843b76fa8b374ae4b456b12e49">NValue::initFromTupleStorage</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *storage, <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keywordtype">bool</span> isInlined)
<a name="l02535"></a>02535 {
<a name="l02536"></a>02536     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> retval(type);
<a name="l02537"></a>02537     <span class="keywordflow">switch</span> (type)
<a name="l02538"></a>02538     {
<a name="l02539"></a>02539     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02540"></a>02540         <span class="keywordflow">if</span> ((retval.getInteger() = *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int32_t*<span class="keyword">&gt;</span>(storage)) == <a class="code" href="value__defs_8h.html#a7b37f75b664751ae17bd3a801355bd7e">INT32_NULL</a>) {
<a name="l02541"></a>02541             retval.tagAsNull();
<a name="l02542"></a>02542         }
<a name="l02543"></a>02543         <span class="keywordflow">break</span>;
<a name="l02544"></a>02544     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02545"></a>02545         <span class="keywordflow">if</span> ((retval.getBigInt() = *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int64_t*<span class="keyword">&gt;</span>(storage)) == <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>) {
<a name="l02546"></a>02546             retval.tagAsNull();
<a name="l02547"></a>02547         }
<a name="l02548"></a>02548         <span class="keywordflow">break</span>;
<a name="l02549"></a>02549     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02550"></a>02550         <span class="keywordflow">if</span> ((retval.getDouble() = *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(storage)) &lt;= <a class="code" href="value__defs_8h.html#aa5313fdf2f378a2571bb4c554d992483">DOUBLE_NULL</a>) {
<a name="l02551"></a>02551             retval.tagAsNull();
<a name="l02552"></a>02552         }
<a name="l02553"></a>02553         <span class="keywordflow">break</span>;
<a name="l02554"></a>02554     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02555"></a>02555     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02556"></a>02556     {
<a name="l02557"></a>02557         <span class="comment">//Potentially non-inlined type requires special handling</span>
<a name="l02558"></a>02558         <span class="keywordflow">if</span> (isInlined) {
<a name="l02559"></a>02559             <span class="comment">//If it is inlined the storage area contains the actual data so copy a reference</span>
<a name="l02560"></a>02560             <span class="comment">//to the storage area</span>
<a name="l02561"></a>02561             <span class="keyword">const</span> <span class="keywordtype">char</span>* inline_data = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(storage);
<a name="l02562"></a>02562             *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>**<span class="keyword">&gt;</span>(retval.m_data) = inline_data;
<a name="l02563"></a>02563             retval.setSourceInlined(<span class="keyword">true</span>);
<a name="l02568"></a>02568             <span class="keywordflow">if</span> ((inline_data[0] &amp; <a class="code" href="NValue_8hpp.html#a739d0b39c04a69c173db87bce273e19c">OBJECT_NULL_BIT</a>) != 0) {
<a name="l02569"></a>02569                 retval.tagAsNull();
<a name="l02570"></a>02570                 <span class="keywordflow">break</span>;
<a name="l02571"></a>02571             }
<a name="l02572"></a>02572             <span class="keywordtype">int</span> length = inline_data[0];
<a name="l02573"></a>02573             <span class="comment">//std::cout &lt;&lt; &quot;NValue::initFromTupleStorage: length: &quot; &lt;&lt; length &lt;&lt; std::endl;</span>
<a name="l02574"></a>02574             retval.setObjectLength(length); <span class="comment">// this unsets the null tag.</span>
<a name="l02575"></a>02575             <span class="keywordflow">break</span>;
<a name="l02576"></a>02576         }
<a name="l02577"></a>02577 
<a name="l02578"></a>02578         <span class="comment">// If it isn&apos;t inlined the storage area contains a pointer to the</span>
<a name="l02579"></a>02579         <span class="comment">// StringRef object containing the string&apos;s memory</span>
<a name="l02580"></a>02580         <a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>* sref = *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>**<span class="keyword">&gt;</span>(<span class="keyword">const_cast&lt;</span><span class="keywordtype">void</span>*<span class="keyword">&gt;</span>(storage));
<a name="l02581"></a>02581         *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>**<span class="keyword">&gt;</span>(retval.m_data) = sref;
<a name="l02582"></a>02582         <span class="comment">// If the StringRef pointer is null, that&apos;s because this</span>
<a name="l02583"></a>02583         <span class="comment">// was a null value; otherwise get the right char* from the StringRef</span>
<a name="l02584"></a>02584         <span class="keywordflow">if</span> (sref == NULL) {
<a name="l02585"></a>02585             retval.tagAsNull();
<a name="l02586"></a>02586             <span class="keywordflow">break</span>;
<a name="l02587"></a>02587         }
<a name="l02588"></a>02588 
<a name="l02589"></a>02589         <span class="comment">// Cache the object length in the NValue.</span>
<a name="l02590"></a>02590 
<a name="l02591"></a>02591         <span class="comment">/* The format for a length preceding value is a 1-byte short representation</span>
<a name="l02592"></a>02592 <span class="comment">         * with the the 7th bit used to indicate a null value and the 8th bit used</span>
<a name="l02593"></a>02593 <span class="comment">         * to indicate that this is part of a long representation and that 3 bytes</span>
<a name="l02594"></a>02594 <span class="comment">         * follow. 6 bits are available to represent length for a maximum length</span>
<a name="l02595"></a>02595 <span class="comment">         * of 63 bytes representable with a single byte length. 30 bits are available</span>
<a name="l02596"></a>02596 <span class="comment">         * when the continuation bit is set and 3 bytes follow.</span>
<a name="l02597"></a>02597 <span class="comment">         *</span>
<a name="l02598"></a>02598 <span class="comment">         * The value is converted to network byte order so that the code</span>
<a name="l02599"></a>02599 <span class="comment">         * will always know which byte contains the most signficant digits.</span>
<a name="l02600"></a>02600 <span class="comment">         */</span>
<a name="l02601"></a>02601 
<a name="l02602"></a>02602         <span class="comment">/*</span>
<a name="l02603"></a>02603 <span class="comment">         * Generated mask that removes the null and continuation bits</span>
<a name="l02604"></a>02604 <span class="comment">         * from a single byte length value</span>
<a name="l02605"></a>02605 <span class="comment">         */</span>
<a name="l02606"></a>02606         <span class="keyword">const</span> <span class="keywordtype">char</span> mask = ~static_cast&lt;<span class="keywordtype">char</span>&gt;(<a class="code" href="NValue_8hpp.html#a739d0b39c04a69c173db87bce273e19c">OBJECT_NULL_BIT</a> | <a class="code" href="NValue_8hpp.html#ab41edea328152f927ebf6ff9eae5af6c">OBJECT_CONTINUATION_BIT</a>);
<a name="l02607"></a>02607 
<a name="l02608"></a>02608         <span class="keywordtype">char</span>* data = sref-&gt;<a class="code" href="classvoltdb_1_1StringRef.html#a08806c9ba483b7f54e10b6948db679ed">get</a>();
<a name="l02609"></a>02609         int32_t length = 0;
<a name="l02610"></a>02610         <span class="keywordflow">if</span> ((data[0] &amp; <a class="code" href="NValue_8hpp.html#ab41edea328152f927ebf6ff9eae5af6c">OBJECT_CONTINUATION_BIT</a>) != 0) {
<a name="l02611"></a>02611             <span class="keywordtype">char</span> numberBytes[4];
<a name="l02612"></a>02612             numberBytes[0] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">char</span><span class="keyword">&gt;</span>(data[0] &amp; mask);
<a name="l02613"></a>02613             numberBytes[1] = data[1];
<a name="l02614"></a>02614             numberBytes[2] = data[2];
<a name="l02615"></a>02615             numberBytes[3] = data[3];
<a name="l02616"></a>02616             length = ntohl(*reinterpret_cast&lt;int32_t*&gt;(numberBytes));
<a name="l02617"></a>02617         } <span class="keywordflow">else</span> {
<a name="l02618"></a>02618             length = data[0] &amp; mask;
<a name="l02619"></a>02619         }
<a name="l02620"></a>02620 
<a name="l02621"></a>02621         <span class="comment">//std::cout &lt;&lt; &quot;NValue::initFromTupleStorage: length: &quot; &lt;&lt; length &lt;&lt; std::endl;</span>
<a name="l02622"></a>02622         retval.setObjectLength(length); <span class="comment">// this unsets the null tag.</span>
<a name="l02623"></a>02623         <span class="keywordflow">break</span>;
<a name="l02624"></a>02624     }
<a name="l02625"></a>02625     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02626"></a>02626         <span class="keywordflow">if</span> ((retval.getTimestamp() = *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int64_t*<span class="keyword">&gt;</span>(storage)) == <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>) {
<a name="l02627"></a>02627             retval.tagAsNull();
<a name="l02628"></a>02628         }
<a name="l02629"></a>02629         <span class="keywordflow">break</span>;
<a name="l02630"></a>02630     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02631"></a>02631         <span class="keywordflow">if</span> ((retval.getTinyInt() = *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int8_t*<span class="keyword">&gt;</span>(storage)) == <a class="code" href="value__defs_8h.html#a28837e97a5d6456361025639752e3619">INT8_NULL</a>) {
<a name="l02632"></a>02632             retval.tagAsNull();
<a name="l02633"></a>02633         }
<a name="l02634"></a>02634         <span class="keywordflow">break</span>;
<a name="l02635"></a>02635     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02636"></a>02636         <span class="keywordflow">if</span> ((retval.getSmallInt() = *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int16_t*<span class="keyword">&gt;</span>(storage)) == <a class="code" href="value__defs_8h.html#a309a30298a279fb371620383187fd498">INT16_NULL</a>) {
<a name="l02637"></a>02637             retval.tagAsNull();
<a name="l02638"></a>02638         }
<a name="l02639"></a>02639         <span class="keywordflow">break</span>;
<a name="l02640"></a>02640     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l02641"></a>02641     {
<a name="l02642"></a>02642         ::memcpy(retval.m_data, storage, <span class="keyword">sizeof</span>(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>));
<a name="l02643"></a>02643         <span class="keywordflow">break</span>;
<a name="l02644"></a>02644     }
<a name="l02645"></a>02645     <span class="keywordflow">default</span>:
<a name="l02646"></a>02646         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;NValue::initFromTupleStorage() invalid column type &apos;%s&apos;&quot;</span>,
<a name="l02647"></a>02647                                  <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(type).c_str());
<a name="l02648"></a>02648                                  <span class="comment">/* no break */</span>
<a name="l02649"></a>02649     }
<a name="l02650"></a>02650     <span class="keywordflow">return</span> retval;
<a name="l02651"></a>02651 }
<a name="l02652"></a>02652 
<a name="l02659"></a><a class="code" href="classvoltdb_1_1NValue.html#a83842fe74fb3154969144a67d2350b4d">02659</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a83842fe74fb3154969144a67d2350b4d">NValue::serializeToTupleStorageAllocateForObjects</a>(<span class="keywordtype">void</span> *storage, <span class="keyword">const</span> <span class="keywordtype">bool</span> isInlined,
<a name="l02660"></a>02660         <span class="keyword">const</span> int32_t maxLength, <span class="keyword">const</span> <span class="keywordtype">bool</span> isInBytes, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool)<span class="keyword"> const</span>
<a name="l02661"></a>02661 <span class="keyword"></span>{
<a name="l02662"></a>02662     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l02663"></a>02663 
<a name="l02664"></a>02664     <span class="keywordflow">switch</span> (type) {
<a name="l02665"></a>02665     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02666"></a>02666         *<span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(storage) = getTimestamp();
<a name="l02667"></a>02667         <span class="keywordflow">break</span>;
<a name="l02668"></a>02668     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02669"></a>02669         *<span class="keyword">reinterpret_cast&lt;</span>int8_t*<span class="keyword">&gt;</span>(storage) = getTinyInt();
<a name="l02670"></a>02670         <span class="keywordflow">break</span>;
<a name="l02671"></a>02671     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02672"></a>02672         *<span class="keyword">reinterpret_cast&lt;</span>int16_t*<span class="keyword">&gt;</span>(storage) = getSmallInt();
<a name="l02673"></a>02673         <span class="keywordflow">break</span>;
<a name="l02674"></a>02674     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02675"></a>02675         *<span class="keyword">reinterpret_cast&lt;</span>int32_t*<span class="keyword">&gt;</span>(storage) = getInteger();
<a name="l02676"></a>02676         <span class="keywordflow">break</span>;
<a name="l02677"></a>02677     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02678"></a>02678         *<span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(storage) = getBigInt();
<a name="l02679"></a>02679         <span class="keywordflow">break</span>;
<a name="l02680"></a>02680     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02681"></a>02681         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(storage) = getDouble();
<a name="l02682"></a>02682         <span class="keywordflow">break</span>;
<a name="l02683"></a>02683     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l02684"></a>02684         ::memcpy(storage, m_data, <span class="keyword">sizeof</span>(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>));
<a name="l02685"></a>02685         <span class="keywordflow">break</span>;
<a name="l02686"></a>02686     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02687"></a>02687     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02688"></a>02688         <span class="comment">//Potentially non-inlined type requires special handling</span>
<a name="l02689"></a>02689         <span class="keywordflow">if</span> (isInlined) {
<a name="l02690"></a>02690             inlineCopyObject(storage, maxLength, isInBytes);
<a name="l02691"></a>02691         }
<a name="l02692"></a>02692         <span class="keywordflow">else</span> {
<a name="l02693"></a>02693             <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l02694"></a>02694                 *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>**<span class="keyword">&gt;</span>(storage) = NULL;
<a name="l02695"></a>02695             }
<a name="l02696"></a>02696             <span class="keywordflow">else</span> {
<a name="l02697"></a>02697                 int32_t objLength = getObjectLength_withoutNull();
<a name="l02698"></a>02698                 <span class="keyword">const</span> <span class="keywordtype">char</span>* ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l02699"></a>02699                 checkTooNarrowVarcharAndVarbinary(m_valueType, ptr, objLength, maxLength, isInBytes);
<a name="l02700"></a>02700 
<a name="l02701"></a>02701                 <span class="keyword">const</span> int8_t lengthLength = getObjectLengthLength();
<a name="l02702"></a>02702                 <span class="keyword">const</span> int32_t minlength = lengthLength + objLength;
<a name="l02703"></a>02703                 <a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>* sref = <a class="code" href="classvoltdb_1_1StringRef.html#a895351e07df609b0385fe2c82ea891f9">StringRef::create</a>(minlength, dataPool);
<a name="l02704"></a>02704                 <span class="keywordtype">char</span> *copy = sref-&gt;<a class="code" href="classvoltdb_1_1StringRef.html#a08806c9ba483b7f54e10b6948db679ed">get</a>();
<a name="l02705"></a>02705                 setObjectLengthToLocation(objLength, copy);
<a name="l02706"></a>02706                 ::memcpy(copy + lengthLength, getObjectValue_withoutNull(), objLength);
<a name="l02707"></a>02707                 *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>**<span class="keyword">&gt;</span>(storage) = sref;
<a name="l02708"></a>02708             }
<a name="l02709"></a>02709         }
<a name="l02710"></a>02710         <span class="keywordflow">break</span>;
<a name="l02711"></a>02711     <span class="keywordflow">default</span>: {
<a name="l02712"></a>02712         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(
<a name="l02713"></a>02713                 <span class="stringliteral">&quot;NValue::serializeToTupleStorageAllocateForObjects() unrecognized type &apos;%s&apos;&quot;</span>,
<a name="l02714"></a>02714                 <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(type).c_str());
<a name="l02715"></a>02715     }
<a name="l02716"></a>02716     }
<a name="l02717"></a>02717 }
<a name="l02718"></a>02718 
<a name="l02727"></a><a class="code" href="classvoltdb_1_1NValue.html#a52176939ccf0825e11b056a8a89be171">02727</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a52176939ccf0825e11b056a8a89be171">NValue::serializeToTupleStorage</a>(<span class="keywordtype">void</span> *storage, <span class="keyword">const</span> <span class="keywordtype">bool</span> isInlined,
<a name="l02728"></a>02728         <span class="keyword">const</span> int32_t maxLength, <span class="keyword">const</span> <span class="keywordtype">bool</span> isInBytes)<span class="keyword"> const</span>
<a name="l02729"></a>02729 <span class="keyword"></span>{
<a name="l02730"></a>02730     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l02731"></a>02731     <span class="keywordflow">switch</span> (type) {
<a name="l02732"></a>02732     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02733"></a>02733         *<span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(storage) = getTimestamp();
<a name="l02734"></a>02734         <span class="keywordflow">break</span>;
<a name="l02735"></a>02735     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02736"></a>02736         *<span class="keyword">reinterpret_cast&lt;</span>int8_t*<span class="keyword">&gt;</span>(storage) = getTinyInt();
<a name="l02737"></a>02737         <span class="keywordflow">break</span>;
<a name="l02738"></a>02738     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02739"></a>02739         *<span class="keyword">reinterpret_cast&lt;</span>int16_t*<span class="keyword">&gt;</span>(storage) = getSmallInt();
<a name="l02740"></a>02740         <span class="keywordflow">break</span>;
<a name="l02741"></a>02741     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02742"></a>02742         *<span class="keyword">reinterpret_cast&lt;</span>int32_t*<span class="keyword">&gt;</span>(storage) = getInteger();
<a name="l02743"></a>02743         <span class="keywordflow">break</span>;
<a name="l02744"></a>02744     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02745"></a>02745         *<span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(storage) = getBigInt();
<a name="l02746"></a>02746         <span class="keywordflow">break</span>;
<a name="l02747"></a>02747     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02748"></a>02748         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">double</span>*<span class="keyword">&gt;</span>(storage) = getDouble();
<a name="l02749"></a>02749         <span class="keywordflow">break</span>;
<a name="l02750"></a>02750     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l02751"></a>02751         ::memcpy( storage, m_data, <span class="keyword">sizeof</span>(<a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a>));
<a name="l02752"></a>02752         <span class="keywordflow">break</span>;
<a name="l02753"></a>02753     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02754"></a>02754     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02755"></a>02755         <span class="comment">//Potentially non-inlined type requires special handling</span>
<a name="l02756"></a>02756         <span class="keywordflow">if</span> (isInlined) {
<a name="l02757"></a>02757             inlineCopyObject(storage, maxLength, isInBytes);
<a name="l02758"></a>02758         }
<a name="l02759"></a>02759         <span class="keywordflow">else</span> {
<a name="l02760"></a>02760             <span class="keywordflow">if</span> (!<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l02761"></a>02761                 <span class="keywordtype">int</span> objLength = getObjectLength_withoutNull();
<a name="l02762"></a>02762                 <span class="keyword">const</span> <span class="keywordtype">char</span>* ptr = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l02763"></a>02763                 checkTooNarrowVarcharAndVarbinary(m_valueType, ptr, objLength, maxLength, isInBytes);
<a name="l02764"></a>02764             }
<a name="l02765"></a>02765 
<a name="l02766"></a>02766             <span class="comment">// copy the StringRef pointers, even for NULL case.</span>
<a name="l02767"></a>02767             <span class="keywordflow">if</span> (m_sourceInlined) {
<a name="l02768"></a>02768                 <span class="comment">// create a non-const temp here for the outlined value</span>
<a name="l02769"></a>02769                 <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> outlinedValue = *<span class="keyword">this</span>;
<a name="l02770"></a>02770                 outlinedValue.<a class="code" href="classvoltdb_1_1NValue.html#a6a8fc61d7eab259a50bc2a1846558f1d">allocateObjectFromInlinedValue</a>(getTempStringPool());
<a name="l02771"></a>02771                 *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>**<span class="keyword">&gt;</span>(storage) =
<a name="l02772"></a>02772                     *reinterpret_cast&lt;StringRef* const*&gt;(outlinedValue.m_data);
<a name="l02773"></a>02773             }
<a name="l02774"></a>02774             <span class="keywordflow">else</span> {
<a name="l02775"></a>02775                 *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>**<span class="keyword">&gt;</span>(storage) = *reinterpret_cast&lt;StringRef* const*&gt;(m_data);
<a name="l02776"></a>02776             }
<a name="l02777"></a>02777         }
<a name="l02778"></a>02778         <span class="keywordflow">break</span>;
<a name="l02779"></a>02779     <span class="keywordflow">default</span>:
<a name="l02780"></a>02780         <span class="keywordtype">char</span> message[128];
<a name="l02781"></a>02781         snprintf(message, 128, <span class="stringliteral">&quot;NValue::serializeToTupleStorage() unrecognized type &apos;%s&apos;&quot;</span>,
<a name="l02782"></a>02782                 <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(type).c_str());
<a name="l02783"></a>02783         <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a1e2e51ab20169799ec78d3ab44807e6d">SQLException::data_exception_most_specific_type_mismatch</a>,
<a name="l02784"></a>02784                 message);
<a name="l02785"></a>02785     }
<a name="l02786"></a>02786 }
<a name="l02787"></a>02787 
<a name="l02788"></a>02788 
<a name="l02796"></a><a class="code" href="classvoltdb_1_1NValue.html#add9c3e41fa63dbe2eff4d06500f9d1d7">02796</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a44a90f734b8acbc77bed5d307922af90">NValue::deserializeFrom</a>(<a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInputBE</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool, <span class="keywordtype">char</span> *storage,
<a name="l02797"></a>02797         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keywordtype">bool</span> isInlined, int32_t maxLength, <span class="keywordtype">bool</span> isInBytes) {
<a name="l02798"></a>02798     deserializeFrom&lt;TUPLE_SERIALIZATION_NATIVE&gt;(input, dataPool, storage, type, isInlined, maxLength, isInBytes);
<a name="l02799"></a>02799 }
<a name="l02800"></a>02800 
<a name="l02801"></a><a class="code" href="classvoltdb_1_1NValue.html#a44a90f734b8acbc77bed5d307922af90">02801</a> <span class="keyword">template</span> &lt;TupleSerializationFormat F, Endianess E&gt; <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a44a90f734b8acbc77bed5d307922af90">NValue::deserializeFrom</a>(<a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInput&lt;E&gt;</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool, <span class="keywordtype">char</span> *storage,
<a name="l02802"></a>02802         <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <span class="keywordtype">bool</span> isInlined, int32_t maxLength, <span class="keywordtype">bool</span> isInBytes) {
<a name="l02803"></a>02803 
<a name="l02804"></a>02804     <span class="keywordflow">switch</span> (type) {
<a name="l02805"></a>02805     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02806"></a>02806     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02807"></a>02807         *<span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(storage) = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a4538d2ab48f284e68a1032253a5b45ba">readLong</a>();
<a name="l02808"></a>02808         <span class="keywordflow">break</span>;
<a name="l02809"></a>02809     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02810"></a>02810         *<span class="keyword">reinterpret_cast&lt;</span>int8_t*<span class="keyword">&gt;</span>(storage) = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a19c0184d444ecf65190eb183489ba2f0">readByte</a>();
<a name="l02811"></a>02811         <span class="keywordflow">break</span>;
<a name="l02812"></a>02812     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02813"></a>02813         *<span class="keyword">reinterpret_cast&lt;</span>int16_t*<span class="keyword">&gt;</span>(storage) = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#ac0ce313c0eb162c72869e6802e456f1d">readShort</a>();
<a name="l02814"></a>02814         <span class="keywordflow">break</span>;
<a name="l02815"></a>02815     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02816"></a>02816         *<span class="keyword">reinterpret_cast&lt;</span>int32_t*<span class="keyword">&gt;</span>(storage) = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a206f9b37054c77b518f44a719e1a560b">readInt</a>();
<a name="l02817"></a>02817         <span class="keywordflow">break</span>;
<a name="l02818"></a>02818     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02819"></a>02819         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">double</span>* <span class="keyword">&gt;</span>(storage) = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a7f290444087030b7c2ff9ae690fb87fb">readDouble</a>();
<a name="l02820"></a>02820         <span class="keywordflow">break</span>;
<a name="l02821"></a>02821     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02822"></a>02822     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02823"></a>02823     {
<a name="l02824"></a>02824         <span class="keyword">const</span> int32_t length = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a206f9b37054c77b518f44a719e1a560b">readInt</a>();
<a name="l02825"></a>02825 
<a name="l02826"></a>02826         <span class="keyword">const</span> int8_t lengthLength = getAppropriateObjectLengthLength(length);
<a name="l02827"></a>02827         <span class="comment">// the NULL SQL string is a NULL C pointer</span>
<a name="l02828"></a>02828         <span class="keywordflow">if</span> (isInlined) {
<a name="l02829"></a>02829             setObjectLengthToLocation(length, storage);
<a name="l02830"></a>02830             <span class="keywordflow">if</span> (length == <a class="code" href="value__defs_8h.html#aefcabebc545a1781a75ddb761686e50f">OBJECTLENGTH_NULL</a>) {
<a name="l02831"></a>02831                 <span class="keywordflow">break</span>;
<a name="l02832"></a>02832             }
<a name="l02833"></a>02833             <span class="keyword">const</span> <span class="keywordtype">char</span> *data = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a9fa696b4a0bbc4a86a63a1d4323ccf1c">getRawPointer</a>(length));
<a name="l02834"></a>02834             checkTooNarrowVarcharAndVarbinary(type, data, length, maxLength, isInBytes);
<a name="l02835"></a>02835 
<a name="l02836"></a>02836             ::memcpy( storage + lengthLength, data, length);
<a name="l02837"></a>02837         } <span class="keywordflow">else</span> {
<a name="l02838"></a>02838             <span class="keywordflow">if</span> (length == <a class="code" href="value__defs_8h.html#aefcabebc545a1781a75ddb761686e50f">OBJECTLENGTH_NULL</a>) {
<a name="l02839"></a>02839                 *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>**<span class="keyword">&gt;</span>(storage) = NULL;
<a name="l02840"></a>02840                 <span class="keywordflow">return</span>;
<a name="l02841"></a>02841             }
<a name="l02842"></a>02842             <span class="keyword">const</span> <span class="keywordtype">char</span> *data = <span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a9fa696b4a0bbc4a86a63a1d4323ccf1c">getRawPointer</a>(length));
<a name="l02843"></a>02843             checkTooNarrowVarcharAndVarbinary(type, data, length, maxLength, isInBytes);
<a name="l02844"></a>02844 
<a name="l02845"></a>02845             <span class="keyword">const</span> int32_t minlength = lengthLength + length;
<a name="l02846"></a>02846             <a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>* sref = <a class="code" href="classvoltdb_1_1StringRef.html#a895351e07df609b0385fe2c82ea891f9">StringRef::create</a>(minlength, dataPool);
<a name="l02847"></a>02847             <span class="keywordtype">char</span>* copy = sref-&gt;<a class="code" href="classvoltdb_1_1StringRef.html#a08806c9ba483b7f54e10b6948db679ed">get</a>();
<a name="l02848"></a>02848             setObjectLengthToLocation( length, copy);
<a name="l02849"></a>02849             ::memcpy(copy + lengthLength, data, length);
<a name="l02850"></a>02850             *<span class="keyword">reinterpret_cast&lt;</span><a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>**<span class="keyword">&gt;</span>(storage) = sref;
<a name="l02851"></a>02851         }
<a name="l02852"></a>02852         <span class="keywordflow">break</span>;
<a name="l02853"></a>02853     }
<a name="l02854"></a>02854     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l02855"></a>02855         <span class="keywordflow">if</span> (F == <a class="code" href="namespacevoltdb.html#a314b2a065c35624b838b3e1879673a59a4f2633b4bc0eec2aff7dd30955889bd0">TUPLE_SERIALIZATION_DR</a>) {
<a name="l02856"></a>02856             <span class="keyword">const</span> <span class="keywordtype">int</span> scale = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a19c0184d444ecf65190eb183489ba2f0">readByte</a>();
<a name="l02857"></a>02857             <span class="keyword">const</span> <span class="keywordtype">int</span> precisionBytes = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a19c0184d444ecf65190eb183489ba2f0">readByte</a>();
<a name="l02858"></a>02858             <span class="keywordflow">if</span> (scale != <a class="code" href="classvoltdb_1_1NValue.html#a944849ac1efbf04fe1b47f378cb7973b">kMaxDecScale</a>) {
<a name="l02859"></a>02859                 <a class="code" href="FatalException_8hpp.html#a79abe2d18fe35f7f78f526c7ba90ec7a">throwFatalException</a>(<span class="stringliteral">&quot;Unexpected scale %d&quot;</span>, scale);
<a name="l02860"></a>02860             }
<a name="l02861"></a>02861             <span class="keywordflow">if</span> (precisionBytes != 16) {
<a name="l02862"></a>02862                 <a class="code" href="FatalException_8hpp.html#a79abe2d18fe35f7f78f526c7ba90ec7a">throwFatalException</a>(<span class="stringliteral">&quot;Unexpected number of precision bytes %d&quot;</span>, precisionBytes);
<a name="l02863"></a>02863             }
<a name="l02864"></a>02864         }
<a name="l02865"></a>02865         int64_t *longStorage = <span class="keyword">reinterpret_cast&lt;</span>int64_t*<span class="keyword">&gt;</span>(storage);
<a name="l02866"></a>02866         <span class="comment">//Reverse order for Java BigDecimal BigEndian</span>
<a name="l02867"></a>02867         longStorage[1] = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a4538d2ab48f284e68a1032253a5b45ba">readLong</a>();
<a name="l02868"></a>02868         longStorage[0] = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a4538d2ab48f284e68a1032253a5b45ba">readLong</a>();
<a name="l02869"></a>02869         <span class="keywordflow">break</span>;
<a name="l02870"></a>02870     }
<a name="l02871"></a>02871     <span class="keywordflow">default</span>:
<a name="l02872"></a>02872         <span class="keywordtype">char</span> message[128];
<a name="l02873"></a>02873         snprintf(message, 128, <span class="stringliteral">&quot;NValue::deserializeFrom() unrecognized type &apos;%s&apos;&quot;</span>,
<a name="l02874"></a>02874                 <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(type).c_str());
<a name="l02875"></a>02875         <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SerializableEEException.html">SerializableEEException</a>(<a class="code" href="namespacevoltdb.html#a88ec47ad3308f779e49d2fd43465ac21a438b236a5020b47ad206e5e7f2671d02">VOLT_EE_EXCEPTION_TYPE_EEEXCEPTION</a>,
<a name="l02876"></a>02876                 message);
<a name="l02877"></a>02877     }
<a name="l02878"></a>02878 }
<a name="l02879"></a>02879 
<a name="l02885"></a><a class="code" href="classvoltdb_1_1NValue.html#a2b74136eb54a4b009716d2292c323658">02885</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a2b74136eb54a4b009716d2292c323658">NValue::deserializeFromAllocateForStorage</a>(<a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInputBE</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool)
<a name="l02886"></a>02886 {
<a name="l02887"></a>02887     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = <span class="keyword">static_cast&lt;</span><a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a><span class="keyword">&gt;</span>(input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a19c0184d444ecf65190eb183489ba2f0">readByte</a>());
<a name="l02888"></a>02888     <a class="code" href="classvoltdb_1_1NValue.html#a2b74136eb54a4b009716d2292c323658">deserializeFromAllocateForStorage</a>(type, input, dataPool);
<a name="l02889"></a>02889 }
<a name="l02890"></a>02890 
<a name="l02891"></a><a class="code" href="classvoltdb_1_1NValue.html#af036ec2be9c773a183a46667c7f887a1">02891</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a2b74136eb54a4b009716d2292c323658">NValue::deserializeFromAllocateForStorage</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type, <a class="code" href="classvoltdb_1_1SerializeInput.html">SerializeInputBE</a> &amp;input, <a class="code" href="classvoltdb_1_1Pool.html">Pool</a> *dataPool)
<a name="l02892"></a>02892 {
<a name="l02893"></a>02893     setValueType(type);
<a name="l02894"></a>02894     <span class="comment">// Parameter array NValue elements are reused from one executor call to the next,</span>
<a name="l02895"></a>02895     <span class="comment">// so these NValues need to forget they were ever null.</span>
<a name="l02896"></a>02896     m_data[13] = 0; <span class="comment">// effectively, this is tagAsNonNull()</span>
<a name="l02897"></a>02897     <span class="keywordflow">switch</span> (type) {
<a name="l02898"></a>02898     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l02899"></a>02899         getBigInt() = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a4538d2ab48f284e68a1032253a5b45ba">readLong</a>();
<a name="l02900"></a>02900         <span class="keywordflow">if</span> (getBigInt() == <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>) {
<a name="l02901"></a>02901             tagAsNull();
<a name="l02902"></a>02902         }
<a name="l02903"></a>02903         <span class="keywordflow">break</span>;
<a name="l02904"></a>02904     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l02905"></a>02905         getTimestamp() = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a4538d2ab48f284e68a1032253a5b45ba">readLong</a>();
<a name="l02906"></a>02906         <span class="keywordflow">if</span> (getTimestamp() == <a class="code" href="value__defs_8h.html#a0dc4ba1bfa822f72cdacadcbcf8d35bc">INT64_NULL</a>) {
<a name="l02907"></a>02907             tagAsNull();
<a name="l02908"></a>02908         }
<a name="l02909"></a>02909         <span class="keywordflow">break</span>;
<a name="l02910"></a>02910     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l02911"></a>02911         getTinyInt() = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a19c0184d444ecf65190eb183489ba2f0">readByte</a>();
<a name="l02912"></a>02912         <span class="keywordflow">if</span> (getTinyInt() == <a class="code" href="value__defs_8h.html#a28837e97a5d6456361025639752e3619">INT8_NULL</a>) {
<a name="l02913"></a>02913             tagAsNull();
<a name="l02914"></a>02914         }
<a name="l02915"></a>02915         <span class="keywordflow">break</span>;
<a name="l02916"></a>02916     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l02917"></a>02917         getSmallInt() = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#ac0ce313c0eb162c72869e6802e456f1d">readShort</a>();
<a name="l02918"></a>02918         <span class="keywordflow">if</span> (getSmallInt() == <a class="code" href="value__defs_8h.html#a309a30298a279fb371620383187fd498">INT16_NULL</a>) {
<a name="l02919"></a>02919             tagAsNull();
<a name="l02920"></a>02920         }
<a name="l02921"></a>02921         <span class="keywordflow">break</span>;
<a name="l02922"></a>02922     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l02923"></a>02923         getInteger() = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a206f9b37054c77b518f44a719e1a560b">readInt</a>();
<a name="l02924"></a>02924         <span class="keywordflow">if</span> (getInteger() == <a class="code" href="value__defs_8h.html#a7b37f75b664751ae17bd3a801355bd7e">INT32_NULL</a>) {
<a name="l02925"></a>02925             tagAsNull();
<a name="l02926"></a>02926         }
<a name="l02927"></a>02927         <span class="keywordflow">break</span>;
<a name="l02928"></a>02928     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l02929"></a>02929         getDouble() = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a7f290444087030b7c2ff9ae690fb87fb">readDouble</a>();
<a name="l02930"></a>02930         <span class="keywordflow">if</span> (getDouble() &lt;= <a class="code" href="value__defs_8h.html#aa5313fdf2f378a2571bb4c554d992483">DOUBLE_NULL</a>) {
<a name="l02931"></a>02931             tagAsNull();
<a name="l02932"></a>02932         }
<a name="l02933"></a>02933         <span class="keywordflow">break</span>;
<a name="l02934"></a>02934     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02935"></a>02935     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02936"></a>02936     {
<a name="l02937"></a>02937         <span class="keyword">const</span> int32_t length = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a206f9b37054c77b518f44a719e1a560b">readInt</a>();
<a name="l02938"></a>02938         <span class="comment">// the NULL SQL string is a NULL C pointer</span>
<a name="l02939"></a>02939         <span class="keywordflow">if</span> (length == <a class="code" href="value__defs_8h.html#aefcabebc545a1781a75ddb761686e50f">OBJECTLENGTH_NULL</a>) {
<a name="l02940"></a>02940             <a class="code" href="classvoltdb_1_1NValue.html#a249dfdbc4b3bfa2f1b9e9303c4ba0de4">setNull</a>();
<a name="l02941"></a>02941             <span class="keywordflow">break</span>;
<a name="l02942"></a>02942         }
<a name="l02943"></a>02943         <span class="keywordtype">char</span>* storage = allocateValueStorage(length, dataPool);
<a name="l02944"></a>02944         <span class="keyword">const</span> <span class="keywordtype">char</span> *str = (<span class="keyword">const</span> <span class="keywordtype">char</span>*) input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a9fa696b4a0bbc4a86a63a1d4323ccf1c">getRawPointer</a>(length);
<a name="l02945"></a>02945         ::memcpy(storage, str, length);
<a name="l02946"></a>02946         <span class="keywordflow">break</span>;
<a name="l02947"></a>02947     }
<a name="l02948"></a>02948     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l02949"></a>02949         getDecimal().table[1] = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a4538d2ab48f284e68a1032253a5b45ba">readLong</a>();
<a name="l02950"></a>02950         getDecimal().table[0] = input.<a class="code" href="classvoltdb_1_1SerializeInput.html#a4538d2ab48f284e68a1032253a5b45ba">readLong</a>();
<a name="l02951"></a>02951         <span class="keywordflow">break</span>;
<a name="l02952"></a>02952     }
<a name="l02953"></a>02953     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>: {
<a name="l02954"></a>02954         <a class="code" href="classvoltdb_1_1NValue.html#a249dfdbc4b3bfa2f1b9e9303c4ba0de4">setNull</a>();
<a name="l02955"></a>02955         <span class="keywordflow">break</span>;
<a name="l02956"></a>02956     }
<a name="l02957"></a>02957     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaac3105256256a4983c6311316426b4f5">VALUE_TYPE_ARRAY</a>: {
<a name="l02958"></a>02958         deserializeIntoANewNValueList(input, dataPool);
<a name="l02959"></a>02959         <span class="keywordflow">break</span>;
<a name="l02960"></a>02960     }
<a name="l02961"></a>02961     <span class="keywordflow">default</span>:
<a name="l02962"></a>02962         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;NValue::deserializeFromAllocateForStorage() unrecognized type &apos;%s&apos;&quot;</span>,
<a name="l02963"></a>02963                                  <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(type).c_str());
<a name="l02964"></a>02964     }
<a name="l02965"></a>02965 }
<a name="l02966"></a>02966 
<a name="l02970"></a><a class="code" href="classvoltdb_1_1NValue.html#a40be242bf1ec481e07b0dc83dc959819">02970</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a40be242bf1ec481e07b0dc83dc959819">NValue::serializeTo</a>(<a class="code" href="classvoltdb_1_1SerializeOutput.html">SerializeOutput</a> &amp;output)<span class="keyword"> const </span>{
<a name="l02971"></a>02971     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l02972"></a>02972     <span class="keywordflow">switch</span> (type) {
<a name="l02973"></a>02973     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l02974"></a>02974     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l02975"></a>02975     {
<a name="l02976"></a>02976         <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l02977"></a>02977             output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a989d5d86ee9f8a664085258cb7087f11">writeInt</a>(<a class="code" href="value__defs_8h.html#aefcabebc545a1781a75ddb761686e50f">OBJECTLENGTH_NULL</a>);
<a name="l02978"></a>02978             <span class="keywordflow">break</span>;
<a name="l02979"></a>02979         }
<a name="l02980"></a>02980         <span class="keyword">const</span> int32_t length = getObjectLength_withoutNull();
<a name="l02981"></a>02981         <span class="keywordflow">if</span> (length &lt;= <a class="code" href="value__defs_8h.html#aefcabebc545a1781a75ddb761686e50f">OBJECTLENGTH_NULL</a>) {
<a name="l02982"></a>02982             <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;Attempted to serialize an NValue with a negative length&quot;</span>);
<a name="l02983"></a>02983         }
<a name="l02984"></a>02984         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a989d5d86ee9f8a664085258cb7087f11">writeInt</a>(static_cast&lt;int32_t&gt;(length));
<a name="l02985"></a>02985 
<a name="l02986"></a>02986         <span class="comment">// Not a null string: write it out</span>
<a name="l02987"></a>02987         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a863d5c52fe876441db7ac7d67bd3b9dc">writeBytes</a>(getObjectValue_withoutNull(), length);
<a name="l02988"></a>02988 
<a name="l02989"></a>02989         <span class="keywordflow">break</span>;
<a name="l02990"></a>02990     }
<a name="l02991"></a>02991     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>: {
<a name="l02992"></a>02992         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a770464c35636ac516b069db33fe15ff7">writeByte</a>(getTinyInt());
<a name="l02993"></a>02993         <span class="keywordflow">break</span>;
<a name="l02994"></a>02994     }
<a name="l02995"></a>02995     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>: {
<a name="l02996"></a>02996         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#aa8c1325e154a9ff2fe1c918a72bf28c4">writeShort</a>(getSmallInt());
<a name="l02997"></a>02997         <span class="keywordflow">break</span>;
<a name="l02998"></a>02998     }
<a name="l02999"></a>02999     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>: {
<a name="l03000"></a>03000         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a989d5d86ee9f8a664085258cb7087f11">writeInt</a>(getInteger());
<a name="l03001"></a>03001         <span class="keywordflow">break</span>;
<a name="l03002"></a>03002     }
<a name="l03003"></a>03003     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>: {
<a name="l03004"></a>03004         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a99403e2c3bcb976db9d7d937694934d3">writeLong</a>(getTimestamp());
<a name="l03005"></a>03005         <span class="keywordflow">break</span>;
<a name="l03006"></a>03006     }
<a name="l03007"></a>03007     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>: {
<a name="l03008"></a>03008         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a99403e2c3bcb976db9d7d937694934d3">writeLong</a>(getBigInt());
<a name="l03009"></a>03009         <span class="keywordflow">break</span>;
<a name="l03010"></a>03010     }
<a name="l03011"></a>03011     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>: {
<a name="l03012"></a>03012         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#ab333d786cc872732da47a2606821fdcc">writeDouble</a>(getDouble());
<a name="l03013"></a>03013         <span class="keywordflow">break</span>;
<a name="l03014"></a>03014     }
<a name="l03015"></a>03015     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l03016"></a>03016         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a99403e2c3bcb976db9d7d937694934d3">writeLong</a>(getDecimal().table[1]);
<a name="l03017"></a>03017         output.<a class="code" href="classvoltdb_1_1SerializeOutput.html#a99403e2c3bcb976db9d7d937694934d3">writeLong</a>(getDecimal().table[0]);
<a name="l03018"></a>03018         <span class="keywordflow">break</span>;
<a name="l03019"></a>03019     }
<a name="l03020"></a>03020     <span class="keywordflow">default</span>:
<a name="l03021"></a>03021         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>( <span class="stringliteral">&quot;NValue::serializeTo() found a column &quot;</span>
<a name="l03022"></a>03022                 <span class="stringliteral">&quot;with ValueType &apos;%s&apos; that is not handled&quot;</span>, getValueTypeString().c_str());
<a name="l03023"></a>03023     }
<a name="l03024"></a>03024 }
<a name="l03025"></a>03025 
<a name="l03026"></a><a class="code" href="classvoltdb_1_1NValue.html#a3d2c344acd24009ca16316be9091f007">03026</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d2c344acd24009ca16316be9091f007">NValue::serializeToExport_withoutNull</a>(<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html">ExportSerializeOutput</a> &amp;io)<span class="keyword"> const</span>
<a name="l03027"></a>03027 <span class="keyword"></span>{
<a name="l03028"></a>03028     assert(<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() == <span class="keyword">false</span>);
<a name="l03029"></a>03029     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l03030"></a>03030      <span class="keywordflow">switch</span> (type) {
<a name="l03031"></a>03031      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l03032"></a>03032      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l03033"></a>03033      {
<a name="l03034"></a>03034          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a97146535f78f28cd10f767d17eaca4e7">writeBinaryString</a>(getObjectValue_withoutNull(), getObjectLength_withoutNull());
<a name="l03035"></a>03035          <span class="keywordflow">return</span>;
<a name="l03036"></a>03036      }
<a name="l03037"></a>03037      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>: {
<a name="l03038"></a>03038          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a52fdddffc6c9a2365564dcf872b534fc">writeByte</a>(getTinyInt());
<a name="l03039"></a>03039          <span class="keywordflow">return</span>;
<a name="l03040"></a>03040      }
<a name="l03041"></a>03041      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>: {
<a name="l03042"></a>03042          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#ad1c508641c196b5df88c18a703220e24">writeShort</a>(getSmallInt());
<a name="l03043"></a>03043          <span class="keywordflow">return</span>;
<a name="l03044"></a>03044      }
<a name="l03045"></a>03045      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>: {
<a name="l03046"></a>03046          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a68239ee56bea7056e8a25c1209da80a1">writeInt</a>(getInteger());
<a name="l03047"></a>03047          <span class="keywordflow">return</span>;
<a name="l03048"></a>03048      }
<a name="l03049"></a>03049      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>: {
<a name="l03050"></a>03050          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a4263f4378bdf831fb07113c818883161">writeLong</a>(getTimestamp());
<a name="l03051"></a>03051          <span class="keywordflow">return</span>;
<a name="l03052"></a>03052      }
<a name="l03053"></a>03053      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>: {
<a name="l03054"></a>03054          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a4263f4378bdf831fb07113c818883161">writeLong</a>(getBigInt());
<a name="l03055"></a>03055          <span class="keywordflow">return</span>;
<a name="l03056"></a>03056      }
<a name="l03057"></a>03057      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>: {
<a name="l03058"></a>03058          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a588bf94b20e9ec0d912eedeb6bee92cf">writeDouble</a>(getDouble());
<a name="l03059"></a>03059          <span class="keywordflow">return</span>;
<a name="l03060"></a>03060      }
<a name="l03061"></a>03061      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>: {
<a name="l03062"></a>03062          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a52fdddffc6c9a2365564dcf872b534fc">writeByte</a>((int8_t)<a class="code" href="classvoltdb_1_1NValue.html#a944849ac1efbf04fe1b47f378cb7973b">kMaxDecScale</a>);
<a name="l03063"></a>03063          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a52fdddffc6c9a2365564dcf872b534fc">writeByte</a>((int8_t)16);  <span class="comment">//number of bytes in decimal</span>
<a name="l03064"></a>03064          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a4263f4378bdf831fb07113c818883161">writeLong</a>(<a class="code" href="serializeio_8h.html#a9f4bf0773c45ad9a9753a1b784a13fbb">htonll</a>(getDecimal().table[1]));
<a name="l03065"></a>03065          io.<a class="code" href="classvoltdb_1_1ExportSerializeOutput.html#a4263f4378bdf831fb07113c818883161">writeLong</a>(<a class="code" href="serializeio_8h.html#a9f4bf0773c45ad9a9753a1b784a13fbb">htonll</a>(getDecimal().table[0]));
<a name="l03066"></a>03066          <span class="keywordflow">return</span>;
<a name="l03067"></a>03067      }
<a name="l03068"></a>03068      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfadf0950da0461f672a649ed99379c3f6f">VALUE_TYPE_INVALID</a>:
<a name="l03069"></a>03069      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a>:
<a name="l03070"></a>03070      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfae1e00c464f168738b32b630f2167a537">VALUE_TYPE_BOOLEAN</a>:
<a name="l03071"></a>03071      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>:
<a name="l03072"></a>03072      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaac3105256256a4983c6311316426b4f5">VALUE_TYPE_ARRAY</a>:
<a name="l03073"></a>03073      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade2150241f8b2e1f8a971bd69aa2a4cc">VALUE_TYPE_FOR_DIAGNOSTICS_ONLY_NUMERIC</a>:
<a name="l03074"></a>03074          <span class="keywordtype">char</span> message[128];
<a name="l03075"></a>03075          snprintf(message, <span class="keyword">sizeof</span>(message), <span class="stringliteral">&quot;Invalid type in serializeToExport: %s&quot;</span>, <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(getValueType()).c_str());
<a name="l03076"></a>03076          <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SerializableEEException.html">SerializableEEException</a>(<a class="code" href="namespacevoltdb.html#a88ec47ad3308f779e49d2fd43465ac21a438b236a5020b47ad206e5e7f2671d02">VOLT_EE_EXCEPTION_TYPE_EEEXCEPTION</a>,
<a name="l03077"></a>03077                  message);
<a name="l03078"></a>03078      }
<a name="l03079"></a>03079 
<a name="l03080"></a>03080     <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SerializableEEException.html">SerializableEEException</a>(<a class="code" href="namespacevoltdb.html#a88ec47ad3308f779e49d2fd43465ac21a438b236a5020b47ad206e5e7f2671d02">VOLT_EE_EXCEPTION_TYPE_EEEXCEPTION</a>,
<a name="l03081"></a>03081             <span class="stringliteral">&quot;Invalid type in serializeToExport&quot;</span>);
<a name="l03082"></a>03082 }
<a name="l03083"></a>03083 
<a name="l03088"></a><a class="code" href="classvoltdb_1_1NValue.html#a6a8fc61d7eab259a50bc2a1846558f1d">03088</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#a6a8fc61d7eab259a50bc2a1846558f1d">NValue::allocateObjectFromInlinedValue</a>(<a class="code" href="classvoltdb_1_1Pool.html">Pool</a>* pool = NULL)
<a name="l03089"></a>03089 {
<a name="l03090"></a>03090     <span class="keywordflow">if</span> (m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa1390a2bd6f3e2caa0b08ae88b56b9685">VALUE_TYPE_NULL</a> || m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfadf0950da0461f672a649ed99379c3f6f">VALUE_TYPE_INVALID</a>) {
<a name="l03091"></a>03091         <span class="keywordflow">return</span>;
<a name="l03092"></a>03092     }
<a name="l03093"></a>03093 
<a name="l03094"></a>03094     assert(m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a> || m_valueType == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>);
<a name="l03095"></a>03095     assert(m_sourceInlined);
<a name="l03096"></a>03096 
<a name="l03097"></a>03097     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03098"></a>03098         *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>**<span class="keyword">&gt;</span>(m_data) = NULL;
<a name="l03099"></a>03099         <span class="comment">// serializeToTupleStorage fusses about this inline flag being set, even for NULLs</span>
<a name="l03100"></a>03100         setSourceInlined(<span class="keyword">false</span>);
<a name="l03101"></a>03101         <span class="keywordflow">return</span>;
<a name="l03102"></a>03102     }
<a name="l03103"></a>03103 
<a name="l03104"></a>03104     <span class="keywordflow">if</span> (pool == NULL) {
<a name="l03105"></a>03105         pool = getTempStringPool();
<a name="l03106"></a>03106     }
<a name="l03107"></a>03107 
<a name="l03108"></a>03108     <span class="comment">// When an object is inlined, m_data is a direct pointer into a tuple&apos;s inline storage area.</span>
<a name="l03109"></a>03109     <span class="keywordtype">char</span>* source = *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>**<span class="keyword">&gt;</span>(m_data);
<a name="l03110"></a>03110 
<a name="l03111"></a>03111     <span class="comment">// When it isn&apos;t inlined, m_data must contain a pointer to a StringRef object</span>
<a name="l03112"></a>03112     <span class="comment">// that contains that same data in that same format.</span>
<a name="l03113"></a>03113 
<a name="l03114"></a>03114     int32_t length = getObjectLength_withoutNull();
<a name="l03115"></a>03115     <span class="comment">// inlined objects always have a minimal (1-byte) length field.</span>
<a name="l03116"></a>03116     <a class="code" href="classvoltdb_1_1StringRef.html">StringRef</a>* sref = <a class="code" href="classvoltdb_1_1StringRef.html#a895351e07df609b0385fe2c82ea891f9">StringRef::create</a>(length + <a class="code" href="NValue_8hpp.html#a55aac814b8e8b7d50c07257f51c633fd">SHORT_OBJECT_LENGTHLENGTH</a>, pool);
<a name="l03117"></a>03117     <span class="keywordtype">char</span>* storage = sref-&gt;<a class="code" href="classvoltdb_1_1StringRef.html#a08806c9ba483b7f54e10b6948db679ed">get</a>();
<a name="l03118"></a>03118     <span class="comment">// Copy length and value into the allocated out-of-line storage</span>
<a name="l03119"></a>03119     ::memcpy(storage, source, length + <a class="code" href="NValue_8hpp.html#a55aac814b8e8b7d50c07257f51c633fd">SHORT_OBJECT_LENGTHLENGTH</a>);
<a name="l03120"></a>03120     setObjectValue(sref);
<a name="l03121"></a>03121     setSourceInlined(<span class="keyword">false</span>);
<a name="l03122"></a>03122 }
<a name="l03123"></a>03123 
<a name="l03124"></a><a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">03124</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">NValue::isNull</a>()<span class="keyword"> const </span>{
<a name="l03125"></a>03125     <span class="keywordflow">if</span> (getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>) {
<a name="l03126"></a>03126         <a class="code" href="namespacevoltdb.html#a82a786a7a5de40ea353f442a0a247a3c">TTInt</a> min;
<a name="l03127"></a>03127         min.SetMin();
<a name="l03128"></a>03128         <span class="keywordflow">return</span> getDecimal() == min;
<a name="l03129"></a>03129     }
<a name="l03130"></a>03130     <span class="keywordflow">return</span> m_data[13] == <a class="code" href="NValue_8hpp.html#a739d0b39c04a69c173db87bce273e19c">OBJECT_NULL_BIT</a>;
<a name="l03131"></a>03131 }
<a name="l03132"></a>03132 
<a name="l03133"></a><a class="code" href="classvoltdb_1_1NValue.html#adb4f22b24452cab40f641c424621ba4e">03133</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#adb4f22b24452cab40f641c424621ba4e">NValue::isNaN</a>()<span class="keyword"> const </span>{
<a name="l03134"></a>03134     <span class="keywordflow">if</span> (getValueType() == <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>) {
<a name="l03135"></a>03135         <span class="keywordflow">return</span> std::isnan(getDouble());
<a name="l03136"></a>03136     }
<a name="l03137"></a>03137     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03138"></a>03138 }
<a name="l03139"></a>03139 
<a name="l03140"></a>03140 <span class="comment">// general full comparison</span>
<a name="l03141"></a><a class="code" href="classvoltdb_1_1NValue.html#ac709e560976174bd7007dd52dd9f589e">03141</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ac709e560976174bd7007dd52dd9f589e">NValue::op_equals</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03142"></a>03142     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) == 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03143"></a>03143 }
<a name="l03144"></a>03144 
<a name="l03145"></a><a class="code" href="classvoltdb_1_1NValue.html#af3272aae43be4235cabd6226fb6404d4">03145</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#af3272aae43be4235cabd6226fb6404d4">NValue::op_notEquals</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03146"></a>03146     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) != 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03147"></a>03147 }
<a name="l03148"></a>03148 
<a name="l03149"></a><a class="code" href="classvoltdb_1_1NValue.html#aad91fcf299132a90eb8b0f102a9742b9">03149</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aad91fcf299132a90eb8b0f102a9742b9">NValue::op_lessThan</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03150"></a>03150     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) &lt; 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03151"></a>03151 }
<a name="l03152"></a>03152 
<a name="l03153"></a><a class="code" href="classvoltdb_1_1NValue.html#a1b57d0f33c04a4b896e4675de1d8ea13">03153</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a1b57d0f33c04a4b896e4675de1d8ea13">NValue::op_lessThanOrEqual</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03154"></a>03154     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) &lt;= 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03155"></a>03155 }
<a name="l03156"></a>03156 
<a name="l03157"></a><a class="code" href="classvoltdb_1_1NValue.html#ac6c1a187cd80967ec6613cba414ad9b1">03157</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ac6c1a187cd80967ec6613cba414ad9b1">NValue::op_greaterThan</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03158"></a>03158     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) &gt; 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03159"></a>03159 }
<a name="l03160"></a>03160 
<a name="l03161"></a><a class="code" href="classvoltdb_1_1NValue.html#aa2e37b134a97f60c0a264d9459c2b1c8">03161</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aa2e37b134a97f60c0a264d9459c2b1c8">NValue::op_greaterThanOrEqual</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03162"></a>03162     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) &gt;= 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03163"></a>03163 }
<a name="l03164"></a>03164 
<a name="l03165"></a>03165 <span class="comment">// without null comparison</span>
<a name="l03166"></a><a class="code" href="classvoltdb_1_1NValue.html#ae70bc292105a4102f81c873cc2f6dcd1">03166</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ae70bc292105a4102f81c873cc2f6dcd1">NValue::op_equals_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03167"></a>03167     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(rhs) == 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03168"></a>03168 }
<a name="l03169"></a>03169 
<a name="l03170"></a><a class="code" href="classvoltdb_1_1NValue.html#a6d2b3b98a1e9d3e8ca056ace72642b96">03170</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a6d2b3b98a1e9d3e8ca056ace72642b96">NValue::op_notEquals_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03171"></a>03171     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(rhs) != 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03172"></a>03172 }
<a name="l03173"></a>03173 
<a name="l03174"></a><a class="code" href="classvoltdb_1_1NValue.html#a747a8e64c69a675f545bd172f5351f95">03174</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a747a8e64c69a675f545bd172f5351f95">NValue::op_lessThan_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03175"></a>03175     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(rhs) &lt; 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03176"></a>03176 }
<a name="l03177"></a>03177 
<a name="l03178"></a><a class="code" href="classvoltdb_1_1NValue.html#a2afe5bd0c2f8c7b067c3b2a1224cc1b4">03178</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a2afe5bd0c2f8c7b067c3b2a1224cc1b4">NValue::op_lessThanOrEqual_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03179"></a>03179     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(rhs) &lt;= 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03180"></a>03180 }
<a name="l03181"></a>03181 
<a name="l03182"></a><a class="code" href="classvoltdb_1_1NValue.html#aed56ac3fdda0424056f74e08881645d3">03182</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aed56ac3fdda0424056f74e08881645d3">NValue::op_greaterThan_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03183"></a>03183     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(rhs) &gt; 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03184"></a>03184 }
<a name="l03185"></a>03185 
<a name="l03186"></a><a class="code" href="classvoltdb_1_1NValue.html#a01494d4d2ba2662c2ebba1fefad03f6f">03186</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a01494d4d2ba2662c2ebba1fefad03f6f">NValue::op_greaterThanOrEqual_withoutNull</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03187"></a>03187     <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a5306e15263b436e519d9b1aa554253e2">compare_withoutNull</a>(rhs) &gt;= 0 ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03188"></a>03188 }
<a name="l03189"></a>03189 
<a name="l03190"></a><a class="code" href="classvoltdb_1_1NValue.html#adbd3180d56c40e167caca4fc6a22401c">03190</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#adbd3180d56c40e167caca4fc6a22401c">NValue::op_max</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03191"></a>03191     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) &gt; 0) {
<a name="l03192"></a>03192         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l03193"></a>03193     } <span class="keywordflow">else</span> {
<a name="l03194"></a>03194         <span class="keywordflow">return</span> rhs;
<a name="l03195"></a>03195     }
<a name="l03196"></a>03196 }
<a name="l03197"></a>03197 
<a name="l03198"></a><a class="code" href="classvoltdb_1_1NValue.html#a7a086c6020ebd382fe5a2e32852e3167">03198</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a7a086c6020ebd382fe5a2e32852e3167">NValue::op_min</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03199"></a>03199     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#a3d7a4fc48ce8f4b17de25e18e04e245a">compare</a>(rhs) &lt; 0) {
<a name="l03200"></a>03200         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l03201"></a>03201     } <span class="keywordflow">else</span> {
<a name="l03202"></a>03202         <span class="keywordflow">return</span> rhs;
<a name="l03203"></a>03203     }
<a name="l03204"></a>03204 }
<a name="l03205"></a>03205 
<a name="l03206"></a><a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">03206</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> NValue::getNullValue(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type) {
<a name="l03207"></a>03207     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> retval(type);
<a name="l03208"></a>03208     retval.<a class="code" href="classvoltdb_1_1NValue.html#a249dfdbc4b3bfa2f1b9e9303c4ba0de4">setNull</a>();
<a name="l03209"></a>03209     <span class="keywordflow">return</span> retval;
<a name="l03210"></a>03210 }
<a name="l03211"></a>03211 
<a name="l03212"></a><a class="code" href="classvoltdb_1_1NValue.html#aada5b31dcd7acf3ff7d42eb00e2200f9">03212</a> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="classvoltdb_1_1NValue.html#aada5b31dcd7acf3ff7d42eb00e2200f9">NValue::hashCombine</a>(std::size_t &amp;seed)<span class="keyword"> const </span>{
<a name="l03213"></a>03213     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l03214"></a>03214     <span class="keywordflow">switch</span> (type) {
<a name="l03215"></a>03215     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03216"></a>03216         boost::hash_combine( seed, getTinyInt()); <span class="keywordflow">break</span>;
<a name="l03217"></a>03217     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03218"></a>03218         boost::hash_combine( seed, getSmallInt()); <span class="keywordflow">break</span>;
<a name="l03219"></a>03219     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03220"></a>03220         boost::hash_combine( seed, getInteger()); <span class="keywordflow">break</span>;
<a name="l03221"></a>03221     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03222"></a>03222     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03223"></a>03223         boost::hash_combine( seed, getBigInt()); <span class="keywordflow">break</span>;
<a name="l03224"></a>03224     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03225"></a>03225         <span class="comment">// This method was observed to fail on Centos 5 / GCC 4.1.2, returning different hashes</span>
<a name="l03226"></a>03226         <span class="comment">// for identical inputs, so the conditional was added,</span>
<a name="l03227"></a>03227         <span class="comment">// mutated from the one in boost/type_traits/intrinsics.hpp,</span>
<a name="l03228"></a>03228         <span class="comment">// and the broken overload for &quot;double&quot; was by-passed in favor of the more reliable</span>
<a name="l03229"></a>03229         <span class="comment">// one for int64 -- even if this may give sub-optimal hashes for typical collections of double.</span>
<a name="l03230"></a>03230         <span class="comment">// This conditional can be dropped when Centos 5 support is dropped.</span>
<a name="l03231"></a>03231 <span class="preprocessor">#if defined(__GNUC__) &amp;&amp; ((__GNUC__ &gt; 4) || ((__GNUC__ == 4) &amp;&amp; (__GNUC_MINOR__ &gt;= 2) &amp;&amp; !defined(__GCCXML__))) &amp;&amp; !defined(BOOST_CLANG)</span>
<a name="l03232"></a>03232 <span class="preprocessor"></span>        boost::hash_combine( seed, getDouble()); <span class="keywordflow">break</span>;
<a name="l03233"></a>03233 <span class="preprocessor">#else</span>
<a name="l03234"></a>03234 <span class="preprocessor"></span>        {
<a name="l03235"></a>03235             <span class="keyword">const</span> int64_t proxyForDouble =  *<span class="keyword">reinterpret_cast&lt;</span><span class="keyword">const </span>int64_t*<span class="keyword">&gt;</span>(m_data);
<a name="l03236"></a>03236             boost::hash_combine( seed, proxyForDouble); <span class="keywordflow">break</span>;
<a name="l03237"></a>03237         }
<a name="l03238"></a>03238 <span class="preprocessor">#endif</span>
<a name="l03239"></a>03239 <span class="preprocessor"></span>      <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>: {
<a name="l03240"></a>03240           <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03241"></a>03241               boost::hash_combine( seed, std::string(<span class="stringliteral">&quot;&quot;</span>));
<a name="l03242"></a>03242           } <span class="keywordflow">else</span> {
<a name="l03243"></a>03243               <span class="keyword">const</span> int32_t length = getObjectLength_withoutNull();
<a name="l03244"></a>03244               boost::hash_combine( seed, std::string( reinterpret_cast&lt;const char*&gt;(getObjectValue_withoutNull()), length ));
<a name="l03245"></a>03245           }
<a name="l03246"></a>03246           <span class="keywordflow">break</span>;
<a name="l03247"></a>03247       }
<a name="l03248"></a>03248       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>: {
<a name="l03249"></a>03249           <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03250"></a>03250               boost::hash_combine( seed, std::string(<span class="stringliteral">&quot;&quot;</span>));
<a name="l03251"></a>03251           } <span class="keywordflow">else</span> {
<a name="l03252"></a>03252               <span class="keyword">const</span> int32_t length = getObjectLength_withoutNull();
<a name="l03253"></a>03253               <span class="keywordtype">char</span>* data = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l03254"></a>03254               <span class="keywordflow">for</span> (int32_t i = 0; i &lt; length; i++)
<a name="l03255"></a>03255                   boost::hash_combine(seed, data[i]);
<a name="l03256"></a>03256           }
<a name="l03257"></a>03257           <span class="keywordflow">break</span>;
<a name="l03258"></a>03258       }
<a name="l03259"></a>03259       <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l03260"></a>03260           getDecimal().hash(seed); <span class="keywordflow">break</span>;
<a name="l03261"></a>03261       <span class="keywordflow">default</span>:
<a name="l03262"></a>03262           <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>( <span class="stringliteral">&quot;NValue::hashCombine unknown type %s&quot;</span>, getValueTypeString().c_str());
<a name="l03263"></a>03263     }
<a name="l03264"></a>03264 }
<a name="l03265"></a>03265 
<a name="l03266"></a>03266 
<a name="l03267"></a><a class="code" href="classvoltdb_1_1NValue.html#af433c630b5bc5d9fb5ebda5e5d7aa369">03267</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#af433c630b5bc5d9fb5ebda5e5d7aa369">NValue::castAs</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type)<span class="keyword"> const </span>{
<a name="l03268"></a>03268     <a class="code" href="debuglog_8h.html#a4b19e7ab6163a11a1f41830f76660e04">VOLT_TRACE</a>(<span class="stringliteral">&quot;Converting from %s to %s&quot;</span>,
<a name="l03269"></a>03269             <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">voltdb::getTypeName</a>(getValueType()).c_str(),
<a name="l03270"></a>03270             <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">voltdb::getTypeName</a>(type).c_str());
<a name="l03271"></a>03271     <span class="keywordflow">if</span> (getValueType() == type) {
<a name="l03272"></a>03272         <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l03273"></a>03273     }
<a name="l03274"></a>03274     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03275"></a>03275         <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">getNullValue</a>(type);
<a name="l03276"></a>03276     }
<a name="l03277"></a>03277 
<a name="l03278"></a>03278     <span class="keywordflow">switch</span> (type) {
<a name="l03279"></a>03279     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03280"></a>03280         <span class="keywordflow">return</span> castAsTinyInt();
<a name="l03281"></a>03281     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03282"></a>03282         <span class="keywordflow">return</span> castAsSmallInt();
<a name="l03283"></a>03283     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03284"></a>03284         <span class="keywordflow">return</span> castAsInteger();
<a name="l03285"></a>03285     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03286"></a>03286         <span class="keywordflow">return</span> castAsBigInt();
<a name="l03287"></a>03287     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03288"></a>03288         <span class="keywordflow">return</span> castAsTimestamp();
<a name="l03289"></a>03289     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03290"></a>03290         <span class="keywordflow">return</span> castAsDouble();
<a name="l03291"></a>03291     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l03292"></a>03292         <span class="keywordflow">return</span> castAsString();
<a name="l03293"></a>03293     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l03294"></a>03294         <span class="keywordflow">return</span> castAsBinary();
<a name="l03295"></a>03295     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l03296"></a>03296         <span class="keywordflow">return</span> castAsDecimal();
<a name="l03297"></a>03297     <span class="keywordflow">default</span>:
<a name="l03298"></a>03298         <a class="code" href="FatalException_8hpp.html#aa9e95d98dce84cb2d23d67d3442a4f0c">DEBUG_IGNORE_OR_THROW_OR_CRASH</a>(<span class="stringliteral">&quot;Fallout from planner error.&quot;</span>
<a name="l03299"></a>03299                 <span class="stringliteral">&quot; The invalid target value type for a cast is &quot;</span> &lt;&lt;
<a name="l03300"></a>03300                 <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(type))
<a name="l03301"></a>03301 
<a name="l03302"></a>03302                 <span class="keywordtype">char</span> message[128];
<a name="l03303"></a>03303         snprintf(message, 128, <span class="stringliteral">&quot;Type %d not a recognized type for casting&quot;</span>,
<a name="l03304"></a>03304                 (<span class="keywordtype">int</span>) type);
<a name="l03305"></a>03305         <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>::
<a name="l03306"></a>03306                 data_exception_most_specific_type_mismatch,
<a name="l03307"></a>03307                 message);
<a name="l03308"></a>03308     }
<a name="l03309"></a>03309 }
<a name="l03310"></a>03310 
<a name="l03311"></a><a class="code" href="classvoltdb_1_1NValue.html#a8e5c4f131c04834ab9b30492cb4f4123">03311</a> <span class="keyword">inline</span> <span class="keywordtype">void</span>* <a class="code" href="classvoltdb_1_1NValue.html#a8e5c4f131c04834ab9b30492cb4f4123">NValue::castAsAddress</a>()<span class="keyword"> const </span>{
<a name="l03312"></a>03312     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l03313"></a>03313     <span class="keywordflow">switch</span> (type) {
<a name="l03314"></a>03314     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03315"></a>03315     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf8d61a49accd07e1cdfd40f3e0c89d1c">VALUE_TYPE_ADDRESS</a>:
<a name="l03316"></a>03316         <span class="keywordflow">return</span> *<span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">void</span>* const*<span class="keyword">&gt;</span>(m_data);
<a name="l03317"></a>03317     <span class="keywordflow">default</span>:
<a name="l03318"></a>03318         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(
<a name="l03319"></a>03319                 <span class="stringliteral">&quot;Type %s not a recognized type for casting as an address&quot;</span>,
<a name="l03320"></a>03320                 getValueTypeString().c_str());
<a name="l03321"></a>03321     }
<a name="l03322"></a>03322 }
<a name="l03323"></a>03323 
<a name="l03324"></a><a class="code" href="classvoltdb_1_1NValue.html#a13fd170affa3767eb7ad731b62438bda">03324</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a13fd170affa3767eb7ad731b62438bda">NValue::op_increment</a>()<span class="keyword"> const </span>{
<a name="l03325"></a>03325     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l03326"></a>03326     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> retval(type);
<a name="l03327"></a>03327     <span class="keywordflow">switch</span>(type) {
<a name="l03328"></a>03328     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03329"></a>03329         <span class="keywordflow">if</span> (getTinyInt() == INT8_MAX) {
<a name="l03330"></a>03330             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03331"></a>03331                     <span class="stringliteral">&quot;Incrementing this TinyInt results in a value out of range&quot;</span>);
<a name="l03332"></a>03332         }
<a name="l03333"></a>03333         retval.getTinyInt() = <span class="keyword">static_cast&lt;</span>int8_t<span class="keyword">&gt;</span>(getTinyInt() + 1); <span class="keywordflow">break</span>;
<a name="l03334"></a>03334     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03335"></a>03335         <span class="keywordflow">if</span> (getSmallInt() == INT16_MAX) {
<a name="l03336"></a>03336             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03337"></a>03337                     <span class="stringliteral">&quot;Incrementing this SmallInt results in a value out of range&quot;</span>);
<a name="l03338"></a>03338         }
<a name="l03339"></a>03339         retval.getSmallInt() = <span class="keyword">static_cast&lt;</span>int16_t<span class="keyword">&gt;</span>(getSmallInt() + 1); <span class="keywordflow">break</span>;
<a name="l03340"></a>03340     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03341"></a>03341         <span class="keywordflow">if</span> (getInteger() == INT32_MAX) {
<a name="l03342"></a>03342             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03343"></a>03343                     <span class="stringliteral">&quot;Incrementing this Integer results in a value out of range&quot;</span>);
<a name="l03344"></a>03344         }
<a name="l03345"></a>03345         retval.getInteger() = getInteger() + 1; <span class="keywordflow">break</span>;
<a name="l03346"></a>03346     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03347"></a>03347     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03348"></a>03348         <span class="keywordflow">if</span> (getBigInt() == INT64_MAX) {
<a name="l03349"></a>03349             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03350"></a>03350                     <span class="stringliteral">&quot;Incrementing this BigInt/Timestamp results in a value out of range&quot;</span>);
<a name="l03351"></a>03351         }
<a name="l03352"></a>03352         retval.getBigInt() = getBigInt() + 1; <span class="keywordflow">break</span>;
<a name="l03353"></a>03353     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03354"></a>03354         retval.getDouble() = getDouble() + 1; <span class="keywordflow">break</span>;
<a name="l03355"></a>03355     <span class="keywordflow">default</span>:
<a name="l03356"></a>03356         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>( <span class="stringliteral">&quot;type %s is not incrementable&quot;</span>, getValueTypeString().c_str());
<a name="l03357"></a>03357         <span class="keywordflow">break</span>;
<a name="l03358"></a>03358     }
<a name="l03359"></a>03359     <span class="keywordflow">return</span> retval;
<a name="l03360"></a>03360 }
<a name="l03361"></a>03361 
<a name="l03362"></a><a class="code" href="classvoltdb_1_1NValue.html#a5446ad7dad5bdceeb84a54d62d6d13a4">03362</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a5446ad7dad5bdceeb84a54d62d6d13a4">NValue::op_decrement</a>()<span class="keyword"> const </span>{
<a name="l03363"></a>03363     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l03364"></a>03364     <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> retval(type);
<a name="l03365"></a>03365     <span class="keywordflow">switch</span>(type) {
<a name="l03366"></a>03366     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03367"></a>03367         <span class="keywordflow">if</span> (getTinyInt() == <a class="code" href="value__defs_8h.html#a2311db07b6d806ab2f12e6e64349424a">VOLT_INT8_MIN</a>) {
<a name="l03368"></a>03368             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03369"></a>03369                     <span class="stringliteral">&quot;Decrementing this TinyInt results in a value out of range&quot;</span>);
<a name="l03370"></a>03370         }
<a name="l03371"></a>03371         retval.getTinyInt() = <span class="keyword">static_cast&lt;</span>int8_t<span class="keyword">&gt;</span>(getTinyInt() - 1); <span class="keywordflow">break</span>;
<a name="l03372"></a>03372     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03373"></a>03373         <span class="keywordflow">if</span> (getSmallInt() == <a class="code" href="value__defs_8h.html#a7da6c3e8db01b49f2816852c9d9898fa">VOLT_INT16_MIN</a>) {
<a name="l03374"></a>03374             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03375"></a>03375                     <span class="stringliteral">&quot;Decrementing this SmallInt results in a value out of range&quot;</span>);
<a name="l03376"></a>03376         }
<a name="l03377"></a>03377         retval.getSmallInt() = <span class="keyword">static_cast&lt;</span>int16_t<span class="keyword">&gt;</span>(getSmallInt() - 1); <span class="keywordflow">break</span>;
<a name="l03378"></a>03378     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03379"></a>03379         <span class="keywordflow">if</span> (getInteger() == <a class="code" href="value__defs_8h.html#a24d61a07215d5575d7f911bdeeaeb4d7">VOLT_INT32_MIN</a>) {
<a name="l03380"></a>03380             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03381"></a>03381                     <span class="stringliteral">&quot;Decrementing this Integer results in a value out of range&quot;</span>);
<a name="l03382"></a>03382         }
<a name="l03383"></a>03383         retval.getInteger() = getInteger() - 1; <span class="keywordflow">break</span>;
<a name="l03384"></a>03384     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03385"></a>03385     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03386"></a>03386         <span class="keywordflow">if</span> (getBigInt() == VOLT_INT64_MIN) {
<a name="l03387"></a>03387             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#a5817a5b28683b88284ea04008ef0aa97">SQLException::data_exception_numeric_value_out_of_range</a>,
<a name="l03388"></a>03388                     <span class="stringliteral">&quot;Decrementing this BigInt/Timestamp results in a value out of range&quot;</span>);
<a name="l03389"></a>03389         }
<a name="l03390"></a>03390         retval.getBigInt() = getBigInt() - 1; <span class="keywordflow">break</span>;
<a name="l03391"></a>03391     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03392"></a>03392         retval.getDouble() = getDouble() - 1; <span class="keywordflow">break</span>;
<a name="l03393"></a>03393     <span class="keywordflow">default</span>:
<a name="l03394"></a>03394         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>( <span class="stringliteral">&quot;type %s is not decrementable&quot;</span>, getValueTypeString().c_str());
<a name="l03395"></a>03395         <span class="keywordflow">break</span>;
<a name="l03396"></a>03396     }
<a name="l03397"></a>03397     <span class="keywordflow">return</span> retval;
<a name="l03398"></a>03398 }
<a name="l03399"></a>03399 
<a name="l03400"></a><a class="code" href="classvoltdb_1_1NValue.html#a4b1d41287bc752d1d1a77a47164b366e">03400</a> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#a4b1d41287bc752d1d1a77a47164b366e">NValue::isZero</a>()<span class="keyword"> const </span>{
<a name="l03401"></a>03401     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l03402"></a>03402     <span class="keywordflow">switch</span>(type) {
<a name="l03403"></a>03403     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03404"></a>03404         <span class="keywordflow">return</span> getTinyInt() == 0;
<a name="l03405"></a>03405     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03406"></a>03406         <span class="keywordflow">return</span> getSmallInt() == 0;
<a name="l03407"></a>03407     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03408"></a>03408         <span class="keywordflow">return</span> getInteger() == 0;
<a name="l03409"></a>03409     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03410"></a>03410     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03411"></a>03411         <span class="keywordflow">return</span> getBigInt() == 0;
<a name="l03412"></a>03412     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l03413"></a>03413         <span class="keywordflow">return</span> getDecimal().IsZero();
<a name="l03414"></a>03414     <span class="keywordflow">default</span>:
<a name="l03415"></a>03415         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(
<a name="l03416"></a>03416                 <span class="stringliteral">&quot;type %s is not a numeric type that implements isZero()&quot;</span>,
<a name="l03417"></a>03417                 getValueTypeString().c_str());
<a name="l03418"></a>03418     }
<a name="l03419"></a>03419 }
<a name="l03420"></a>03420 
<a name="l03421"></a><a class="code" href="classvoltdb_1_1NValue.html#a193bee11bf9390ffda7b8b34a86bad1f">03421</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a193bee11bf9390ffda7b8b34a86bad1f">NValue::op_subtract</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03422"></a>03422     <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> vt = <a class="code" href="classvoltdb_1_1NValue.html#a6962d2ac22ab8f66fe65fe64f0ba0186">promoteForOp</a>(getValueType(), rhs.getValueType());
<a name="l03423"></a>03423     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() || rhs.<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03424"></a>03424         <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">getNullValue</a>(vt);
<a name="l03425"></a>03425     }
<a name="l03426"></a>03426 
<a name="l03427"></a>03427     <span class="keywordflow">switch</span> (vt) {
<a name="l03428"></a>03428     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03429"></a>03429     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03430"></a>03430     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03431"></a>03431     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03432"></a>03432     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03433"></a>03433         <span class="keywordflow">return</span> opSubtractBigInts(castAsBigIntAndGetValue(),
<a name="l03434"></a>03434                 rhs.castAsBigIntAndGetValue());
<a name="l03435"></a>03435 
<a name="l03436"></a>03436     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03437"></a>03437         <span class="keywordflow">return</span> opSubtractDoubles(castAsDoubleAndGetValue(),
<a name="l03438"></a>03438                 rhs.castAsDoubleAndGetValue());
<a name="l03439"></a>03439 
<a name="l03440"></a>03440     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l03441"></a>03441         <span class="keywordflow">return</span> opSubtractDecimals(castAsDecimal(),
<a name="l03442"></a>03442                 rhs.castAsDecimal());
<a name="l03443"></a>03443 
<a name="l03444"></a>03444     <span class="keywordflow">default</span>:
<a name="l03445"></a>03445         <span class="keywordflow">break</span>;
<a name="l03446"></a>03446     }
<a name="l03447"></a>03447     <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;Promotion of %s and %s failed in op_subtract.&quot;</span>,
<a name="l03448"></a>03448             getValueTypeString().c_str(),
<a name="l03449"></a>03449             rhs.getValueTypeString().c_str());
<a name="l03450"></a>03450 }
<a name="l03451"></a>03451 
<a name="l03452"></a><a class="code" href="classvoltdb_1_1NValue.html#ac3b1c41c170f8724cf65d09bce5508ee">03452</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#ac3b1c41c170f8724cf65d09bce5508ee">NValue::op_add</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03453"></a>03453     <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> vt = <a class="code" href="classvoltdb_1_1NValue.html#a6962d2ac22ab8f66fe65fe64f0ba0186">promoteForOp</a>(getValueType(), rhs.getValueType());
<a name="l03454"></a>03454     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() || rhs.<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03455"></a>03455         <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">getNullValue</a>(vt);
<a name="l03456"></a>03456     }
<a name="l03457"></a>03457 
<a name="l03458"></a>03458     <span class="keywordflow">switch</span> (vt) {
<a name="l03459"></a>03459     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03460"></a>03460     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03461"></a>03461     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03462"></a>03462     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03463"></a>03463     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03464"></a>03464         <span class="keywordflow">return</span> opAddBigInts(castAsBigIntAndGetValue(),
<a name="l03465"></a>03465                 rhs.castAsBigIntAndGetValue());
<a name="l03466"></a>03466 
<a name="l03467"></a>03467     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03468"></a>03468         <span class="keywordflow">return</span> opAddDoubles(castAsDoubleAndGetValue(),
<a name="l03469"></a>03469                 rhs.castAsDoubleAndGetValue());
<a name="l03470"></a>03470 
<a name="l03471"></a>03471     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l03472"></a>03472         <span class="keywordflow">return</span> opAddDecimals(castAsDecimal(),
<a name="l03473"></a>03473                 rhs.castAsDecimal());
<a name="l03474"></a>03474 
<a name="l03475"></a>03475     <span class="keywordflow">default</span>:
<a name="l03476"></a>03476         <span class="keywordflow">break</span>;
<a name="l03477"></a>03477     }
<a name="l03478"></a>03478     <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;Promotion of %s and %s failed in op_add.&quot;</span>,
<a name="l03479"></a>03479             getValueTypeString().c_str(),
<a name="l03480"></a>03480             rhs.getValueTypeString().c_str());
<a name="l03481"></a>03481 }
<a name="l03482"></a>03482 
<a name="l03483"></a><a class="code" href="classvoltdb_1_1NValue.html#a0cd4654fecd5e388791ffd26aba6f55c">03483</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a0cd4654fecd5e388791ffd26aba6f55c">NValue::op_multiply</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03484"></a>03484     <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> vt = <a class="code" href="classvoltdb_1_1NValue.html#a6962d2ac22ab8f66fe65fe64f0ba0186">promoteForOp</a>(getValueType(), rhs.getValueType());
<a name="l03485"></a>03485     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() || rhs.<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03486"></a>03486         <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">getNullValue</a>(vt);
<a name="l03487"></a>03487     }
<a name="l03488"></a>03488 
<a name="l03489"></a>03489     <span class="keywordflow">switch</span> (vt) {
<a name="l03490"></a>03490     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03491"></a>03491     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03492"></a>03492     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03493"></a>03493     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03494"></a>03494     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03495"></a>03495         <span class="keywordflow">return</span> opMultiplyBigInts(castAsBigIntAndGetValue(),
<a name="l03496"></a>03496                 rhs.castAsBigIntAndGetValue());
<a name="l03497"></a>03497 
<a name="l03498"></a>03498     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03499"></a>03499         <span class="keywordflow">return</span> opMultiplyDoubles(castAsDoubleAndGetValue(),
<a name="l03500"></a>03500                 rhs.castAsDoubleAndGetValue());
<a name="l03501"></a>03501 
<a name="l03502"></a>03502     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l03503"></a>03503         <span class="keywordflow">return</span> opMultiplyDecimals(castAsDecimal(),
<a name="l03504"></a>03504                 rhs.castAsDecimal());
<a name="l03505"></a>03505 
<a name="l03506"></a>03506     <span class="keywordflow">default</span>:
<a name="l03507"></a>03507         <span class="keywordflow">break</span>;
<a name="l03508"></a>03508     }
<a name="l03509"></a>03509     <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;Promotion of %s and %s failed in op_multiply.&quot;</span>,
<a name="l03510"></a>03510             getValueTypeString().c_str(),
<a name="l03511"></a>03511             rhs.getValueTypeString().c_str());
<a name="l03512"></a>03512 }
<a name="l03513"></a>03513 
<a name="l03514"></a><a class="code" href="classvoltdb_1_1NValue.html#a8175720427be40c7cccddb04c1f16d44">03514</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#a8175720427be40c7cccddb04c1f16d44">NValue::op_divide</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03515"></a>03515     <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> vt = <a class="code" href="classvoltdb_1_1NValue.html#a6962d2ac22ab8f66fe65fe64f0ba0186">promoteForOp</a>(getValueType(), rhs.getValueType());
<a name="l03516"></a>03516     <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>() || rhs.<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03517"></a>03517         <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#ad794c751d1a18b0231d8256da9c81778">getNullValue</a>(vt);
<a name="l03518"></a>03518     }
<a name="l03519"></a>03519 
<a name="l03520"></a>03520     <span class="keywordflow">switch</span> (vt) {
<a name="l03521"></a>03521     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03522"></a>03522     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03523"></a>03523     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03524"></a>03524     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03525"></a>03525     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03526"></a>03526         <span class="keywordflow">return</span> opDivideBigInts(castAsBigIntAndGetValue(),
<a name="l03527"></a>03527                 rhs.castAsBigIntAndGetValue());
<a name="l03528"></a>03528 
<a name="l03529"></a>03529     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03530"></a>03530         <span class="keywordflow">return</span> opDivideDoubles(castAsDoubleAndGetValue(),
<a name="l03531"></a>03531                 rhs.castAsDoubleAndGetValue());
<a name="l03532"></a>03532 
<a name="l03533"></a>03533     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfaf7e08af89c18380207225899b91fac83">VALUE_TYPE_DECIMAL</a>:
<a name="l03534"></a>03534         <span class="keywordflow">return</span> opDivideDecimals(castAsDecimal(),
<a name="l03535"></a>03535                 rhs.castAsDecimal());
<a name="l03536"></a>03536 
<a name="l03537"></a>03537     <span class="keywordflow">default</span>:
<a name="l03538"></a>03538         <span class="keywordflow">break</span>;
<a name="l03539"></a>03539     }
<a name="l03540"></a>03540     <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(<span class="stringliteral">&quot;Promotion of %s and %s failed in op_divide.&quot;</span>,
<a name="l03541"></a>03541             getValueTypeString().c_str(),
<a name="l03542"></a>03542             rhs.getValueTypeString().c_str());
<a name="l03543"></a>03543 }
<a name="l03544"></a>03544 
<a name="l03545"></a>03545 <span class="comment">/*</span>
<a name="l03546"></a>03546 <span class="comment"> * Out must have storage for 16 bytes</span>
<a name="l03547"></a>03547 <span class="comment"> */</span>
<a name="l03548"></a><a class="code" href="classvoltdb_1_1NValue.html#ae755d0db2ec0c566062c59f6791214d3">03548</a> <span class="keyword">inline</span> int32_t <a class="code" href="classvoltdb_1_1NValue.html#ae755d0db2ec0c566062c59f6791214d3">NValue::murmurHash3</a>()<span class="keyword"> const </span>{
<a name="l03549"></a>03549     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> type = getValueType();
<a name="l03550"></a>03550     <span class="keywordflow">switch</span>(type) {
<a name="l03551"></a>03551     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac98569a20531350525921369e99fde88">VALUE_TYPE_TIMESTAMP</a>:
<a name="l03552"></a>03552     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa6da17cab677b6b075d185b8ba3f78cab">VALUE_TYPE_DOUBLE</a>:
<a name="l03553"></a>03553     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac9f2eabc6b15fbcbfc2b340aa58631cc">VALUE_TYPE_BIGINT</a>:
<a name="l03554"></a>03554     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9eb687525097da03047df887e4bd077f">VALUE_TYPE_INTEGER</a>:
<a name="l03555"></a>03555     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa5c8678d3e0ee659672a0ca469a67c21f">VALUE_TYPE_SMALLINT</a>:
<a name="l03556"></a>03556     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfac31560fd0f32e866d2e523e4d58b91b2">VALUE_TYPE_TINYINT</a>:
<a name="l03557"></a>03557         <span class="keywordflow">return</span> MurmurHash3_x64_128( m_data, 8, 0);
<a name="l03558"></a>03558     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfa9182a89fe61ce752f5ea66b9b8842462">VALUE_TYPE_VARBINARY</a>:
<a name="l03559"></a>03559     <span class="keywordflow">case</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>:
<a name="l03560"></a>03560         <span class="keywordflow">if</span> (<a class="code" href="classvoltdb_1_1NValue.html#ae49fe28a0b64993755660bffec0890f6">isNull</a>()) {
<a name="l03561"></a>03561             <span class="comment">// Use NULL check first to be able to get rid of checks inside of other functions.</span>
<a name="l03562"></a>03562             <span class="comment">// Maybe it is impossible to be null here. -xin</span>
<a name="l03563"></a>03563             <span class="keywordflow">throw</span> <a class="code" href="classvoltdb_1_1SQLException.html">SQLException</a>(<a class="code" href="classvoltdb_1_1SQLException.html#ab96f63f9ce8ae86362975374a237ef38">SQLException::dynamic_sql_error</a>,
<a name="l03564"></a>03564                     <span class="stringliteral">&quot;Must not ask  for object length on sql null object.&quot;</span>);
<a name="l03565"></a>03565         }
<a name="l03566"></a>03566         <span class="keywordflow">return</span> MurmurHash3_x64_128( getObjectValue_withoutNull(), getObjectLength_withoutNull(), 0);
<a name="l03567"></a>03567     <span class="keywordflow">default</span>:
<a name="l03568"></a>03568         <a class="code" href="FatalException_8hpp.html#a79abe2d18fe35f7f78f526c7ba90ec7a">throwFatalException</a>(<span class="stringliteral">&quot;Unknown type for murmur hashing %d&quot;</span>, type);
<a name="l03569"></a>03569         <span class="keywordflow">break</span>;
<a name="l03570"></a>03570     }
<a name="l03571"></a>03571 }
<a name="l03572"></a>03572 
<a name="l03573"></a>03573 <span class="comment">/*</span>
<a name="l03574"></a>03574 <span class="comment"> * The LHS (this) should always be the string being compared</span>
<a name="l03575"></a>03575 <span class="comment"> * and the RHS should always be the LIKE expression.</span>
<a name="l03576"></a>03576 <span class="comment"> * The planner or EE needs to enforce this.</span>
<a name="l03577"></a>03577 <span class="comment"> *</span>
<a name="l03578"></a>03578 <span class="comment"> * Null check should have been handled already.</span>
<a name="l03579"></a>03579 <span class="comment"> */</span>
<a name="l03580"></a><a class="code" href="classvoltdb_1_1NValue.html#aed66e25934b659b4925a0cd652513ecb">03580</a> <span class="keyword">inline</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> <a class="code" href="classvoltdb_1_1NValue.html#aed66e25934b659b4925a0cd652513ecb">NValue::like</a>(<span class="keyword">const</span> <a class="code" href="classvoltdb_1_1NValue.html">NValue</a> rhs)<span class="keyword"> const </span>{
<a name="l03581"></a>03581     <span class="comment">/*</span>
<a name="l03582"></a>03582 <span class="comment">     * Validate that all params are VARCHAR</span>
<a name="l03583"></a>03583 <span class="comment">     */</span>
<a name="l03584"></a>03584     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> mType = getValueType();
<a name="l03585"></a>03585     <span class="keywordflow">if</span> (mType != <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>) {
<a name="l03586"></a>03586         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(
<a name="l03587"></a>03587                 <span class="stringliteral">&quot;lhs of LIKE expression is %s not %s&quot;</span>,
<a name="l03588"></a>03588                 getValueTypeString().c_str(),
<a name="l03589"></a>03589                 <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>).c_str());
<a name="l03590"></a>03590     }
<a name="l03591"></a>03591 
<a name="l03592"></a>03592     <span class="keyword">const</span> <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cf">ValueType</a> rhsType = rhs.getValueType();
<a name="l03593"></a>03593     <span class="keywordflow">if</span> (rhsType != <a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>) {
<a name="l03594"></a>03594         <a class="code" href="SQLException_8h.html#aa32c51c9dc944cb6b18c2c83625f251b">throwDynamicSQLException</a>(
<a name="l03595"></a>03595                 <span class="stringliteral">&quot;rhs of LIKE expression is %s not %s&quot;</span>,
<a name="l03596"></a>03596                 rhs.getValueTypeString().c_str(),
<a name="l03597"></a>03597                 <a class="code" href="namespacevoltdb.html#ada92146e0d9b39e39ae8ba4f76aae2f3">getTypeName</a>(<a class="code" href="namespacevoltdb.html#a7fd70c56e4e670f288f9adc91f7332cfade0ee3bcd6f27b05dfc85119b00588a9">VALUE_TYPE_VARCHAR</a>).c_str());
<a name="l03598"></a>03598     }
<a name="l03599"></a>03599 
<a name="l03600"></a>03600     <span class="keyword">const</span> int32_t valueUTF8Length = getObjectLength_withoutNull();
<a name="l03601"></a>03601     <span class="keyword">const</span> int32_t patternUTF8Length = rhs.getObjectLength_withoutNull();
<a name="l03602"></a>03602 
<a name="l03603"></a>03603     <span class="keywordflow">if</span> (0 == patternUTF8Length) {
<a name="l03604"></a>03604         <span class="keywordflow">if</span> (0 == valueUTF8Length) {
<a name="l03605"></a>03605             <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>();
<a name="l03606"></a>03606         } <span class="keywordflow">else</span> {
<a name="l03607"></a>03607             <span class="keywordflow">return</span> <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03608"></a>03608         }
<a name="l03609"></a>03609     }
<a name="l03610"></a>03610 
<a name="l03611"></a>03611     <span class="keywordtype">char</span> *valueChars = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(getObjectValue_withoutNull());
<a name="l03612"></a>03612     <span class="keywordtype">char</span> *patternChars = <span class="keyword">reinterpret_cast&lt;</span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(rhs.getObjectValue_withoutNull());
<a name="l03613"></a>03613     assert(valueChars);
<a name="l03614"></a>03614     assert(patternChars);
<a name="l03615"></a>03615 
<a name="l03616"></a>03616     <span class="comment">/*</span>
<a name="l03617"></a>03617 <span class="comment">     * Because lambdas are for poseurs.</span>
<a name="l03618"></a>03618 <span class="comment">     */</span>
<a name="l03619"></a>03619     <span class="keyword">class </span>Liker {
<a name="l03620"></a>03620 
<a name="l03621"></a>03621     <span class="keyword">private</span>:
<a name="l03622"></a>03622         <span class="comment">// Constructor used internally for temporary recursion contexts.</span>
<a name="l03623"></a>03623         Liker( <span class="keyword">const</span> Liker&amp; original, <span class="keyword">const</span> <span class="keywordtype">char</span>* valueChars, <span class="keyword">const</span> <span class="keywordtype">char</span>* patternChars) :
<a name="l03624"></a>03624             m_value(original.m_value, valueChars),
<a name="l03625"></a>03625             m_pattern(original.m_pattern, patternChars)
<a name="l03626"></a>03626              {}
<a name="l03627"></a>03627 
<a name="l03628"></a>03628     <span class="keyword">public</span>:
<a name="l03629"></a>03629         Liker(<span class="keywordtype">char</span> *valueChars, <span class="keywordtype">char</span>* patternChars, int32_t valueUTF8Length, int32_t patternUTF8Length) :
<a name="l03630"></a>03630             m_value(valueChars, valueChars + valueUTF8Length),
<a name="l03631"></a>03631             m_pattern(patternChars, patternChars + patternUTF8Length)
<a name="l03632"></a>03632              {}
<a name="l03633"></a>03633 
<a name="l03634"></a>03634         <span class="keywordtype">bool</span> <a class="code" href="classvoltdb_1_1NValue.html#aed66e25934b659b4925a0cd652513ecb">like</a>() {
<a name="l03635"></a>03635             <span class="keywordflow">while</span> ( ! m_pattern.atEnd()) {
<a name="l03636"></a>03636                 <span class="keyword">const</span> uint32_t nextPatternCodePoint = m_pattern.extractCodePoint();
<a name="l03637"></a>03637                 <span class="keywordflow">switch</span> (nextPatternCodePoint) {
<a name="l03638"></a>03638                 <span class="keywordflow">case</span> <span class="charliteral">&apos;%&apos;</span>: {
<a name="l03639"></a>03639                     <span class="keywordflow">if</span> (m_pattern.atEnd()) {
<a name="l03640"></a>03640                         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l03641"></a>03641                     }
<a name="l03642"></a>03642 
<a name="l03643"></a>03643                     <span class="keyword">const</span> <span class="keywordtype">char</span> *postPercentPatternIterator = m_pattern.getCursor();
<a name="l03644"></a>03644                     <span class="keyword">const</span> uint32_t nextPatternCodePointAfterPercent = m_pattern.extractCodePoint();
<a name="l03645"></a>03645                     <span class="keyword">const</span> <span class="keywordtype">bool</span> nextPatternCodePointAfterPercentIsSpecial =
<a name="l03646"></a>03646                             (nextPatternCodePointAfterPercent == <span class="charliteral">&apos;_&apos;</span>) ||
<a name="l03647"></a>03647                             (nextPatternCodePointAfterPercent == <span class="charliteral">&apos;%&apos;</span>);
<a name="l03648"></a>03648 
<a name="l03649"></a>03649                     <span class="comment">/*</span>
<a name="l03650"></a>03650 <span class="comment">                     * This loop tries to skip as many characters as possible with the % by checking</span>
<a name="l03651"></a>03651 <span class="comment">                     * if the next value character matches the pattern character after the %.</span>
<a name="l03652"></a>03652 <span class="comment">                     *</span>
<a name="l03653"></a>03653 <span class="comment">                     * If the next pattern character is special then we always have to recurse to</span>
<a name="l03654"></a>03654 <span class="comment">                     * match that character. For stacked %s this just skips to the last one.</span>
<a name="l03655"></a>03655 <span class="comment">                     * For stacked _ it will recurse and demand the correct number of characters.</span>
<a name="l03656"></a>03656 <span class="comment">                     *</span>
<a name="l03657"></a>03657 <span class="comment">                     * For a regular character it will recurse if the value character matches the pattern character.</span>
<a name="l03658"></a>03658 <span class="comment">                     * This saves doing a function call per character and allows us to skip if there is no match.</span>
<a name="l03659"></a>03659 <span class="comment">                     */</span>
<a name="l03660"></a>03660                     <span class="keywordflow">while</span> ( ! m_value.atEnd()) {
<a name="l03661"></a>03661 
<a name="l03662"></a>03662                         <span class="keyword">const</span> <span class="keywordtype">char</span> *preExtractionValueIterator = m_value.getCursor();
<a name="l03663"></a>03663                         <span class="keyword">const</span> uint32_t nextValueCodePoint = m_value.extractCodePoint();
<a name="l03664"></a>03664 
<a name="l03665"></a>03665                         <span class="keyword">const</span> <span class="keywordtype">bool</span> nextPatternCodePointIsSpecialOrItEqualsNextValueCodePoint =
<a name="l03666"></a>03666                                 (nextPatternCodePointAfterPercentIsSpecial ||
<a name="l03667"></a>03667                                         (nextPatternCodePointAfterPercent == nextValueCodePoint));
<a name="l03668"></a>03668 
<a name="l03669"></a>03669                         <span class="keywordflow">if</span> ( nextPatternCodePointIsSpecialOrItEqualsNextValueCodePoint) {
<a name="l03670"></a>03670                             Liker recursionContext( *<span class="keyword">this</span>, preExtractionValueIterator, postPercentPatternIterator);
<a name="l03671"></a>03671                             <span class="keywordflow">if</span> (recursionContext.like()) {
<a name="l03672"></a>03672                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l03673"></a>03673                             }
<a name="l03674"></a>03674                         }
<a name="l03675"></a>03675                     }
<a name="l03676"></a>03676                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03677"></a>03677                 }
<a name="l03678"></a>03678                 <span class="keywordflow">case</span> <span class="charliteral">&apos;_&apos;</span>: {
<a name="l03679"></a>03679                     <span class="keywordflow">if</span> ( m_value.atEnd()) {
<a name="l03680"></a>03680                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03681"></a>03681                     }
<a name="l03682"></a>03682                     <span class="comment">//Extract a code point to consume a character</span>
<a name="l03683"></a>03683                     m_value.extractCodePoint();
<a name="l03684"></a>03684                     <span class="keywordflow">break</span>;
<a name="l03685"></a>03685                 }
<a name="l03686"></a>03686                 <span class="keywordflow">default</span>: {
<a name="l03687"></a>03687                     <span class="keywordflow">if</span> ( m_value.atEnd()) {
<a name="l03688"></a>03688                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03689"></a>03689                     }
<a name="l03690"></a>03690                     <span class="keyword">const</span> <span class="keywordtype">int</span> nextValueCodePoint = m_value.extractCodePoint();
<a name="l03691"></a>03691                     <span class="keywordflow">if</span> (nextPatternCodePoint != nextValueCodePoint) {
<a name="l03692"></a>03692                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03693"></a>03693                     }
<a name="l03694"></a>03694                     <span class="keywordflow">break</span>;
<a name="l03695"></a>03695                 }
<a name="l03696"></a>03696                 }
<a name="l03697"></a>03697             }
<a name="l03698"></a>03698             <span class="comment">//A matching value ends exactly where the pattern ends (having already accounted for &apos;%&apos;)</span>
<a name="l03699"></a>03699             <span class="keywordflow">return</span> m_value.atEnd();
<a name="l03700"></a>03700         }
<a name="l03701"></a>03701 
<a name="l03702"></a>03702         <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html" title="Iterates over UTF8 strings one character &amp;quot;code point&amp;quot; at a time, being...">UTF8Iterator</a> m_value;
<a name="l03703"></a>03703         <a class="code" href="classvoltdb_1_1NValue_1_1UTF8Iterator.html" title="Iterates over UTF8 strings one character &amp;quot;code point&amp;quot; at a time, being...">UTF8Iterator</a> m_pattern;
<a name="l03704"></a>03704     };
<a name="l03705"></a>03705 
<a name="l03706"></a>03706     Liker liker(valueChars, patternChars, valueUTF8Length, patternUTF8Length);
<a name="l03707"></a>03707 
<a name="l03708"></a>03708     <span class="keywordflow">return</span> liker.like() ? <a class="code" href="classvoltdb_1_1NValue.html#aebe07348f8d91e9eeb34b6f3ac02cce2">getTrue</a>() : <a class="code" href="classvoltdb_1_1NValue.html#a8a4220d0b3819a000c18c4afb86891fb">getFalse</a>();
<a name="l03709"></a>03709 }
<a name="l03710"></a>03710 
<a name="l03711"></a>03711 } <span class="comment">// namespace voltdb</span>
<a name="l03712"></a>03712 
<a name="l03713"></a>03713 <span class="preprocessor">#endif </span><span class="comment">/* NVALUE_HPP_ */</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&nbsp;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 2 Oct 2014 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
